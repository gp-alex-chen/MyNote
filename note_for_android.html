<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
               "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>note_for_android</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
<meta name="title" content="note_for_android"/>
<meta name="generator" content="Org-mode"/>
<meta name="generated" content="2015-10-19T11:03+0800"/>
<meta name="author" content="alex"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  html { font-family: Times, serif; font-size: 12pt; }
  .title  { text-align: center; }
  .todo   { color: red; }
  .done   { color: green; }
  .tag    { background-color: #add8e6; font-weight:normal }
  .target { }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  {margin-left:auto; margin-right:0px;  text-align:right;}
  .left   {margin-left:0px;  margin-right:auto; text-align:left;}
  .center {margin-left:auto; margin-right:auto; text-align:center;}
  p.verse { margin-left: 3% }
  pre {
	border: 1pt solid #AEBDCC;
	background-color: #F3F5F7;
	padding: 5pt;
	font-family: courier, monospace;
        font-size: 90%;
        overflow:auto;
  }
  table { border-collapse: collapse; }
  td, th { vertical-align: top;  }
  th.right  { text-align:center;  }
  th.left   { text-align:center;   }
  th.center { text-align:center; }
  td.right  { text-align:right;  }
  td.left   { text-align:left;   }
  td.center { text-align:center; }
  dt { font-weight: bold; }
  div.figure { padding: 0.5em; }
  div.figure p { text-align: center; }
  div.inlinetask {
    padding:10px;
    border:2px solid gray;
    margin:10px;
    background: #ffffcc;
  }
  textarea { overflow-x: auto; }
  .linenr { font-size:smaller }
  .code-highlighted {background-color:#ffff00;}
  .org-info-js_info-navigation { border-style:none; }
  #org-info-js_console-label { font-size:10px; font-weight:bold;
                               white-space:nowrap; }
  .org-info-js_search-highlight {background-color:#ffff00; color:#000000;
                                 font-weight:bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="http://orgmode.org/worg/worg.css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>

</head>
<body>

<div id="preamble">

</div>

<div id="content">
<h1 class="title">note_for_android</h1>



<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1 事件监听</a>
<ul>
<li><a href="#sec-1-1">1.1 接口回调</a></li>
</ul>
</li>
<li><a href="#sec-2">2 找碧油鸡</a>
<ul>
<li><a href="#sec-2-1">2.1 logCat 的日志</a></li>
<li><a href="#sec-2-2">2.2 找BUG</a></li>
<li><a href="#sec-2-3">2.3 DeBugMode</a></li>
</ul>
</li>
<li><a href="#sec-3">3 View</a>
<ul>
<li><a href="#sec-3-1">3.1 一些公共的属性解释</a></li>
<li><a href="#sec-3-2">3.2 关于颜色</a></li>
<li><a href="#sec-3-3">3.3 布局(容器视图( View ))</a></li>
<li><a href="#sec-3-4">3.4 控件</a></li>
<li><a href="#sec-3-5">3.5 获取屏幕的长宽</a></li>
</ul>
</li>
<li><a href="#sec-4">4 Menu</a>
<ul>
<li><a href="#sec-4-1">4.1 系统菜单</a></li>
<li><a href="#sec-4-2">4.2 上下文菜单</a></li>
<li><a href="#sec-4-3">4.3 弹出菜单 PopupMenu</a></li>
</ul>
</li>
<li><a href="#sec-5">5 Dialog</a>
<ul>
<li><a href="#sec-5-1">5.1 AlertDialog</a></li>
</ul>
</li>
<li><a href="#sec-6">6 Notification</a>
<ul>
<li><a href="#sec-6-1">6.1 构建器</a></li>
<li><a href="#sec-6-2">6.2 显示带详情的通知/点击之后出现详情页</a></li>
</ul>
</li>
<li><a href="#sec-7">7 Toast</a>
<ul>
<li><a href="#sec-7-1">7.1 拥有自定义布局的 toast</a></li>
</ul>
</li>
<li><a href="#sec-8">8 Adapter 适配器</a>
<ul>
<li><a href="#sec-8-1">8.1 ArrayAdapter</a></li>
<li><a href="#sec-8-2">8.2 BaseAdapter</a></li>
<li><a href="#sec-8-3">8.3 SimpleAdapter</a></li>
<li><a href="#sec-8-4">8.4 SimpleCursorAdapter</a></li>
<li><a href="#sec-8-5">8.5 重构适配器</a></li>
</ul>
</li>
<li><a href="#sec-9">9 数据存储</a>
<ul>
<li><a href="#sec-9-1">9.1 使用 adb 查看App内的文件</a></li>
<li><a href="#sec-9-2">9.2 内部存储</a></li>
<li><a href="#sec-9-3">9.3 外部存储</a></li>
<li><a href="#sec-9-4">9.4 数据库存储</a></li>
<li><a href="#sec-9-5">9.5 共享参数 SharedPreferences</a></li>
</ul>
</li>
<li><a href="#sec-10">10 Fragment</a>
<ul>
<li><a href="#sec-10-1">10.1 如何开始</a></li>
<li><a href="#sec-10-2">10.2 将 Fragment 显示到 Activity 上的两种方式</a></li>
<li><a href="#sec-10-3">10.3 基本用法</a></li>
<li><a href="#sec-10-4">10.4 生命周期方法</a></li>
<li><a href="#sec-10-5">10.5 实现类似回退栈的功能</a></li>
<li><a href="#sec-10-6">10.6 DialogFragment</a></li>
<li><a href="#sec-10-7">10.7 ListFragment</a></li>
<li><a href="#sec-10-8">10.8 一个简单的使用方法例子</a></li>
</ul>
</li>
<li><a href="#sec-11">11 Loaders</a>
<ul>
<li><a href="#sec-11-1">11.1 Loader API Summary</a></li>
<li><a href="#sec-11-2">11.2 在 Application 中使用 Loader</a></li>
<li><a href="#sec-11-3">11.3 CursorLoader</a></li>
</ul>
</li>
<li><a href="#sec-12">12 Handler</a>
<ul>
<li><a href="#sec-12-1">12.1 Handler 过程解释</a></li>
<li><a href="#sec-12-2">12.2 子线程给主线程发消息</a></li>
<li><a href="#sec-12-3">12.3 主线程给子线程发送消息</a></li>
</ul>
</li>
<li><a href="#sec-13">13 异步任务</a>
<ul>
<li><a href="#sec-13-1">13.1 AsyncTask</a></li>
<li><a href="#sec-13-2">13.2 常用的异步任务</a></li>
<li><a href="#sec-13-3">13.3 Loader</a></li>
</ul>
</li>
<li><a href="#sec-14">14 Intent意图</a>
<ul>
<li><a href="#sec-14-1">14.1 Intent 的七大属性</a></li>
<li><a href="#sec-14-2">14.2 生命周期</a></li>
</ul>
</li>
<li><a href="#sec-15">15 Action Bar</a>
<ul>
<li><a href="#sec-15-1">15.1 简单介绍</a></li>
<li><a href="#sec-15-2">15.2 Tab</a></li>
</ul>
</li>
<li><a href="#sec-16">16 ViewPager</a>
<ul>
<li><a href="#sec-16-1">16.1 概述</a></li>
<li><a href="#sec-16-2">16.2 ViewPager+v7包 歩骤</a></li>
</ul>
</li>
<li><a href="#sec-17">17 四大组件</a>
<ul>
<li><a href="#sec-17-1">17.1 Activity</a></li>
<li><a href="#sec-17-2">17.2 ContentProvider内容提供者</a></li>
<li><a href="#sec-17-3">17.3 Service</a></li>
<li><a href="#sec-17-4">17.4 BroadcastRecevier</a></li>
</ul>
</li>
<li><a href="#sec-18">18 事件分发机制</a>
<ul>
<li><a href="#sec-18-1">18.1 分发的核心方法</a></li>
<li><a href="#sec-18-2">18.2 解决事件冲突</a></li>
</ul>
</li>
<li><a href="#sec-19">19 自定义控件</a>
<ul>
<li><a href="#sec-19-1">19.1 自定义控件三种类型</a></li>
<li><a href="#sec-19-2">19.2 在继承的UI控件上绘图</a></li>
</ul>
</li>
<li><a href="#sec-20">20 动画</a>
<ul>
<li><a href="#sec-20-1">20.1 View 动画 - 补间动画</a></li>
<li><a href="#sec-20-2">20.2 Drawable 动画 - 帧动画</a></li>
<li><a href="#sec-20-3">20.3 Property 动画 - 属性动画</a></li>
</ul>
</li>
<li><a href="#sec-21">21 第三方</a>
<ul>
<li><a href="#sec-21-1">21.1 第三方 SlidingMenu</a></li>
<li><a href="#sec-21-2">21.2 bdmap</a></li>
<li><a href="#sec-21-3">21.3 Volley</a></li>
<li><a href="#sec-21-4">21.4 XUtils</a></li>
<li><a href="#sec-21-5">21.5 友盟 nmeng</a></li>
<li><a href="#sec-21-6">21.6 ShareSDK</a></li>
</ul>
</li>
<li><a href="#sec-22">22 IDEA</a>
<ul>
<li><a href="#sec-22-1">22.1 常见问题</a></li>
<li><a href="#sec-22-2">22.2 快捷键</a></li>
</ul>
</li>
<li><a href="#sec-23">23 Android 高级课程</a>
<ul>
<li><a href="#sec-23-1">23.1 图片的加载与显示</a></li>
<li><a href="#sec-23-2">23.2 复杂的 ListView 应用</a></li>
</ul>
</li>
<li><a href="#sec-24">24 收藏的网页</a>
<ul>
<li><a href="#sec-24-1">24.1 酷炫的 UI 效果</a></li>
<li><a href="#sec-24-2">24.2 W3C</a></li>
<li><a href="#sec-24-3">24.3 SQL</a></li>
</ul>
</li>
<li><a href="#sec-25">25 常用工具类</a>
<ul>
<li><a href="#sec-25-1">25.1 HttpUtil</a></li>
<li><a href="#sec-25-2">25.2 XmlPullParseUtil</a></li>
<li><a href="#sec-25-3">25.3 JsonParseUtil</a></li>
<li><a href="#sec-25-4">25.4 FileUtil</a></li>
<li><a href="#sec-25-5">25.5 图片缓存 FileCache</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> 事件监听</h2>
<div class="outline-text-2" id="text-1">

<p>给按钮添加事件监听
setOnClickListener() 传入一个 OnClickListener() ,(一个监听者,并负责处理)
添加事件监听的四种方式
</p><ol>
<li>匿名内部类
</li>
<li>内部类
</li>
<li>让 Activity 去实现监听接口
</li>
<li>在xml文件中设置 android:onClick ="函数名",并在 activity 中添加 public void 函数名(View v)方法
</li>
</ol>


</div>

<div id="outline-container-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> 接口回调</h3>
<div class="outline-text-3" id="text-1-1">

<p>接口回调就是指利用一个监听器来监听一个不知道什么时候会完成的方法，一旦方法完成，
调用回调方法通知调用者. Button 控件的监听事件就是一个典型的接口回调。
</p>
</div>

<div id="outline-container-1-1-1" class="outline-4">
<h4 id="sec-1-1-1"><span class="section-number-4">1.1.1</span> 接口回调的更多应用</h4>
<div class="outline-text-4" id="text-1-1-1">

<ul>
<li>在下载资源过程中，下载不知道什么时候完成，如果下载资源需要显示在 View 上，那么设置
 一个接口，其中定义一个完成方法，在资源下载完成后调用该方法，然后在 View 中设置接口,
 完成接口中的完成方法，即：方法调用时就表示资源已经下载成功，可以将其显示在 View 中.
</li>
<li>Fragment 与 Activity 之间传递信息可以在 Fragment 中设置接口， 在 Activity 中回调
</li>
</ul>


</div>
</div>
</div>

</div>

<div id="outline-container-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> 找碧油鸡</h2>
<div class="outline-text-2" id="text-2">

<p>输出去 logCat 中看
</p>
</div>

<div id="outline-container-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> logCat 的日志</h3>
<div class="outline-text-3" id="text-2-1">




<pre class="src src-java">Log.d(TAG,<span style="color: #4E9A06;">"debug"</span>);
Log.i(TAG,<span style="color: #4E9A06;">"information"</span>);
Log.e(TAG,<span style="color: #4E9A06;">"error"</span>);
Log.w(TAG,<span style="color: #4E9A06;">"warn"</span>);
</pre>

</div>

</div>

<div id="outline-container-2-2" class="outline-3">
<h3 id="sec-2-2"><span class="section-number-3">2.2</span> 找BUG</h3>
<div class="outline-text-3" id="text-2-2">

<p>添加一个DEBUG模式，发布时设置为false不打印LOG
</p></div>

</div>

<div id="outline-container-2-3" class="outline-3">
<h3 id="sec-2-3"><span class="section-number-3">2.3</span> DeBugMode</h3>
<div class="outline-text-3" id="text-2-3">

<p>定义一个自己的类 MyLog，在其中使用Log.d，但是在之前添加一个判断，判断的值在类中定义，这样在上线后将值改变为 false，就可以取消 Log 的打印
</p>
</div>
</div>

</div>

<div id="outline-container-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> View</h2>
<div class="outline-text-2" id="text-3">



</div>

<div id="outline-container-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> 一些公共的属性解释</h3>
<div class="outline-text-3" id="text-3-1">

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" /><col class="left" /><col class="left" />
</colgroup>
<tbody>
<tr><td class="left">属性</td><td class="left">描述</td><td class="left">备注</td></tr>
<tr><td class="left">layout_width</td><td class="left">宽</td><td class="left"></td></tr>
<tr><td class="left">layout_height</td><td class="left">高</td><td class="left"></td></tr>
<tr><td class="left">dp:</td><td class="left">单位像素密度</td><td class="left"></td></tr>
<tr><td class="left">match_parent:</td><td class="left">匹配上一级</td><td class="left"></td></tr>
<tr><td class="left">wrap_content:</td><td class="left">将内容完全显示出</td><td class="left"></td></tr>
<tr><td class="left">layout_weight:</td><td class="left">权重,占比</td><td class="left">需要将 width 或者 height 设置为0dp,才有效果</td></tr>
<tr><td class="left">layout_gravity:</td><td class="left">本视图相对于上一级视图的显示位置</td><td class="left"></td></tr>
<tr><td class="left">gravity:</td><td class="left">视图中显示的内容相对于本视图的显示位置</td><td class="left"></td></tr>
<tr><td class="left">layout_marginxxx:</td><td class="left">外边距.</td><td class="left"></td></tr>
<tr><td class="left">padding:</td><td class="left">内边距</td><td class="left"></td></tr>
</tbody>
</table>


</div>

</div>

<div id="outline-container-3-2" class="outline-3">
<h3 id="sec-3-2"><span class="section-number-3">3.2</span> 关于颜色</h3>
<div class="outline-text-3" id="text-3-2">

<pre class="example">
RGB 每个颜色值是一个1位的16进制数,0-f
RRGGBB 每个颜色值是一个2位16进制,00-ff
ARGB A表示透明度0表示完全透明 f不透明
AARRGGBB 同上
</pre>

</div>

</div>

<div id="outline-container-3-3" class="outline-3">
<h3 id="sec-3-3"><span class="section-number-3">3.3</span> 布局(容器视图( View ))</h3>
<div class="outline-text-3" id="text-3-3">

<p>作用:控制视图的显示位置
</p>

</div>

<div id="outline-container-3-3-1" class="outline-4">
<h4 id="sec-3-3-1"><span class="section-number-4">3.3.1</span> LinearLayout :线性布局</h4>
<div class="outline-text-4" id="text-3-3-1">

<p>用 orientation 属性设置水平 horizontal 和垂直 virtical 方向
</p>
</div>

</div>

<div id="outline-container-3-3-2" class="outline-4">
<h4 id="sec-3-3-2"><span class="section-number-4">3.3.2</span> RelativeLayout:相对布局</h4>
<div class="outline-text-4" id="text-3-3-2">

<p>可以方便的摆放控件
</p><ul>
<li id="sec-3-3-2-1">相对同一级<br/>
<ul>
<li>layout_toRightOf="id":本控件放在id为id的控件右边
</li>
<li>lalayout_below="id":在id的下方yout_below="id":在id的下方
</li>
<li>layout_alignLeft="id":与id左对齐
</li>
<li>layout_alignBaseline="id":与id基线对齐
</li>
</ul>


</li>
</ul>
<ul>
<li id="sec-3-3-2-2">相对上一级<br/>
<ul>
<li>layout_alignParentRight:是否在父容器的右方
</li>
<li>layout_centerInParent:是否在父容器的中央
</li>
</ul>


</li>
</ul>
</div>

</div>

<div id="outline-container-3-3-3" class="outline-4">
<h4 id="sec-3-3-3"><span class="section-number-4">3.3.3</span> FrameLayout:帧布局</h4>
<div class="outline-text-4" id="text-3-3-3">

<p>显示一系列图片.
</p>
</div>

</div>

<div id="outline-container-3-3-4" class="outline-4">
<h4 id="sec-3-3-4"><span class="section-number-4">3.3.4</span> AutoCompleteTextView</h4>
<div class="outline-text-4" id="text-3-3-4">

<p>其本身是一个容器视图,可以容纳其他视图
</p><ul>
<li>completionThreshold : 用户输入'几'个字符后出现自动补全,默认值是2 
</li>
</ul>

<p><a href="#sec-8">查看adapter内容</a>
</p></div>

</div>

<div id="outline-container-3-3-5" class="outline-4">
<h4 id="sec-3-3-5"><span class="section-number-4">3.3.5</span> Spinner</h4>
<div class="outline-text-4" id="text-3-3-5">

<p>下拉选单
</p>
<p>
放置数组
</p><pre class="example">
entries="@array/list";
</pre>


<p>
依旧需要添加<a href="#sec-8">Adapter</a>适配器
</p>
<p>
事件监听
</p>


<pre class="example">setOnItemSelectedListener(new OnItemSelectedListener)
</pre>


<p>
实现 onItemSelected(AdapterView&lt;?&gt; parent, View view, int position,long id)
</p>
<p>
其中
</p><pre class="example">
AdapterView&lt;?&gt;放置的是适配器容器视图,比如 Spinner
</pre>


<pre class="example">
view 接受的是现实被选中的数据项的 TextView 对象,就是适配器中的
</pre>


<pre class="example">
position 表示被选中的数据在适配器中的位置,即适配器中集合的位置.
</pre>


<p>
取消默认选择第一项
</p><pre class="example">
setSelection(0,true);//让第一项被选中过
</pre>

<p>记录一些基础控件
</p></div>
</div>

</div>

<div id="outline-container-3-4" class="outline-3">
<h3 id="sec-3-4"><span class="section-number-3">3.4</span> 控件</h3>
<div class="outline-text-3" id="text-3-4">


</div>

<div id="outline-container-3-4-1" class="outline-4">
<h4 id="sec-3-4-1"><span class="section-number-4">3.4.1</span> TextView</h4>
<div class="outline-text-4" id="text-3-4-1">

<ul>
<li>textSize:字体大小
</li>
<li>textColor:颜色
</li>
<li>textStyle:风格
</li>
<li>drawableLeft:左边显示图片
</li>
<li>text:内容
</li>
<li>autoLink="&hellip;":设置内容为一个"&hellip;"类型的链接可以使web,phone等等
</li>
<li>singleLine:单行显示文本
</li>
<li>ellipsize:单行文本不够则显示省略号
</li>
<li>focusable 和 focusableInTouchMode:实现触摸得到焦点
</li>
<li>autoLink 自动识别格式，比如 email tel 等等
</li>
</ul>


</div>

</div>

<div id="outline-container-3-4-2" class="outline-4">
<h4 id="sec-3-4-2"><span class="section-number-4">3.4.2</span> Button</h4>
<div class="outline-text-4" id="text-3-4-2">

<p>基本属性和 TextView 相同
</p><ul>
<li>onClick="方法名"
</li>
</ul>

<ul>
<li id="sec-3-4-2-1">监听接口<br/>
OnClickedListener

</li>
</ul>
</div>

</div>

<div id="outline-container-3-4-3" class="outline-4">
<h4 id="sec-3-4-3"><span class="section-number-4">3.4.3</span> ToggleButton和Switch</h4>
<div class="outline-text-4" id="text-3-4-3">

<p>开关
</p>
</div>

</div>

<div id="outline-container-3-4-4" class="outline-4">
<h4 id="sec-3-4-4"><span class="section-number-4">3.4.4</span> ImageView</h4>
<div class="outline-text-4" id="text-3-4-4">

<p>图片视图
</p><ul>
<li>src:设置图片源
</li>
<li>adjustViewBounds:当自身宽高发生变化时,图片按比例缩放
</li>
<li>minWidth:扩大的最大值
</li>
<li>maxHeight:扩大的最大值
</li>
<li>visibility:是否可见
</li>
<li>scaleType:填充方式
</li>
<li>setAlpha:设置透明度,0-1
</li>
</ul>


</div>

</div>

<div id="outline-container-3-4-5" class="outline-4">
<h4 id="sec-3-4-5"><span class="section-number-4">3.4.5</span> EditText</h4>
<div class="outline-text-4" id="text-3-4-5">

<p>可输入的文本框
</p><ul>
<li>hint:默认显示的内容
</li>
<li>inputType:输入的内容类型
</li>
</ul>


</div>

</div>

<div id="outline-container-3-4-6" class="outline-4">
<h4 id="sec-3-4-6"><span class="section-number-4">3.4.6</span> CheckBox</h4>
<div class="outline-text-4" id="text-3-4-6">

<p>复选框,可以选择多项
</p><ul>
<li>checked:是否选中
</li>
<li>onClick:点击调用相应方法
</li>
</ul>

<ul>
<li id="sec-3-4-6-1">方法<br/>
监听接口
<pre class="example">
OnCheckedChangeListener
</pre>

<p>是否选中
</p><pre class="example">
isCheaked
</pre>


</li>
</ul>
</div>

</div>

<div id="outline-container-3-4-7" class="outline-4">
<h4 id="sec-3-4-7"><span class="section-number-4">3.4.7</span> RadioButton</h4>
<div class="outline-text-4" id="text-3-4-7">

<p>只能选中一个的单选框,要想实现单选,需要将 RadioButton 放到 RadioGroup 中.
如此,需要给组添加事件监听
</p><pre class="example">
OnCheckedChangeListener()
</pre>


</div>

</div>

<div id="outline-container-3-4-8" class="outline-4">
<h4 id="sec-3-4-8"><span class="section-number-4">3.4.8</span> ListView</h4>
<div class="outline-text-4" id="text-3-4-8">

<p>ListView 的使用需要借助适配器，可以使用 ArrayAdapter 适配器，简单的使用 TextView，使用 <a href="#sec-8-2">BaseAdapter</a> 
可以自定义视图，是常用控件之一.
</p>

<ul>
<li id="sec-3-4-8-1">分页显示<br/>
在设置了 ListView 的数据后



<pre class="src src-java"><span style="color: #204A87;">//</span><span style="color: #204A87;">&#32473; listView &#28155;&#21152;&#20107;&#20214;&#30417;&#21548;&#65292;&#28369;&#21160;&#26102;&#30340;</span>
listView.setOnScrollListener(<span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">OnScrollListener</span>);
<span style="color: #204A87;">/*</span><span style="color: #204A87;">&#20854;&#20013;&#20004;&#20010;&#26041;&#27861;</span>
<span style="color: #204A87;">firstVisibleItem:&#24050;&#32463;&#20986;&#29616;&#36807;&#30340;&#19981;&#21487;&#35265;&#30340;&#25968;&#25454;&#20010;&#25968;</span>
<span style="color: #204A87;">visibleItemCount:&#21487;&#35265;&#30340;&#25968;&#25454;&#39033;&#20010;&#25968;</span>
<span style="color: #204A87;">totalItemCount:&#25968;&#25454;&#39033;&#24635;&#20010;&#25968;</span>
<span style="color: #204A87;">&#28369;&#21040;&#24213;&#37096;&#65306; firstVisibleItem + visibleItemCount = totalItemCount;</span>
<span style="color: #204A87;">*/</span>
OnScroll(<span style="color: #2F8B58; font-weight: bold;">AbsListView</span> <span style="color: #0084C8; font-weight: bold;">view</span>, <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">firstVisibleItem</span>, <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">visibleItemCount</span>,
         <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">totalItemCount</span>);
<span style="color: #204A87;">/*</span>
<span style="color: #204A87;">  SCROLL_STATE_TOUCH_SCROLL:&#29992;&#25163;&#28369;&#21160;&#23631;&#24149;&#65292;&#27809;&#26377;&#31163;&#24320;</span>
<span style="color: #204A87;">  SCROLL_STATE_IDLE:&#29992;&#25163;&#28369;&#21160;&#23631;&#24149;&#65292;&#20294;&#26159;&#24050;&#32463;&#26494;&#25163;</span>
<span style="color: #204A87;">  SCROLL_STATE_FLING: &#23631;&#24149;&#30340;&#24815;&#24615;&#28369;&#21160;</span>
<span style="color: #204A87;">*/</span>
OnScrollStateChanged(<span style="color: #2F8B58; font-weight: bold;">AbsListView</span> <span style="color: #0084C8; font-weight: bold;">view</span>, <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">scrollState</span>){
    <span style="color: #204A87;">//</span><span style="color: #204A87;">&#24403;&#24050;&#32463;&#28369;&#21040;&#25152;&#26377;&#25968;&#25454;&#39033;&#30340;&#24213;&#37096;&#24182;&#19988;&#24050;&#32463;&#26494;&#25163;&#26356;&#26032;&#25968;&#25454;</span>
}
</pre>

<p>
小例子
</p>


<pre class="src src-java">listView.setOnScrollListener(<span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #F5666D;">AbsListView</span>.<span style="color: #2F8B58; font-weight: bold;">OnScrollListener</span>() {
           <span style="color: #F5666D;">@Override</span>
           <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">void</span> <span style="color: #00578E; font-weight: bold;">onScrollStateChanged</span>(<span style="color: #2F8B58; font-weight: bold;">AbsListView</span> <span style="color: #0084C8; font-weight: bold;">view</span>, <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">scrollState</span>) {
               <span style="color: #A52A2A; font-weight: bold;">if</span> (isBottom &amp;&amp; scrollState == <span style="color: #F5666D;">AbsListView</span>.<span style="color: #F5666D;">OnScrollListener</span>.SCROLL_STATE_IDLE) {
                   Toast.makeText(getActivity().getApplicationContext(), <span style="color: #4E9A06;">"loading..."</span>, <span style="color: #F5666D;">Toast</span>.LENGTH_SHORT).show();
               }
           }

           <span style="color: #F5666D;">@Override</span>
           <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">void</span> <span style="color: #00578E; font-weight: bold;">onScroll</span>(<span style="color: #2F8B58; font-weight: bold;">AbsListView</span> <span style="color: #0084C8; font-weight: bold;">view</span>, <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">firstVisibleItem</span>, <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">visibleItemCount</span>, <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">totalItemCount</span>) {
               isBottom = (firstVisibleItem + visibleItemCount) == totalItemCount;
           }
       });
</pre>

</li>
</ul>
</div>

</div>

<div id="outline-container-3-4-9" class="outline-4">
<h4 id="sec-3-4-9"><span class="section-number-4">3.4.9</span> ProgressDialog</h4>
<div class="outline-text-4" id="text-3-4-9">

<p>进度对话框
</p>


<pre class="src src-java"><span style="color: #2F8B58; font-weight: bold;">Dialog</span> <span style="color: #0084C8; font-weight: bold;">dialog</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">ProgressDialog</span>(<span style="color: #A52A2A; font-weight: bold;">this</span>);
dialog.setTitle();
dialog.setMessage();
dialog.setProgressStyle(<span style="color: #F5666D;">setProgressStyle</span>.SYTLE...);
</pre>

<p>
<a href="#sec-13">异步任务相关</a>
</p>
</div>

</div>

<div id="outline-container-3-4-10" class="outline-4">
<h4 id="sec-3-4-10"><span class="section-number-4">3.4.10</span> GridView</h4>
<div class="outline-text-4" id="text-3-4-10">

<p>网格布局，相比 ListView 增加的属性
</p><table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" /><col class="left" />
</colgroup>
<tbody>
<tr><td class="left">属性</td><td class="left">描述</td></tr>
<tr><td class="left">numColumns</td><td class="left">列数</td></tr>
<tr><td class="left">horizontalSpacing</td><td class="left">水平间距</td></tr>
<tr><td class="left">verticalSpacing</td><td class="left">竖直间距</td></tr>
<tr><td class="left">columnWidth</td><td class="left">列宽</td></tr>
<tr><td class="left">stretchMode</td><td class="left">剩余宽度的分配方式</td></tr>
</tbody>
</table>


</div>

</div>

<div id="outline-container-3-4-11" class="outline-4">
<h4 id="sec-3-4-11"><span class="section-number-4">3.4.11</span> ScrollView</h4>
<div class="outline-text-4" id="text-3-4-11">

<ul>
<li>scrollbars="none"&ndash;删除滚动滑块
</li>
</ul>


</div>
</div>

</div>

<div id="outline-container-3-5" class="outline-3">
<h3 id="sec-3-5"><span class="section-number-3">3.5</span> 获取屏幕的长宽</h3>
<div class="outline-text-3" id="text-3-5">

</div>
</div>

</div>

<div id="outline-container-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Menu</h2>
<div class="outline-text-2" id="text-4">


</div>

<div id="outline-container-4-1" class="outline-3">
<h3 id="sec-4-1"><span class="section-number-3">4.1</span> 系统菜单</h3>
<div class="outline-text-3" id="text-4-1">

<p>位于menu下的main.xml,一个item就是一个菜单项
</p>
<p>
属性解释
</p><ul>
<li>showAsAction：是否时动作项
</li>
</ul>


<blockquote>

<p>在 Activity 中重写 onCreateOptionsMenu(Menu menu).
</p>
</blockquote>


<p>
事件监听 
</p><pre class="example">
onOptionsItemSelected
</pre>


</div>

<div id="outline-container-4-1-1" class="outline-4">
<h4 id="sec-4-1-1"><span class="section-number-4">4.1.1</span> 使用反射来显示菜单项的图标</h4>
<div class="outline-text-4" id="text-4-1-1">

</div>
</div>

</div>

<div id="outline-container-4-2" class="outline-3">
<h3 id="sec-4-2"><span class="section-number-3">4.2</span> <span class="target">上下文菜单</span></h3>
<div class="outline-text-3" id="text-4-2">

<ol>
<li>为UI视图注册上下文菜单,在长按时创建 
<pre class="example">
registerForContextMenu(view);
</pre>

</li>
<li>重写 
<pre class="example">
onCreateContextMenu(menu,view,menuInfo)
</pre>

</li>
<li>填充按钮UI
<pre class="example">
getMenuInflater().inflate(R.menu.main, menu)
</pre>

</li>
<li>重写 
<pre class="example">
onContextItemSelected(Menu item)
</pre>

</li>
</ol>


<p>
如果点击的是 ListView 的内容，那么下列代码可以得到 ListView 的 position
</p><pre class="example">
AdapterView.AdapterContextMenuInfo info = (AdapterView.AdapterContextMenuInfo) item.getMenuInfo(); 
</pre>


</div>

</div>

<div id="outline-container-4-3" class="outline-3">
<h3 id="sec-4-3"><span class="section-number-3">4.3</span> 弹出菜单 PopupMenu</h3>
<div class="outline-text-3" id="text-4-3">




<pre class="src src-java"><span style="color: #2F8B58; font-weight: bold;">PopupMenu</span> <span style="color: #0084C8; font-weight: bold;">pop</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">PopupMenu</span>(<span style="color: #A52A2A; font-weight: bold;">this</span>,v);
getMenuInflater().inflate(R.menu.main,pop.getMenu());
pop.setOnMenuItemClickListener(<span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">OnMenuItemClickLinstener</span>);    
</pre>


</div>
</div>

</div>

<div id="outline-container-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Dialog</h2>
<div class="outline-text-2" id="text-5">


</div>

<div id="outline-container-5-1" class="outline-3">
<h3 id="sec-5-1"><span class="section-number-3">5.1</span> AlertDialog</h3>
<div class="outline-text-3" id="text-5-1">

<p>对话框的初始化
</p><ul>
<li>创建对话框构建器对象
<pre class="example">
AlertDialog.Builder builder  = new AlertDialog.Builder(this);
</pre>

</li>
<li>使用对话框构建器对象初始化对话框的属性
<pre class="example">
builder.setTitle("name").setMessage("message").setIcon("图标”).setCancelable(false).setPositiveButton("确定",事件监听).set...
</pre>

</li>
<li>生成对话框
<pre class="example">
builder.create().show();
</pre>

</li>
</ul>


</div>

<div id="outline-container-5-1-1" class="outline-4">
<h4 id="sec-5-1-1"><span class="section-number-4">5.1.1</span> 连按回退键出现退出对话框</h4>
<div class="outline-text-4" id="text-5-1-1">




<pre class="src src-java"><span style="color: #F5666D;">@Override</span>
<span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">boolean</span> <span style="color: #00578E; font-weight: bold;">onKeyDown</span>(<span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">KeyCode</span>,<span style="color: #2F8B58; font-weight: bold;">KeyEvent</span> <span style="color: #0084C8; font-weight: bold;">event</span>){
    <span style="color: #A52A2A; font-weight: bold;">if</span>(KeyCode == <span style="color: #F5666D;">KeyEvent</span>.KEYCODE_BACK);
    dialog.show();
}
</pre>


</div>
</div>
</div>

</div>

<div id="outline-container-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> Notification</h2>
<div class="outline-text-2" id="text-6">

<p>Notification 就是通知。
</p>
</div>

<div id="outline-container-6-1" class="outline-3">
<h3 id="sec-6-1"><span class="section-number-3">6.1</span> 构建器</h3>
<div class="outline-text-3" id="text-6-1">




<pre class="src src-java"><span style="color: #F5666D;">NotificationCompat</span>.<span style="color: #2F8B58; font-weight: bold;">Builder</span> <span style="color: #0084C8; font-weight: bold;">builder</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #F5666D;">NotificationCompat</span>.<span style="color: #2F8B58; font-weight: bold;">Builder</span>(<span style="color: #A52A2A; font-weight: bold;">this</span>);
builder.setContentTitle();
builder.setContetnText();
builder.setSmallIcon();
builder.setOngoing(<span style="color: #F5666D;">true</span>);
<span style="color: #2F8B58; font-weight: bold;">Notification</span> <span style="color: #0084C8; font-weight: bold;">n</span> = builder.build();
<span style="color: #2F8B58; font-weight: bold;">NotificationManager</span> <span style="color: #0084C8; font-weight: bold;">manager</span> = getSystemService(Content.xxxNOTIFICATION_SERVICE);
manager.notify();
</pre>

</div>

</div>

<div id="outline-container-6-2" class="outline-3">
<h3 id="sec-6-2"><span class="section-number-3">6.2</span> 显示带详情的通知/点击之后出现详情页</h3>
<div class="outline-text-3" id="text-6-2">




<pre class="src src-java"><span style="color: #F5666D;">NotificationCompat</span>.<span style="color: #2F8B58; font-weight: bold;">Builder</span> <span style="color: #0084C8; font-weight: bold;">builder</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #F5666D;">NotificationCompat</span>.<span style="color: #2F8B58; font-weight: bold;">Builder</span>(<span style="color: #A52A2A; font-weight: bold;">this</span>);
builder.setContentTitle().setContentText().setSmallIcon()
    .setDefaults(<span style="color: #F5666D;">Notification</span>.DEFAULT_ALL);
<span style="color: #2F8B58; font-weight: bold;">Intent</span> <span style="color: #0084C8; font-weight: bold;">intent</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">Intent</span>(<span style="color: #A52A2A; font-weight: bold;">this</span>,MainActivity.<span style="color: #A52A2A; font-weight: bold;">class</span>);
    <span style="color: #204A87;">//</span><span style="color: #204A87;">&#24403;&#36890;&#30693;&#34987;&#28857;&#20987;&#26102;&#65292;&#33258;&#21160;&#25191;&#34892; startActivity</span>
<span style="color: #2F8B58; font-weight: bold;">PendingIntent</span> <span style="color: #0084C8; font-weight: bold;">pendingIntent</span> = PendingIntent.getActivity(<span style="color: #A52A2A; font-weight: bold;">this</span>,6,intent,<span style="color: #F5666D;">PendingIntent</span>.FLAG);
builder.setContentIntent(pending);
builder.setAutoCancel(<span style="color: #F5666D;">true</span>);
<span style="color: #2F8B58; font-weight: bold;">Notification</span> <span style="color: #0084C8; font-weight: bold;">notification</span> = builder.build();
<span style="color: #2F8B58; font-weight: bold;">NotificationManager</span> <span style="color: #0084C8; font-weight: bold;">manager</span> = ...;
manager.notify(88,notification);

</pre>

</div>
</div>

</div>

<div id="outline-container-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> Toast</h2>
<div class="outline-text-2" id="text-7">


</div>

<div id="outline-container-7-1" class="outline-3">
<h3 id="sec-7-1"><span class="section-number-3">7.1</span> 拥有自定义布局的 toast</h3>
<div class="outline-text-3" id="text-7-1">




<pre class="src src-java"><span style="color: #2F8B58; font-weight: bold;">Toast</span> <span style="color: #0084C8; font-weight: bold;">toast</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">Toast</span>(<span style="color: #A52A2A; font-weight: bold;">this</span>);
<span style="color: #2F8B58; font-weight: bold;">View</span> <span style="color: #0084C8; font-weight: bold;">view</span> = getLayoutInflater().inflate(R.layout.xxx,<span style="color: #F5666D;">null</span>);
toast.setView(view);
toast.setGravity(<span style="color: #F5666D;">Gravity</span>.CENTER,0,0);
toast.setDuration(<span style="color: #F5666D;">Toast</span>.LENGTH_SHORT);
toast.show();
</pre>



</div>
</div>

</div>

<div id="outline-container-8" class="outline-2">
<h2 id="sec-8"><span class="section-number-2">8</span> <span class="target">Adapter</span>  适配器</h2>
<div class="outline-text-2" id="text-8">


</div>

<div id="outline-container-8-1" class="outline-3">
<h3 id="sec-8-1"><span class="section-number-3">8.1</span> ArrayAdapter</h3>
<div class="outline-text-3" id="text-8-1">

<p>一般步骤
</p><ol>
<li>创建一个 ArrayAdapter 对象,放入参数
</li>
<li>找到需要添加适配器的控件 id
</li>
<li>使用 setAdapter()方法添加适配器
</li>
</ol>

</div>

</div>

<div id="outline-container-8-2" class="outline-3">
<h3 id="sec-8-2"><span class="section-number-3">8.2</span> <span class="target">BaseAdapter</span></h3>
<div class="outline-text-3" id="text-8-2">

<p>ArrayAdapter 中只能添加 TextView ，对于自定义列表来说尚有不足，
所以使用 BaseAdapter 来自定义
</p>
<p>
继承自 BaseAdapter 的类需要实现的方法有
</p><table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" /><col class="left" />
</colgroup>
<thead>
<tr><th scope="col" class="left">method</th><th scope="col" class="left">disription</th></tr>
</thead>
<tbody>
<tr><td class="left">public int getCount()</td><td class="left">返回 list 的个数</td></tr>
<tr><td class="left">public Object getItem(int position)</td><td class="left">返回 list.get(position)</td></tr>
<tr><td class="left">public long getItemId(int position</td><td class="left">返回 position</td></tr>
<tr><td class="left">public View getView(int position, View convertView, ViewGroup parent)</td><td class="left"></td></tr>
</tbody>
</table>


<pre class="example">
重点解释最后一个
</pre>


<p>
更新一下防止图片错位的方法，主要是为View添加一个url（图片下载路径），记录一下代码
</p>


<pre class="src src-java"><span style="color: #F5666D;">@Override</span>
    <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">View</span> <span style="color: #00578E; font-weight: bold;">getView</span>(<span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">position</span>, <span style="color: #2F8B58; font-weight: bold;">View</span> <span style="color: #0084C8; font-weight: bold;">convertView</span>,<span style="color: #A52A2A; font-weight: bold;">final</span> <span style="color: #2F8B58; font-weight: bold;">ViewGroup</span> <span style="color: #0084C8; font-weight: bold;">parent</span>) {
        <span style="color: #204A87;">//</span><span style="color: #204A87;">&#36716;&#21270;&#20026;view&#25511;&#20214;&#65292;&#24182;&#36820;&#22238;</span>
        <span style="color: #2F8B58; font-weight: bold;">ViewHolder</span> <span style="color: #0084C8; font-weight: bold;">viewHolder</span> = <span style="color: #F5666D;">null</span>;
        <span style="color: #A52A2A; font-weight: bold;">if</span>(convertView == <span style="color: #F5666D;">null</span>){
            convertView = LayoutInflater.from(context).inflate(R.layout.item_data,<span style="color: #F5666D;">null</span>);
            viewHolder = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">ViewHolder</span>();
            viewHolder.titleTv = (<span style="color: #2F8B58; font-weight: bold;">TextView</span>) convertView.findViewById(R.id.titleId);
            viewHolder.infoTv = (<span style="color: #2F8B58; font-weight: bold;">TextView</span>) convertView.findViewById(R.id.infoId);
            viewHolder.coverImgView = (<span style="color: #2F8B58; font-weight: bold;">ImageView</span>) convertView.findViewById(R.id.coverId);
            <span style="color: #204A87;">//</span><span style="color: #204A87;">view &#30340;tag</span>
            convertView.setTag(viewHolder);
        }<span style="color: #A52A2A; font-weight: bold;">else</span>{
            <span style="color: #204A87;">//</span><span style="color: #204A87;">&#33719;&#24471; view &#30340; tag</span>
            viewHolder = (<span style="color: #2F8B58; font-weight: bold;">ViewHolder</span>) convertView.getTag();
            <span style="color: #204A87;">//</span><span style="color: #204A87;">&#37325;&#32622;&#22270;&#29255;&#30340;&#20869;&#23481;</span>
            viewHolder.coverImgView.setImageResource(R.drawable.ic_launcher);
        }
        <span style="color: #204A87;">//</span><span style="color: #204A87;">&#35774;&#32622;&#26174;&#31034;&#20869;&#23481;</span>
        viewHolder.titleTv.setText(datas.get(position).getTitle());
        viewHolder.infoTv.setText(datas.get(position).getInfo());

        <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">imaPath</span> = datas.get(position).getWap_thumb();
        <span style="color: #204A87;">//</span><span style="color: #204A87;">&#32473; ImageView &#28155;&#21152; tag</span>
        viewHolder.coverImgView.setTag(imaPath);
        <span style="color: #A52A2A; font-weight: bold;">if</span> (imaPath != <span style="color: #F5666D;">null</span>){
            <span style="color: #A52A2A; font-weight: bold;">if</span>(imaPath.length()&gt;10){
                <span style="color: #204A87;">//</span><span style="color: #204A87;">&#23384;&#22312;&#22270;&#29255;&#36335;&#24452;</span>
                viewHolder.coverImgView.setVisibility(<span style="color: #F5666D;">View</span>.VISIBLE);
                <span style="color: #204A87;">//</span><span style="color: #204A87;">&#20808;&#20174;SD&#21345;&#35835;&#21462;&#65292;&#22312;&#19979;&#36733;</span>
                <span style="color: #A52A2A; font-weight: bold;">final</span> <span style="color: #2F8B58; font-weight: bold;">Bitmap</span> <span style="color: #0084C8; font-weight: bold;">bitmap</span> = ImageUtils.getImg(imaPath);
                <span style="color: #A52A2A; font-weight: bold;">if</span>(bitmap!=<span style="color: #F5666D;">null</span>){
                    viewHolder.coverImgView.setImageBitmap(bitmap);
                }<span style="color: #A52A2A; font-weight: bold;">else</span>{
                    NUtils.get(<span style="color: #F5666D;">NUtils</span>.TYPE_IMG,imaPath, <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #F5666D;">NUtils</span>.<span style="color: #2F8B58; font-weight: bold;">Callback</span>() {
                        <span style="color: #F5666D;">@Override</span>
                        <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">boolean</span> <span style="color: #00578E; font-weight: bold;">isCancelled</span>(<span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">url</span>) {
                            <span style="color: #A52A2A; font-weight: bold;">return</span> parent.findViewWithTag(url)==<span style="color: #F5666D;">null</span>;
                        }
                        <span style="color: #F5666D;">@Override</span>
                        <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">void</span> <span style="color: #00578E; font-weight: bold;">response</span>(<span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">url</span>, <span style="color: #2F8B58; font-weight: bold;">byte</span>[] <span style="color: #0084C8; font-weight: bold;">bytes</span>) <span style="color: #A52A2A; font-weight: bold;">throws</span> <span style="color: #2F8B58; font-weight: bold;">UnsupportedEncodingException</span>, <span style="color: #2F8B58; font-weight: bold;">JSONException</span> {
                            <span style="color: #2F8B58; font-weight: bold;">ImageView</span> <span style="color: #0084C8; font-weight: bold;">imageView</span> = (<span style="color: #2F8B58; font-weight: bold;">ImageView</span>) parent.findViewWithTag(url);
                            <span style="color: #A52A2A; font-weight: bold;">if</span>(imageView != <span style="color: #F5666D;">null</span>){
                                imageView.setImageBitmap(BitmapFactory.decodeByteArray(bytes,0,bytes.length));
                            }
                        }
                    });
                }
            }<span style="color: #A52A2A; font-weight: bold;">else</span>{
                viewHolder.coverImgView.setVisibility(<span style="color: #F5666D;">View</span>.GONE);
            }
        }<span style="color: #A52A2A; font-weight: bold;">else</span>{
            viewHolder.coverImgView.setVisibility(<span style="color: #F5666D;">View</span>.GONE);
        }
        <span style="color: #A52A2A; font-weight: bold;">return</span> convertView;
}
</pre>

<blockquote>

<p>PS: 分页需要一个List用来存放数据，并且需要服务端提供分页的接口
</p>
</blockquote>


</div>

</div>

<div id="outline-container-8-3" class="outline-3">
<h3 id="sec-8-3"><span class="section-number-3">8.3</span> SimpleAdapter</h3>
<div class="outline-text-3" id="text-8-3">

<p>一个简单的自定义适配器
</p>
</div>

<div id="outline-container-8-3-1" class="outline-4">
<h4 id="sec-8-3-1"><span class="section-number-4">8.3.1</span> 构造方法的参数 Context，list&lt;Map&gt;，布局文件，from，to</h4>
<div class="outline-text-4" id="text-8-3-1">

<pre class="example">
from：Map中的键 
to: 相应填充控件的id
</pre>

</div>
</div>

</div>

<div id="outline-container-8-4" class="outline-3">
<h3 id="sec-8-4"><span class="section-number-3">8.4</span> SimpleCursorAdapter</h3>
<div class="outline-text-3" id="text-8-4">

<p>内部使用 CursorLoader 查询的 Adapter
</p>
<p>
构造方法
</p><pre class="example">
SimpleCursorAdapter(Context context, int layout, Cursor c, String[] from, int[] to, int flags)
</pre>


<p>
小例子
</p>


<pre class="src src-java"><span style="color: #204A87;">//</span><span style="color: #204A87;">&#33719;&#21462;&#25193;&#23637;&#21345;&#19979;&#25152;&#26377;&#38899;&#39057;&#25991;&#20214;</span>
<span style="color: #A52A2A; font-weight: bold;">private</span> <span style="color: #2F8B58; font-weight: bold;">Uri</span> <span style="color: #0084C8; font-weight: bold;">mp3Uri</span> = <span style="color: #F5666D;">MediaStore</span>.<span style="color: #F5666D;">Audio</span>.<span style="color: #F5666D;">Media</span>.EXTERNAL_CONTENT_URI;
<span style="color: #A52A2A; font-weight: bold;">private</span> <span style="color: #2F8B58; font-weight: bold;">String</span>[] <span style="color: #0084C8; font-weight: bold;">columns</span> = {<span style="color: #F5666D;">MediaStore</span>.<span style="color: #F5666D;">Audio</span>.Media._ID,
        <span style="color: #F5666D;">MediaStore</span>.<span style="color: #F5666D;">Audio</span>.<span style="color: #F5666D;">Media</span>.DISPLAY_NAME,
        <span style="color: #F5666D;">MediaStore</span>.<span style="color: #F5666D;">Audio</span>.<span style="color: #F5666D;">Media</span>.DATA,
        <span style="color: #F5666D;">MediaStore</span>.<span style="color: #F5666D;">Audio</span>.<span style="color: #F5666D;">Media</span>.DURATION};

<span style="color: #2F8B58; font-weight: bold;">SimpleCursorAdapter</span> <span style="color: #0084C8; font-weight: bold;">cursorAdapter</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">SimpleCursorAdapter</span>(getApplicationContext(),R.layout.item_audio,<span style="color: #F5666D;">null</span>,
                                     <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">String</span>[]{columns[1],columns[2],columns[3]},
                                     <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">int</span>[]{R.id.textNameId,R.id.textPathId,R.id.textDurationId},
                                     <span style="color: #F5666D;">SimpleCursorAdapter</span>.FLAG_REGISTER_CONTENT_OBSERVER);
listview.setAdapter(cursorAdapter);
</pre>

</div>

</div>

<div id="outline-container-8-5" class="outline-3">
<h3 id="sec-8-5"><span class="section-number-3">8.5</span> 重构适配器</h3>
<div class="outline-text-3" id="text-8-5">




<pre class="src src-java"><span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #A52A2A; font-weight: bold;">abstract</span> <span style="color: #A52A2A; font-weight: bold;">class</span> <span style="color: #2F8B58; font-weight: bold;">AbsAdapter</span>&lt;T&gt; <span style="color: #A52A2A; font-weight: bold;">extends</span> <span style="color: #2F8B58; font-weight: bold;">BaseAdapter</span> {

    <span style="color: #A52A2A; font-weight: bold;">private</span> <span style="color: #2F8B58; font-weight: bold;">Context</span> <span style="color: #0084C8; font-weight: bold;">context</span>; <span style="color: #204A87;">//</span><span style="color: #204A87;">&#19978;&#19979;&#25991;&#23545;&#35937;</span>
    <span style="color: #A52A2A; font-weight: bold;">private</span> <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">layoutResId</span>; <span style="color: #204A87;">//</span><span style="color: #204A87;">item&#24067;&#23616;&#36164;&#28304;</span>
    <span style="color: #A52A2A; font-weight: bold;">private</span> <span style="color: #2F8B58; font-weight: bold;">List</span>&lt;T&gt; datas; <span style="color: #204A87;">//</span><span style="color: #204A87;">&#25968;&#25454;&#28304;</span>

    <span style="color: #A52A2A; font-weight: bold;">public</span> AbsAdapter(<span style="color: #2F8B58; font-weight: bold;">Context</span> <span style="color: #0084C8; font-weight: bold;">context</span>, <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">layoutResId</span>, List&lt;T&gt; datas) {
        <span style="color: #A52A2A; font-weight: bold;">this</span>.context = context;
        <span style="color: #A52A2A; font-weight: bold;">this</span>.layoutResId = layoutResId;
        <span style="color: #A52A2A; font-weight: bold;">this</span>.datas = datas;
    }

    <span style="color: #F5666D;">@Override</span>
    <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">getCount</span>() {
        <span style="color: #A52A2A; font-weight: bold;">return</span> datas.size();
    }

    <span style="color: #F5666D;">@Override</span>
    <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">Object</span> <span style="color: #0084C8; font-weight: bold;">getItem</span>(<span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">position</span>) {
        <span style="color: #A52A2A; font-weight: bold;">return</span> datas.get(position);
    }

    <span style="color: #F5666D;">@Override</span>
    <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">long</span> <span style="color: #0084C8; font-weight: bold;">getItemId</span>(<span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">position</span>) {
        <span style="color: #A52A2A; font-weight: bold;">return</span> position;
    }

    <span style="color: #F5666D;">@Override</span>
    <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">View</span> <span style="color: #0084C8; font-weight: bold;">getView</span>(<span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">position</span>, <span style="color: #2F8B58; font-weight: bold;">View</span> <span style="color: #0084C8; font-weight: bold;">convertView</span>, <span style="color: #2F8B58; font-weight: bold;">ViewGroup</span> <span style="color: #0084C8; font-weight: bold;">parent</span>) {
        <span style="color: #2F8B58; font-weight: bold;">ViewHolder</span> <span style="color: #0084C8; font-weight: bold;">vHolder</span>=<span style="color: #F5666D;">null</span>;
        <span style="color: #A52A2A; font-weight: bold;">if</span>(convertView==<span style="color: #F5666D;">null</span>){
            convertView= LayoutInflater.from(context).inflate(layoutResId, parent,<span style="color: #F5666D;">false</span>);
            vHolder=<span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">ViewHolder</span>(convertView);

            convertView.setTag(vHolder);
        }<span style="color: #A52A2A; font-weight: bold;">else</span>{
            vHolder=(<span style="color: #2F8B58; font-weight: bold;">ViewHolder</span>) convertView.getTag();
        }

        bindView(vHolder,datas.get(position)); <span style="color: #204A87;">//</span><span style="color: #204A87;">&#23558;&#25968;&#25454;&#26174;&#31034;&#21040;item&#24067;&#23616;&#20013;</span>

        <span style="color: #A52A2A; font-weight: bold;">return</span> convertView;
    }

    <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #A52A2A; font-weight: bold;">abstract</span> <span style="color: #2F8B58; font-weight: bold;">void</span> <span style="color: #0084C8; font-weight: bold;">bindView</span>(<span style="color: #2F8B58; font-weight: bold;">ViewHolder</span> <span style="color: #0084C8; font-weight: bold;">vHolder</span>,<span style="color: #2F8B58; font-weight: bold;">T</span> <span style="color: #0084C8; font-weight: bold;">data</span>);

    <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #A52A2A; font-weight: bold;">static</span> <span style="color: #A52A2A; font-weight: bold;">class</span> <span style="color: #2F8B58; font-weight: bold;">ViewHolder</span>{
        <span style="color: #A52A2A; font-weight: bold;">private</span> <span style="color: #2F8B58; font-weight: bold;">Map</span>&lt;Integer,View&gt; cacheViews;
        <span style="color: #A52A2A; font-weight: bold;">private</span> <span style="color: #2F8B58; font-weight: bold;">View</span> <span style="color: #0084C8; font-weight: bold;">itemView</span>;

        <span style="color: #A52A2A; font-weight: bold;">public</span> ViewHolder(<span style="color: #2F8B58; font-weight: bold;">View</span> <span style="color: #0084C8; font-weight: bold;">itemView</span>){
            <span style="color: #A52A2A; font-weight: bold;">this</span>.itemView=itemView;
            cacheViews=<span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">HashMap</span>&lt;Integer,View&gt;();
        }

        <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">View</span> <span style="color: #00578E; font-weight: bold;">getView</span>(<span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">id</span>){ <span style="color: #204A87;">//</span><span style="color: #204A87;">&#26597;&#25214;&#25351;&#23450;id&#30340;item&#20013;&#23376;&#25511;&#20214;</span>
            <span style="color: #2F8B58; font-weight: bold;">View</span> <span style="color: #0084C8; font-weight: bold;">v</span>=cacheViews.get(id);
            <span style="color: #A52A2A; font-weight: bold;">if</span>(v==<span style="color: #F5666D;">null</span>){
                v=itemView.findViewById(id);
                <span style="color: #A52A2A; font-weight: bold;">if</span>(v!=<span style="color: #F5666D;">null</span>){
                    cacheViews.put(id, v);
                }
            }

            <span style="color: #A52A2A; font-weight: bold;">return</span> v;
        }
    }

}
</pre>

</div>
</div>

</div>

<div id="outline-container-9" class="outline-2">
<h2 id="sec-9"><span class="section-number-2">9</span> 数据存储</h2>
<div class="outline-text-2" id="text-9">


</div>

<div id="outline-container-9-1" class="outline-3">
<h3 id="sec-9-1"><span class="section-number-3">9.1</span> 使用 adb 查看App内的文件</h3>
<div class="outline-text-3" id="text-9-1">

<p>知晓adb 的命令
</p></div>

</div>

<div id="outline-container-9-2" class="outline-3">
<h3 id="sec-9-2"><span class="section-number-3">9.2</span> 内部存储</h3>
<div class="outline-text-3" id="text-9-2">

<p>以文件的形式存储数据， IO 流
</p>
</div>

<div id="outline-container-9-2-1" class="outline-4">
<h4 id="sec-9-2-1"><span class="section-number-4">9.2.1</span> 存数据</h4>
<div class="outline-text-4" id="text-9-2-1">




<pre class="src src-java"><span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">filename</span> = <span style="color: #4E9A06;">"filename"</span>;
<span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">fileContent</span> = <span style="color: #4E9A06;">"fileContent"</span>;
<span style="color: #2F8B58; font-weight: bold;">FileOutputStream</span> <span style="color: #0084C8; font-weight: bold;">fos</span> = openFileOutput(filename,<span style="color: #F5666D;">Context</span>.MODE_PRIVATE);
fos.write(fileContent.getBytes());
fos.close();
</pre>

</div>

</div>

<div id="outline-container-9-2-2" class="outline-4">
<h4 id="sec-9-2-2"><span class="section-number-4">9.2.2</span> 读数据</h4>
<div class="outline-text-4" id="text-9-2-2">




<pre class="src src-java"><span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">filename</span> = <span style="color: #4E9A06;">"filenameToRead"</span>;

<span style="color: #2F8B58; font-weight: bold;">FileInputStream</span> <span style="color: #0084C8; font-weight: bold;">fis</span> = openFileInput(filename);
<span style="color: #2F8B58; font-weight: bold;">byte</span>[] <span style="color: #0084C8; font-weight: bold;">arr</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">byte</span>[fis.available()];
<span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">len</span> = fis.read(arr);
<span style="color: #204A87;">//</span><span style="color: #204A87;">&#20877;&#23558;&#20869;&#23481;&#20889;&#20837;&#21040;&#38656;&#35201;&#20889;&#20837;&#30340; View &#20013;&#12290;</span>
</pre>


</div>

</div>

<div id="outline-container-9-2-3" class="outline-4">
<h4 id="sec-9-2-3"><span class="section-number-4">9.2.3</span> 内部控件所有文件名</h4>
<div class="outline-text-4" id="text-9-2-3">


</div>
</div>

</div>

<div id="outline-container-9-3" class="outline-3">
<h3 id="sec-9-3"><span class="section-number-3">9.3</span> 外部存储</h3>
<div class="outline-text-3" id="text-9-3">

<p>判断扩展卡是否挂载
</p>

</div>

<div id="outline-container-9-3-1" class="outline-4">
<h4 id="sec-9-3-1"><span class="section-number-4">9.3.1</span> 扩展卡中文件操作的<a href="#sec-25">工具类</a></h4>
<div class="outline-text-4" id="text-9-3-1">






</div>
</div>

</div>

<div id="outline-container-9-4" class="outline-3">
<h3 id="sec-9-4"><span class="section-number-3">9.4</span> <span class="target">数据库存储</span></h3>
<div class="outline-text-3" id="text-9-4">

<p>在创建数据库的实体类后，
</p>


<pre class="src src-java"><span style="color: #204A87;">//</span><span style="color: #204A87;">&#25968;&#25454;&#24211;&#25805;&#20316;&#31867; SQLiteDatabase</span>

<span style="color: #A52A2A; font-weight: bold;">public</span> staic <span style="color: #A52A2A; font-weight: bold;">final</span> <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">DB_PATH</span> = Environment.getExternalStorageDirectory()+<span style="color: #4E9A06;">"/file/db/xx.db"</span>;

<span style="color: #204A87;">//</span><span style="color: #204A87;">&#25171;&#24320;&#25968;&#25454;&#24211; &#21442;&#25968;&#65306; &#36335;&#24452; &#65292; &#31649;&#29702;&#28216;&#26631;&#24037;&#21378; &#65292; &#25805;&#20316;&#25968;&#25454;&#24211;&#30340;&#27169;&#24335;</span>
<span style="color: #2F8B58; font-weight: bold;">SQLiteDatabase</span> <span style="color: #0084C8; font-weight: bold;">db</span> = SQLiteDatabase.openDatabase(DB_PATH,<span style="color: #F5666D;">null</span>,<span style="color: #F5666D;">SQLiteDatabase</span>.OPEN_READONLYWRITE);

<span style="color: #204A87;">//</span><span style="color: #204A87;">&#26597;&#35810;&#34920;&#20013;&#30340;&#25968;&#25454;,&#25968;&#25454;&#25918;&#20110; Cursor</span>
<span style="color: #2F8B58; font-weight: bold;">Cursor</span> <span style="color: #0084C8; font-weight: bold;">cursor</span>  = db.rawQuery(<span style="color: #4E9A06;">"select * from student"</span>,<span style="color: #F5666D;">null</span>);
<span style="color: #204A87;">//</span><span style="color: #204A87;">&#20174; Cursor &#20013;&#33719;&#21462;&#35760;&#24405;</span>
<span style="color: #A52A2A; font-weight: bold;">while</span>(cursor.moveToNext()){
    <span style="color: #204A87;">//</span><span style="color: #204A87;">&#20351;&#29992;&#28216;&#26631;&#35760;&#24405;&#20013;&#27599;&#20010;&#23383;&#27573;&#19978;&#30340;&#20540; &#35748;&#20026;_id &#23601;&#26159;&#19968;&#20010;&#23383;&#27573;</span>
    <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">id</span> = cursor.getInt(cursor.getColumnIndex(<span style="color: #4E9A06;">"_id"</span>));
    <span style="color: #204A87;">//</span><span style="color: #204A87;">&#23558;&#32467;&#26524;&#25918;&#20837;&#23454;&#20307;&#31867;&#20013;</span>
    <span style="color: #2F8B58; font-weight: bold;">Object</span> <span style="color: #0084C8; font-weight: bold;">o</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">Object</span>(id);
    <span style="color: #204A87;">//</span><span style="color: #204A87;">&#38656;&#35201;&#25918;&#20837;&#38598;&#21512;&#20013;&#20877;&#25918;&#20837;&#38598;&#21512;</span>
    list.add(o);
}

<span style="color: #204A87;">//</span><span style="color: #204A87;">&#22686;&#21152;</span>
db.execSQL(<span style="color: #4E9A06;">"insert into tablename values(?,?,?,?,?)"</span>,<span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">Object</span>[]{4,<span style="color: #4E9A06;">"ll"</span>,<span style="color: #4E9A06;">"nan"</span>,44,4443103});

<span style="color: #204A87;">//</span><span style="color: #204A87;">or</span>

<span style="color: #2F8B58; font-weight: bold;">ContentValue</span> <span style="color: #0084C8; font-weight: bold;">values</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">ContentValue</span>();
values.put(<span style="color: #4E9A06;">"_id"</span>,5);
<span style="color: #2F8B58; font-weight: bold;">long</span> <span style="color: #0084C8; font-weight: bold;">num</span> = db.insert(<span style="color: #4E9A06;">"student,null,values"</span>);
<span style="color: #A52A2A; font-weight: bold;">if</span>(num != -1)
<span style="color: #204A87;">//</span><span style="color: #204A87;">&#28155;&#21152;&#25104;&#21151;</span>

<span style="color: #204A87;">//</span><span style="color: #204A87;">&#20462;&#25913;</span>
db.execSQL(<span style="color: #4E9A06;">"update tablename set age=?,_id=?   where _id=?"</span>,<span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">Objext</span>[]{45,_id});
db.update();
<span style="color: #204A87;">//</span><span style="color: #204A87;">&#21024;&#38500;</span>
db.execSQL(<span style="color: #4E9A06;">"delete from student where _id=?"</span>, <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">Objext</span>[]{});
db.delete(<span style="color: #4E9A06;">"student"</span>,<span style="color: #4E9A06;">"_id="</span>+id,<span style="color: #F5666D;">null</span>);

<span style="color: #204A87;">//</span><span style="color: #204A87;">&#38543;&#21518;&#37325;&#26032;&#26597;&#35810;; </span>


db.close();

</pre>



<pre class="src src-java"><span style="color: #204A87;">//</span><span style="color: #204A87;">&#25968;&#25454;&#24211;&#31649;&#29702;&#31867; SQLiteOpenHelper</span>
DBHelper <span style="color: #A52A2A; font-weight: bold;">extends</span> <span style="color: #2F8B58; font-weight: bold;">SQLiteOpenHelper</span>{
    <span style="color: #A52A2A; font-weight: bold;">public</span> DBHelper(<span style="color: #2F8B58; font-weight: bold;">Context</span> <span style="color: #0084C8; font-weight: bold;">context</span>){
        <span style="color: #204A87;">//</span><span style="color: #204A87;">name &#23601;&#26159;&#25968;&#25454;&#24211;&#21517;&#23383;&#65292;&#28216;&#26631;&#21462; null&#65292;&#29256;&#26412; 1.</span>
        <span style="color: #A52A2A; font-weight: bold;">super</span>(context,name,factory,version);
    }
    <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">void</span> <span style="color: #0084C8; font-weight: bold;">onCreate</span>(<span style="color: #2F8B58; font-weight: bold;">SQLiteDatabase</span> <span style="color: #0084C8; font-weight: bold;">db</span>){
        db.execSQL(<span style="color: #4E9A06;">"create table t_user(_id integer primary key,name text)"</span>);
    }
    <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">void</span> <span style="color: #0084C8; font-weight: bold;">onUpgrade</span>(<span style="color: #2F8B58; font-weight: bold;">SQLiteDatabase</span> <span style="color: #0084C8; font-weight: bold;">db</span>, <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">oldVersion</span>, <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">newVersion</span>){
        <span style="color: #A52A2A; font-weight: bold;">if</span>(newVersion&gt;oldVersion){
            db.execSQL(<span style="color: #4E9A06;">"drop table if exists t_user"</span>);
        }
    }
}
</pre>

</div>

</div>

<div id="outline-container-9-5" class="outline-3">
<h3 id="sec-9-5"><span class="section-number-3">9.5</span> 共享参数 SharedPreferences</h3>
<div class="outline-text-3" id="text-9-5">


</div>

<div id="outline-container-9-5-1" class="outline-4">
<h4 id="sec-9-5-1"><span class="section-number-4">9.5.1</span> 存数据</h4>
<div class="outline-text-4" id="text-9-5-1">




<pre class="src src-java"><span style="color: #204A87;">//</span><span style="color: #204A87;">&#20849;&#20139;&#21442;&#25968;&#25991;&#20214;&#30340;&#21517;&#23383;&#65292;&#23545;&#35813;&#25991;&#20214;&#30340;&#25805;&#20316;&#27169;&#24335;</span>
<span style="color: #2F8B58; font-weight: bold;">SharedPerferences</span> <span style="color: #0084C8; font-weight: bold;">shared</span> = getSharePreference(<span style="color: #4E9A06;">"configration"</span>,<span style="color: #F5666D;">Context</span>.MODE_PRIVATE);<span style="color: #204A87;">//</span><span style="color: #204A87;">MODE.xxx</span>
<span style="color: #F5666D;">SHaredPerferences</span>.<span style="color: #2F8B58; font-weight: bold;">Editor</span> <span style="color: #0084C8; font-weight: bold;">edit</span> = shared.edit();
edit.putInt(key,value);
edit.commit();
</pre>

</div>

</div>

<div id="outline-container-9-5-2" class="outline-4">
<h4 id="sec-9-5-2"><span class="section-number-4">9.5.2</span> 读数据</h4>
<div class="outline-text-4" id="text-9-5-2">




<pre class="src src-java"><span style="color: #2F8B58; font-weight: bold;">sharedPerferences</span> <span style="color: #0084C8; font-weight: bold;">shared</span> = getSharePreference(<span style="color: #4E9A06;">"configration"</span>,<span style="color: #F5666D;">Context</span>.MODE_PRIVATE);
<span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">i</span> = shared.getFloat(<span style="color: #4E9A06;">"key"</span>,value);<span style="color: #204A87;">//</span><span style="color: #204A87;">&#19981;&#23384;&#22312;key&#23545;&#24212;&#30340;&#20540;&#26102;&#20351;&#29992;&#31532;&#20108;&#20010;&#20540;</span>
</pre>


</div>
</div>
</div>

</div>

<div id="outline-container-10" class="outline-2">
<h2 id="sec-10"><span class="section-number-2">10</span> <span class="target">Fragment</span></h2>
<div class="outline-text-2" id="text-10">

<p>可以当成 Activity 使用，但是 Fragment 是显示在 Activity 中的。
</p>
</div>

<div id="outline-container-10-1" class="outline-3">
<h3 id="sec-10-1"><span class="section-number-3">10.1</span> 如何开始</h3>
<div class="outline-text-3" id="text-10-1">

<p>新建一个继承 Fragment 的子类，重写 onCreateView 方法
</p>


<pre class="src src-java"><span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">View</span> <span style="color: #00578E; font-weight: bold;">onCreateView</span>(<span style="color: #2F8B58; font-weight: bold;">LayoutInflater</span> <span style="color: #0084C8; font-weight: bold;">inflater</span>,<span style="color: #2F8B58; font-weight: bold;">ViewGroup</span> <span style="color: #0084C8; font-weight: bold;">container</span>,<span style="color: #2F8B58; font-weight: bold;">Bundle</span> <span style="color: #0084C8; font-weight: bold;">savedInstanceState</span>){
    <span style="color: #2F8B58; font-weight: bold;">TextView</span> <span style="color: #0084C8; font-weight: bold;">textView</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">TextView</span>(getActivity());
    textView.setWidth(50);
    textView.setHeight(50);
    textView.setTextSize(20sp);
    textView.setText(<span style="color: #4E9A06;">"fragment"</span>);
    <span style="color: #A52A2A; font-weight: bold;">return</span> textView;
}
</pre>

<p>
或者为 Fragment 设置一个布局，可以直接 return inflater.inflate(R.layout.name,null)
</p></div>

</div>

<div id="outline-container-10-2" class="outline-3">
<h3 id="sec-10-2"><span class="section-number-3">10.2</span> 将 Fragment 显示到 Activity 上的两种方式</h3>
<div class="outline-text-3" id="text-10-2">


</div>

<div id="outline-container-10-2-1" class="outline-4">
<h4 id="sec-10-2-1"><span class="section-number-4">10.2.1</span> 静态方式</h4>
<div class="outline-text-4" id="text-10-2-1">

<p>在 Activity 的布局文件中加入 fragment 标签，并在name中添加 Fragment 的包名+类名.
</p></div>

</div>

<div id="outline-container-10-2-2" class="outline-4">
<h4 id="sec-10-2-2"><span class="section-number-4">10.2.2</span> 动态方式</h4>
<div class="outline-text-4" id="text-10-2-2">

<p>动态显示 fragment 需要定义一个布局，用来放置 fragment .
可以使用容器视图来放置。
</p>
<p>
随后在 Activity 中得到
</p>


<pre class="src src-java"><span style="color: #2F8B58; font-weight: bold;">FragmentManager</span> <span style="color: #0084C8; font-weight: bold;">manager</span> = getFragmentManager(); 
<span style="color: #2F8B58; font-weight: bold;">FragmentTransaction</span> <span style="color: #0084C8; font-weight: bold;">transaction</span> = manager.beginTransaction();
<span style="color: #204A87;">//</span><span style="color: #204A87;">&#31532;&#20108;&#20010;&#21442;&#25968;&#26159;&#32487;&#25215; Fragment &#30340;&#23376;&#31867;</span>
transaction.add(R.id.id,<span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">Fragment</span>());
transaction.replace(R.id.id,fragment);  
transaction.commit();  
</pre>


</div>
</div>

</div>

<div id="outline-container-10-3" class="outline-3">
<h3 id="sec-10-3"><span class="section-number-3">10.3</span> 基本用法</h3>
<div class="outline-text-3" id="text-10-3">


</div>

<div id="outline-container-10-3-1" class="outline-4">
<h4 id="sec-10-3-1"><span class="section-number-4">10.3.1</span> 在 Activity 中获取 Fragment 的内容</h4>
<div class="outline-text-4" id="text-10-3-1">

<p>使用 FragmentManager 来管理 Fragment 
</p>
<p>
MainActivity.java
</p>


<pre class="src src-java"><span style="color: #2F8B58; font-weight: bold;">FragmentManager</span> <span style="color: #0084C8; font-weight: bold;">manager</span> = getFragmentManager();
<span style="color: #2F8B58; font-weight: bold;">Fragment</span> <span style="color: #0084C8; font-weight: bold;">fragment</span> = manager.findFragmentById(R.id.id);
<span style="color: #2F8B58; font-weight: bold;">View</span> <span style="color: #0084C8; font-weight: bold;">view</span> = fragment.getView();
<span style="color: #2F8B58; font-weight: bold;">TextView</span> <span style="color: #0084C8; font-weight: bold;">textview</span> = (<span style="color: #2F8B58; font-weight: bold;">TextView</span>)view.findFragmentById(R.id.viewid);
<span style="color: #204A87;">//</span><span style="color: #204A87;">&#38543;&#21518;&#21487;&#20197;&#21160;&#24577;&#25110;&#38745;&#24577;&#26174;&#31034;&#21040; Activity &#19978;</span>
<span style="color: #2F8B58; font-weight: bold;">FragmentManager</span> <span style="color: #0084C8; font-weight: bold;">manager</span> = getFragmentManager(); 

<span style="color: #2F8B58; font-weight: bold;">FragmentTransaction</span> <span style="color: #0084C8; font-weight: bold;">transaction</span> = manager.beginTransaction();
<span style="color: #204A87;">//</span><span style="color: #204A87;">&#31532;&#20108;&#20010;&#21442;&#25968;&#26159;&#32487;&#25215; Fragment &#30340;&#23376;&#31867;</span>
transaction.add(R.id.id,<span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">Fragment</span>());

<span style="color: #204A87;">//</span><span style="color: #204A87;">Activity&#32473; Fragment &#20256;&#21442;&#25968;</span>
<span style="color: #2F8B58; font-weight: bold;">Bundle</span> <span style="color: #0084C8; font-weight: bold;">bundle</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">Bundle</span>();
bundle.putString(<span style="color: #4E9A06;">"msg"</span>,<span style="color: #4E9A06;">"hehe"</span>+<span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">Data</span>());
fragment.setArguments(bundle);
<span style="color: #204A87;">//</span><span style="color: #204A87;">&#38543;&#21518;&#22312; Fragment &#31867;&#20013;&#24471;&#21040;&#21442;&#25968;</span>

transaction.replace(R.id.id,fragment);

Transaction.commit();
</pre>


</div>

</div>

<div id="outline-container-10-3-2" class="outline-4">
<h4 id="sec-10-3-2"><span class="section-number-4">10.3.2</span> Fragment 回传给 Activity 的值</h4>
<div class="outline-text-4" id="text-10-3-2">

<p>在 <a href="#sec-1-1">接口回调</a> 中说过
</p>
</div>
</div>

</div>

<div id="outline-container-10-4" class="outline-3">
<h3 id="sec-10-4"><span class="section-number-3">10.4</span> 生命周期方法</h3>
<div class="outline-text-3" id="text-10-4">

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" /><col class="left" /><col class="left" />
</colgroup>
<thead>
<tr><th scope="col" class="left">return</th><th scope="col" class="left">method_name</th><th scope="col" class="left">用途</th></tr>
</thead>
<tbody>
<tr><td class="left">void</td><td class="left">onAttach(Activity)</td><td class="left">和 Activity 关联</td></tr>
<tr><td class="left">void</td><td class="left">onCreate(Bundle)</td><td class="left">Fragment 初始化</td></tr>
<tr><td class="left">View</td><td class="left">onCreateView()</td><td class="left">初始化 UI 视图</td></tr>
<tr><td class="left">void</td><td class="left">onActiviyCreated()</td><td class="left">Activity 的 onCreate()执行完，就执行</td></tr>
<tr><td class="left">void</td><td class="left">onStart()</td><td class="left"></td></tr>
<tr><td class="left">void</td><td class="left">onResume()</td><td class="left"></td></tr>
<tr><td class="left">void</td><td class="left">onPause()</td><td class="left"></td></tr>
<tr><td class="left">void</td><td class="left">onStop()</td><td class="left"></td></tr>
<tr><td class="left">void</td><td class="left">onDestroyView()</td><td class="left">销毁 UI 视图</td></tr>
<tr><td class="left">void</td><td class="left">onDestroy()</td><td class="left">销毁 fragment</td></tr>
<tr><td class="left">void</td><td class="left">onDettach()</td><td class="left">和所属的 Activity 失联</td></tr>
</tbody>
</table>



</div>

</div>

<div id="outline-container-10-5" class="outline-3">
<h3 id="sec-10-5"><span class="section-number-3">10.5</span> 实现类似回退栈的功能</h3>
<div class="outline-text-3" id="text-10-5">

<p>利用事务中的 addToBackStack(null); 方法加入事务栈，
</p>
<p>
onBackPressed();方法回滚事务
</p>
</div>

</div>

<div id="outline-container-10-6" class="outline-3">
<h3 id="sec-10-6"><span class="section-number-3">10.6</span> DialogFragment</h3>
<div class="outline-text-3" id="text-10-6">

<p>子类独有的方法
</p><pre class="example">
onCreateDialog();//用来返回一个对话框对象
</pre>


<pre class="example">
onCreateView();//返回一个对话框
</pre>


</div>

</div>

<div id="outline-container-10-7" class="outline-3">
<h3 id="sec-10-7"><span class="section-number-3">10.7</span> ListFragment</h3>
<div class="outline-text-3" id="text-10-7">

<p>自身带有 ListView 即 Oncreateview() 返回的就是一个带有 ListView 的布局
对象.所以 listView 在 Oncreateview 后绑定数据或适配器
设置适配器使用 setListAdapter(),并且已经实现了事件监听，如果需要添加事件监听需要重写相应方法
</p>
<p>
事件监听方法: onListItemClick(&hellip;);
</p>
<p>
分析
</p><ul>
<li>listView 放置在 Fragment 中
</li>
<li>点击 listView 会出现一个 Activity，显示内容
</li>
<li>考虑到文件内容较多， 使用一个 ScrollView 
</li>
</ul>

<p>具体实现:
</p>
</div>

<div id="outline-container-10-7-1" class="outline-4">
<h4 id="sec-10-7-1"><span class="section-number-4">10.7.1</span> FilesFragment 继承 Fragment</h4>
<div class="outline-text-4" id="text-10-7-1">

<p>利用布局打气筒生成 Xml 文件的布局
</p>
<p>
获取 ListView 的 id
</p>
<p>
要显示的内容就是 String，使用 ArrayAdapter
</p>
<p>
listView 实现点击监听事件， 利用 Bundle 传出文件名
</p>
<p>
合理放置在各个生命周期中
</p></div>

</div>

<div id="outline-container-10-7-2" class="outline-4">
<h4 id="sec-10-7-2"><span class="section-number-4">10.7.2</span> 静态显示 FilesFragment</h4>
<div class="outline-text-4" id="text-10-7-2">

<p>添加一个 fragment 标签
</p></div>

</div>

<div id="outline-container-10-7-3" class="outline-4">
<h4 id="sec-10-7-3"><span class="section-number-4">10.7.3</span> 打开后的 Activity 以及 其中的 Fragment</h4>
<div class="outline-text-4" id="text-10-7-3">

<p>其中放置一个 Fragment ， 再放置存放文件内容的 textview Id，
并且获取上一个 Activity 传来的值。
</p>
<p>
利用 AssetManager manager = getResources().getAssets();
和 IO 流来获取文件内容
</p>
</div>

</div>

<div id="outline-container-10-7-4" class="outline-4">
<h4 id="sec-10-7-4"><span class="section-number-4">10.7.4</span> 如果要添加横屏时的布局文件</h4>
<div class="outline-text-4" id="text-10-7-4">

<p>添加文件夹 layout-land 在其中设置横屏的xml文件，将要显示的内容
添加在另一个 fragment 中，在点击事件中判断屏幕方向
</p><pre class="example">
if(getResources().getConfiguration().orientation == Configuration.ORIENTATION_LANDS...
</pre>

<p>如果横屏，动态加载 fragment 
</p>

</div>

</div>

<div id="outline-container-10-7-5" class="outline-4">
<h4 id="sec-10-7-5"><span class="section-number-4">10.7.5</span> 添加一个静态方法用来快速返回一个 Fragment</h4>
<div class="outline-text-4" id="text-10-7-5">

<p>使用静态方法快速将 Bundle 传递给 Fragment 并返回一个实例
</p>


<pre class="src src-java"><span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #A52A2A; font-weight: bold;">static</span>  <span style="color: #2F8B58; font-weight: bold;">DataFragment</span> <span style="color: #00578E; font-weight: bold;">newsInstance</span>(<span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">url</span>){
        <span style="color: #2F8B58; font-weight: bold;">DataFragment</span> <span style="color: #0084C8; font-weight: bold;">f</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">DataFragment</span>();
        <span style="color: #2F8B58; font-weight: bold;">Bundle</span> <span style="color: #0084C8; font-weight: bold;">bundle</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">Bundle</span>();
        bundle.putString(<span style="color: #4E9A06;">"url"</span>,url);
        f.setArguments(bundle);
        <span style="color: #A52A2A; font-weight: bold;">return</span> f;
}
</pre>

<p>
ListFragment 自带 ListView， 为了实现数据显示，还需要 一个<a href="#sec-8-2">适配器</a>和存放数据的容器。
</p>
</div>
</div>

</div>

<div id="outline-container-10-8" class="outline-3">
<h3 id="sec-10-8"><span class="section-number-3">10.8</span> 一个简单的使用方法例子</h3>
<div class="outline-text-3" id="text-10-8">




<pre class="src src-java"><span style="color: #A52A2A; font-weight: bold;">private</span> <span style="color: #2F8B58; font-weight: bold;">void</span> <span style="color: #00578E; font-weight: bold;">abcd</span>(<span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">tag</span>, Class&lt;? <span style="color: #A52A2A; font-weight: bold;">extends</span> <span style="color: #2F8B58; font-weight: bold;">Fragment</span>&gt; cls) {
        <span style="color: #2F8B58; font-weight: bold;">Fragment</span> <span style="color: #0084C8; font-weight: bold;">f</span>;
        f = fragmentManager.findFragmentByTag(tag);
        <span style="color: #A52A2A; font-weight: bold;">if</span> (f == <span style="color: #F5666D;">null</span>) {
<span style="color: #204A87;">//            </span><span style="color: #204A87;">f = new Model1MenuFragment();</span>
            <span style="color: #A52A2A; font-weight: bold;">try</span> {
                f = cls.newInstance();
                <span style="color: #A52A2A; font-weight: bold;">if</span> (currentFragment == <span style="color: #F5666D;">null</span>) {
                    <span style="color: #204A87;">//</span><span style="color: #204A87;">&#31532;&#19968;&#20010;&#39029;&#38754;</span>
                    fragmentManager.beginTransaction()
                            .add(R.id.leftMenuContainerId, f, tag)<span style="color: #204A87;">//</span><span style="color: #204A87;">model1 &#23601;&#26159; tag</span>
                            .commit();
                } <span style="color: #A52A2A; font-weight: bold;">else</span> {
                    <span style="color: #204A87;">//</span><span style="color: #204A87;">&#38544;&#34255;&#24403;&#21069;&#27491;&#26174;&#31034;&#30340; fragment &#24182;&#28155;&#21152;&#31532;&#19968;&#27425;&#26174;&#31034;&#30340;model1 &#30862;&#29255;</span>
                    fragmentManager.beginTransaction()
                            .hide(currentFragment)
                            .add(R.id.leftMenuContainerId, f, tag)
                            .commit();
                }
            } <span style="color: #A52A2A; font-weight: bold;">catch</span> (<span style="color: #2F8B58; font-weight: bold;">InstantiationException</span> <span style="color: #0084C8; font-weight: bold;">e</span>) {
                e.printStackTrace();
            } <span style="color: #A52A2A; font-weight: bold;">catch</span> (<span style="color: #2F8B58; font-weight: bold;">IllegalAccessException</span> <span style="color: #0084C8; font-weight: bold;">e</span>) {
                e.printStackTrace();
            }

        } <span style="color: #A52A2A; font-weight: bold;">else</span> {<span style="color: #204A87;">//</span><span style="color: #204A87;">&#20043;&#21069;&#24050;&#32463;&#26174;&#31034;&#36807;&#65292;&#20877;&#27425;&#26174;&#31034;</span>
            <span style="color: #A52A2A; font-weight: bold;">if</span> (currentFragment == f) {
                <span style="color: #A52A2A; font-weight: bold;">return</span>;
            }
            fragmentManager.beginTransaction()
                    .hide(currentFragment)
                    .show(f)
                    .commit();
        }
        currentFragment = f;
    }
</pre>

</div>
</div>

</div>

<div id="outline-container-11" class="outline-2">
<h2 id="sec-11"><span class="section-number-2">11</span> Loaders</h2>
<div class="outline-text-2" id="text-11">

<p>Loaders 令异步读取数据变得简单, Loaders 的一个特点就是可以在配置改变时重连.
</p>
</div>

<div id="outline-container-11-1" class="outline-3">
<h3 id="sec-11-1"><span class="section-number-3">11.1</span> Loader API Summary</h3>
<div class="outline-text-3" id="text-11-1">

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" /><col class="left" />
</colgroup>
<thead>
<tr><th scope="col" class="left">Class/Interface</th><th scope="col" class="left">Description</th></tr>
</thead>
<tbody>
<tr><td class="left">LoaderManager</td><td class="left">用来管理 Loader</td></tr>
<tr><td class="left">LoaderManager.LoaderCallbacks</td><td class="left">一个 LoaderManager 的接口回调</td></tr>
<tr><td class="left">Loader</td><td class="left">一个抽象父类</td></tr>
<tr><td class="left">AsyncTaskLoader</td><td class="left">提供一个 AsyncTask 的抽象类</td></tr>
<tr><td class="left">CursorLoader</td><td class="left">用来查询数据库的实用子类，继承自 AsyncTaskLoader</td></tr>
</tbody>
</table>


</div>

</div>

<div id="outline-container-11-2" class="outline-3">
<h3 id="sec-11-2"><span class="section-number-3">11.2</span> 在 Application 中使用 Loader</h3>
<div class="outline-text-3" id="text-11-2">

<p>在一个应用中实用 Loader 一般需要如下:
</p><ul>
<li>一个 Activity 或 Fragment
</li>
<li>一个 LoaderManager 的实例
</li>
<li>一个 实现的子类（比如 CursorLoader 用来查询数据库，或者自定义的 Loader 用来做自定义的事情）
</li>
<li>实现 LoaderManager.LoaderCallbacks ， 在这里创建新 Loader 和 管理引用指向已存在的 Loader
</li>
<li>一个存放数据的地方， 比如一个 SimpleCursorAdapter
</li>
<li>一个数据源， 比如 ContentProvider
</li>
</ul>



</div>

<div id="outline-container-11-2-1" class="outline-4">
<h4 id="sec-11-2-1"><span class="section-number-4">11.2.1</span> 开始一个 Loader</h4>
<div class="outline-text-4" id="text-11-2-1">

<p>LoaderManager 用来管理一个或多个 Loader 实例，所以 LoaderManager 只需要一个， Loader 可以有多个。
</p>
<p>
可以在 Activity 的 onCreate() 方法或者 在 Fragment 的 onActivityCreated() 方法来初始化一个 Loader
</p><pre class="example">
getLoaderManager().initLoader(0, null, this);
</pre>

<ul>
<li>第一个参数是一个唯一的ID
</li>
<li>Optional arguments to supply to the loader at construction (null in this example).
</li>
<li>一个 LoaderManager.LoaderCallbacks 的实现
</li>
</ul>

<blockquote>

<p>注意：
</p>
</blockquote>


<ul>
<li>如果ID重复了，新的 Loader 会覆盖旧的
</li>
<li>如果ID不存在， 调用 LoaderManager.LoaderCallbacks 回调接口的 onCreateLoader() 方法返回一个新的 Loader
</li>
</ul>


</div>

</div>

<div id="outline-container-11-2-2" class="outline-4">
<h4 id="sec-11-2-2"><span class="section-number-4">11.2.2</span> 重新加载 Loader</h4>
<div class="outline-text-4" id="text-11-2-2">

<p>在初始化一个 Loader 后，如果数据需要更新，可以使用 restartLoader() 来更新数据.
</p>
</div>

</div>

<div id="outline-container-11-2-3" class="outline-4">
<h4 id="sec-11-2-3"><span class="section-number-4">11.2.3</span> 使用回调接口 LoaderManager.LoaderCallbacks</h4>
<div class="outline-text-4" id="text-11-2-3">

<p>使用 LoaderManager.LoaderCallbacks 回调接口用来管理什么时候创建，停止，重启 Loader，所以它具有一下方法
</p><ul>
<li>onCreateLoader()&ndash;利用拿到的 ID 初始化并返回一个新的 Loader
</li>
<li>onLoadFinished()&ndash;上一个 Loader 加载结束的时候调用
</li>
<li>onLoaderReset()&ndash; 上一个 Loader 需要重置的时候调用
</li>
</ul>



<ul>
<li id="sec-11-2-3-1">onCreateLoader<br/>
当一个 Loader 被初始化时，调用这个方法，并判断 ID 是否重复。
该方法接受以下参数
<ul>
<li>uri&ndash;需要检索的URI
</li>
<li>projection&ndash;返回的行的集合
</li>
<li>selection&ndash;返回行中哪些列的数据
</li>
<li>selectionArgs&ndash;上一个参数中的 ? 在这里用 String 数组定义
</li>
<li>sortOrder&ndash;***
</li>
</ul>


</li>
</ul>
<ul>
<li id="sec-11-2-3-2">onLoadFinished<br/>
在这个方法中将加载好的数据与 SimpleCursorAdapter 进行交换，使用
<pre class="example">
simplecursoradapter.swapCursor(data);
</pre>


</li>
</ul>
<ul>
<li id="sec-11-2-3-3">onLoaderReset<br/>
这个方法在 Loader 不需要的时候调用，需要将 Simplecursoradapter 的数据用null 替换掉
<pre class="example">
simplecursoradapter.swapCursor(null);
</pre>

</li>
</ul>
</div>
</div>

</div>

<div id="outline-container-11-3" class="outline-3">
<h3 id="sec-11-3"><span class="section-number-3">11.3</span> <span class="todo TODO">TODO</span> CursorLoader</h3>
<div class="outline-text-3" id="text-11-3">

</div>
</div>

</div>

<div id="outline-container-12" class="outline-2">
<h2 id="sec-12"><span class="section-number-2">12</span> Handler</h2>
<div class="outline-text-2" id="text-12">

<p>线程之间发送消息.
</p>
<p>
使用异步任务的原因
</p><ul>
<li>主线程不能执行耗时操作
</li>
<li>子线程不能操作UI线程的UI视图
</li>
</ul>

<p>Handler 的核心类
</p><dl>
<dt>Message</dt><dd>对发送的消息的封装
</dd>
<dt>MessageQueue</dt><dd>消息队列，存放所有的消息
</dd>
<dt>Looper</dt><dd>循环读取消息（从 MessageQueue 中读取）
</dd>
<dt>Handler</dt><dd>处理消息，发送消息
</dd>
</dl>



</div>

<div id="outline-container-12-1" class="outline-3">
<h3 id="sec-12-1"><span class="section-number-3">12.1</span> <span class="todo TODO">TODO</span> Handler 过程解释</h3>
<div class="outline-text-3" id="text-12-1">

</div>

</div>

<div id="outline-container-12-2" class="outline-3">
<h3 id="sec-12-2"><span class="section-number-3">12.2</span> 子线程给主线程发消息</h3>
<div class="outline-text-3" id="text-12-2">

<p>Handler 定义在主线程。主线程需要循环读取 MessageQueue，具备读取功能的是 Lopper
而主线程中已经定义了 Lopper 对象，所以不需要自己定义。
</p>
<pre class="example">
结论：只需要在主线程中定义 Handler.
</pre>


</div>

<div id="outline-container-12-2-1" class="outline-4">
<h4 id="sec-12-2-1"><span class="section-number-4">12.2.1</span> 下载图片</h4>
<div class="outline-text-4" id="text-12-2-1">

<p>子线程下载图片，完成后发送消息给主线程
</p>
<p>
发送方式有两种
</p><ol>
<li>使用 sendMessage(Message msg) 发送， 使用handlerMessage(Message mag)处理
</li>
<li>使用 post(Runnable r) 发送， 直接发送的是主线程需要执行的代码.
</li>
</ol>




<pre class="src src-java">  <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #A52A2A; font-weight: bold;">static</span> <span style="color: #A52A2A; font-weight: bold;">final</span> <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">path</span> = <span style="color: #4E9A06;">""</span>;
  <span style="color: #A52A2A; font-weight: bold;">private</span> <span style="color: #2F8B58; font-weight: bold;">Handler</span> <span style="color: #0084C8; font-weight: bold;">handler</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">Handler</span>(){
          <span style="color: #F5666D;">@Override</span>
          <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">void</span> <span style="color: #00578E; font-weight: bold;">handlerMessage</span>(<span style="color: #2F8B58; font-weight: bold;">Message</span> <span style="color: #0084C8; font-weight: bold;">msg</span>){
              <span style="color: #204A87;">//</span><span style="color: #204A87;">&#22788;&#29702;&#23376;&#32447;&#31243;&#21457;&#36865;&#36807;&#26469;&#30340; Message</span>
              <span style="color: #2F8B58; font-weight: bold;">Bitmap</span> <span style="color: #0084C8; font-weight: bold;">bitmap</span> = (<span style="color: #2F8B58; font-weight: bold;">Bitmap</span>)msg.obj;
              <span style="color: #204A87;">//</span><span style="color: #204A87;">&#20132;&#32473;&#20027;&#32447;&#31243;UI&#22788;&#29702; &#35774;&#32622;&#21040; ImageView &#20160;&#20040;&#30340;              </span>
          }
      }
  <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">void</span> <span style="color: #00578E; font-weight: bold;">downImage</span>(<span style="color: #2F8B58; font-weight: bold;">View</span> <span style="color: #0084C8; font-weight: bold;">view</span>){
      <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">Thread</span>(<span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">Runnable</span>()){
              <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">void</span> <span style="color: #00578E; font-weight: bold;">run</span>(){
                  <span style="color: #2F8B58; font-weight: bold;">HttpGet</span> <span style="color: #0084C8; font-weight: bold;">get</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">HttpGet</span>(path);
                  <span style="color: #2F8B58; font-weight: bold;">HttpClient</span> <span style="color: #0084C8; font-weight: bold;">client</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">DefaultHttpClient</span>();
                  <span style="color: #2F8B58; font-weight: bold;">HttpResponse</span> <span style="color: #0084C8; font-weight: bold;">response</span> = <span style="color: #F5666D;">null</span>;
                  response = client.execute(get);
                  <span style="color: #A52A2A; font-weight: bold;">if</span>(response.getStatusLine().getStatusCode == 200){
                      <span style="color: #2F8B58; font-weight: bold;">byte</span>[] <span style="color: #0084C8; font-weight: bold;">arr</span> = EntityUtils.toByteArray(response.getEntity());
                      <span style="color: #2F8B58; font-weight: bold;">Bitmap</span> <span style="color: #0084C8; font-weight: bold;">bitmao</span> = BitmapFactory.decodeByteArray(arr,0,arr.length);
                      <span style="color: #204A87;">//</span><span style="color: #204A87;">&#19979;&#36733;&#23436;&#25104;&#26102;&#65292;&#25226;&#22270;&#29255;&#21457;&#36865;&#32473;&#20027;&#32447;&#31243;</span>
                      <span style="color: #204A87;">//</span><span style="color: #204A87;">&#20174; MessageQueue &#20013;&#33719;&#21462;&#21487;&#29992;&#30340; Message &#23545;&#35937;&#65292;&#22914;&#26524;&#27809;&#26377;&#21487;&#29992;&#30340;&#21017;&#21019;&#24314;&#19968;&#20010;&#26032;&#30340; Message &#23545;&#35937;</span>
                      <span style="color: #2F8B58; font-weight: bold;">Message</span> <span style="color: #0084C8; font-weight: bold;">msg</span> = Message.obtain();
                      <span style="color: #204A87;">//</span><span style="color: #204A87;">&#21457;&#36865;&#30340;&#22270;&#29255;&#23553;&#35013;&#21040; msg &#20013;</span>
                      msg.obj = bitmap;
                      <span style="color: #204A87;">//</span><span style="color: #204A87;">&#20351;&#29992; Handler &#21457;&#36865; msg</span>
                      handler.sendMessage(msg);  
                      <span style="color: #204A87;">//</span><span style="color: #204A87;">post &#26041;&#24335;</span>
                      handler.post(<span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">Runnable</span>()){
                          run(){
                              <span style="color: #204A87;">//</span><span style="color: #204A87;">&#23558;&#27492;&#20219;&#21153;&#21457;&#32473;UI&#32447;&#31243;&#21462;&#25191;&#34892;&#65292;&#23558;&#22270;&#29255;&#26174;&#31034;&#22312;UI&#19978;</span>
                          }
                      }
                  }
              }
          }
}
</pre>



</div>

</div>

<div id="outline-container-12-2-2" class="outline-4">
<h4 id="sec-12-2-2"><span class="section-number-4">12.2.2</span> 计时器</h4>
<div class="outline-text-4" id="text-12-2-2">

</div>
</div>

</div>

<div id="outline-container-12-3" class="outline-3">
<h3 id="sec-12-3"><span class="section-number-3">12.3</span> 主线程给子线程发送消息</h3>
<div class="outline-text-3" id="text-12-3">





<pre class="src src-java">MainActivity{
    <span style="color: #2F8B58; font-weight: bold;">Handler</span> <span style="color: #0084C8; font-weight: bold;">handler</span> ;
    <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">void</span> <span style="color: #0084C8; font-weight: bold;">sendMessage</span>(<span style="color: #2F8B58; font-weight: bold;">View</span> <span style="color: #0084C8; font-weight: bold;">view</span>){
        <span style="color: #2F8B58; font-weight: bold;">Message</span> <span style="color: #0084C8; font-weight: bold;">msg</span> = Mseeage.obtain();
        msg.obj = <span style="color: #4E9A06;">"hello,thread"</span>;
        handler.sendMessage(msg);
    }

    <span style="color: #204A87;">//</span><span style="color: #204A87;">&#21019;&#24314;&#23376;&#32447;&#31243;</span>
    <span style="color: #A52A2A; font-weight: bold;">class</span> <span style="color: #2F8B58; font-weight: bold;">MyThread</span> <span style="color: #A52A2A; font-weight: bold;">extends</span> <span style="color: #2F8B58; font-weight: bold;">Thread</span>{
        <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">void</span> <span style="color: #00578E; font-weight: bold;">run</span>(){
            <span style="color: #204A87;">//</span><span style="color: #204A87;">&#39318;&#20808;&#35201;&#26377; Looper &#23545;&#35937;</span>
            Lopper.prepare();<span style="color: #204A87;">//</span><span style="color: #204A87;">&#21019;&#24314;&#19968;&#20010; Lopper &#23545;&#35937;&#65292;&#24182;&#25226;&#23427;&#25918;&#21040;&#32447;&#31243;&#26412;&#22320;&#21464;&#37327;&#20013;</span>
            <span style="color: #204A87;">//</span><span style="color: #204A87;">&#22312;&#23376;&#32447;&#31243;&#20013;&#23454;&#20363;&#21270; handler</span>
            handler = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">Handler</span>();<span style="color: #204A87;">//</span><span style="color: #204A87;">&#22914;&#26524;&#30452;&#25509;&#23454;&#20363;&#21270;&#20250;&#20986;&#29616; RuntimeException &#65292;&#21407;&#22240;&#26159;&#23376;&#32447;&#31243;&#27809;&#26377; Looper &#23545;&#35937;</span>
            <span style="color: #204A87;">//</span><span style="color: #204A87;">&#35753; Looper &#23545;&#35937;&#24490;&#29615;&#35835;&#21462; message </span>
            Looper.loop();

        }
    }
}

</pre>

</div>
</div>

</div>

<div id="outline-container-13" class="outline-2">
<h2 id="sec-13"><span class="section-number-2">13</span> <span class="target">异步任务</span></h2>
<div class="outline-text-2" id="text-13">

<p>在主线程执行的操作超过5s，就认为是耗时操作，程序出现 ANR:Application Not Response.
改进方法:让子线程去执行耗时操作.
</p>
<p>
但是:子线程无法修改UI线程中的视图，所以需要子线程通知主线程，
为了实现线程间的通信,就需要使用异步任务。
</p>

</div>

<div id="outline-container-13-1" class="outline-3">
<h3 id="sec-13-1"><span class="section-number-3">13.1</span> <span class="target">AsyncTask</span></h3>
<div class="outline-text-3" id="text-13-1">

<p>异步任务类本身具备创建子线程的功能.
继承 AsyncTask&lt;String,Void,String&gt;类，
</p>
<p>
泛型解释
</p><ol>
<li>doInBackground 方法需要接受的参数的类型
</li>
<li>显示进度时的类型 Integer
</li>
<li>doInBackground 方法返回值的类型
</li>
</ol>


<p>  
重写 doInBackground()方法，将耗时操作写在其中
</p>
<p>
void onPostExecute(String result);result 就是 doInBackground 方法的返回值
此方法执行在UI线程中,改变UI.
</p>
<p>
在UI线程中调用 AsyncTask.execute()方法执行
</p>
<p>
添加对话框
</p>


<pre class="src src-java"><span style="color: #2F8B58; font-weight: bold;">void</span> <span style="color: #00578E; font-weight: bold;">onPreExecute</span>(){
    dialog.show();
}
</pre>


<pre class="example">
onProgessUpdate，在调用 publishProgress 后调用。
</pre>


</div>

</div>

<div id="outline-container-13-2" class="outline-3">
<h3 id="sec-13-2"><span class="section-number-3">13.2</span> 常用的异步任务</h3>
<div class="outline-text-3" id="text-13-2">


</div>

<div id="outline-container-13-2-1" class="outline-4">
<h4 id="sec-13-2-1"><span class="section-number-4">13.2.1</span> 异步下载</h4>
<div class="outline-text-4" id="text-13-2-1">

<pre class="example">
task
</pre>




<pre class="src src-java"><span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #A52A2A; font-weight: bold;">class</span> <span style="color: #2F8B58; font-weight: bold;">DownloadPicAsyncTask</span> <span style="color: #A52A2A; font-weight: bold;">extends</span> <span style="color: #2F8B58; font-weight: bold;">AsyncTask</span>&lt;String,<span style="color: #2F8B58; font-weight: bold;">Void</span>,<span style="color: #2F8B58; font-weight: bold;">Bitmap</span>&gt; {
    <span style="color: #A52A2A; font-weight: bold;">private</span> <span style="color: #2F8B58; font-weight: bold;">Bitmap</span> <span style="color: #0084C8; font-weight: bold;">bitmap</span>;
    <span style="color: #A52A2A; font-weight: bold;">private</span> <span style="color: #2F8B58; font-weight: bold;">OnFinishBitmapListener</span> <span style="color: #0084C8; font-weight: bold;">onFinishBitmapListener</span>;

    <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">void</span> <span style="color: #0084C8; font-weight: bold;">setOnFinishBitmapListener</span>(<span style="color: #2F8B58; font-weight: bold;">OnFinishBitmaoListener</span> <span style="color: #0084C8; font-weight: bold;">onFinishBitmapListener</span>) {
        <span style="color: #A52A2A; font-weight: bold;">this</span>.onFinishBitmapListener = onFinishBitmapListener;
    }

    <span style="color: #A52A2A; font-weight: bold;">public</span> DownloadPicAsyncTask(<span style="color: #2F8B58; font-weight: bold;">Bitmap</span> <span style="color: #0084C8; font-weight: bold;">bitmap</span>) {
        <span style="color: #A52A2A; font-weight: bold;">this</span>.bitmap = bitmap;
    }
    <span style="color: #F5666D;">@Override</span>
    <span style="color: #A52A2A; font-weight: bold;">protected</span> <span style="color: #2F8B58; font-weight: bold;">Bitmap</span> <span style="color: #0084C8; font-weight: bold;">doInBackground</span>(<span style="color: #2F8B58; font-weight: bold;">String</span>... <span style="color: #0084C8; font-weight: bold;">params</span>) {
        <span style="color: #2F8B58; font-weight: bold;">InputStream</span> <span style="color: #0084C8; font-weight: bold;">inputStream</span> = <span style="color: #F5666D;">null</span>;

        <span style="color: #2F8B58; font-weight: bold;">byte</span>[] <span style="color: #0084C8; font-weight: bold;">bytes</span> = <span style="color: #F5666D;">null</span>;
        <span style="color: #A52A2A; font-weight: bold;">try</span> {
            inputStream = HttpUtil.getInputStream(params[0]);
            bytes = <span style="color: #F5666D;">HttpUtil</span>.InputStream2byte(inputStream);

        } <span style="color: #A52A2A; font-weight: bold;">catch</span> (<span style="color: #2F8B58; font-weight: bold;">IOException</span> <span style="color: #0084C8; font-weight: bold;">e</span>) {
            e.printStackTrace();
        }
        bitmap = BitmapFactory.decodeByteArray(bytes, 0, bytes.length);
        <span style="color: #A52A2A; font-weight: bold;">return</span> bitmap;
    }

    <span style="color: #F5666D;">@Override</span>
    <span style="color: #A52A2A; font-weight: bold;">protected</span> <span style="color: #2F8B58; font-weight: bold;">void</span> <span style="color: #0084C8; font-weight: bold;">onPostExecute</span>(<span style="color: #2F8B58; font-weight: bold;">Bitmap</span> <span style="color: #0084C8; font-weight: bold;">bitmap</span>) {
        <span style="color: #A52A2A; font-weight: bold;">super</span>.onPostExecute(bitmap);
        onFinishBitmapListener.onFinishBitmap(bitmap);
    }
}

</pre>

<pre class="example">
interface
</pre>




<pre class="src src-java"><span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #A52A2A; font-weight: bold;">interface</span> <span style="color: #2F8B58; font-weight: bold;">OnFinishBitmapListener</span> {
    <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">void</span> <span style="color: #00578E; font-weight: bold;">onFinishBitmap</span>(<span style="color: #2F8B58; font-weight: bold;">Bitmap</span> <span style="color: #0084C8; font-weight: bold;">bitmap</span>);
}

</pre>

</div>
</div>

</div>

<div id="outline-container-13-3" class="outline-3">
<h3 id="sec-13-3"><span class="section-number-3">13.3</span> Loader</h3>
<div class="outline-text-3" id="text-13-3">

<p>是异步任务的封装，实现异步加载。包名+自定义权限名
</p><ol>
<li>让 Activity 或 Fragment 实现 LoaderCallbacks
</li>
<li>实现回调方法
</li>
</ol>





<pre class="src src-java"><span style="color: #204A87;">//</span><span style="color: #204A87;">&#21021;&#22987;&#21270;&#24182;&#21551;&#21160;</span>
<span style="color: #A52A2A; font-weight: bold;">public</span> onCreate(){
    getLoaderManager().initLoader(1,<span style="color: #F5666D;">null</span>,<span style="color: #A52A2A; font-weight: bold;">this</span>);  
}


</pre>


</div>
</div>

</div>

<div id="outline-container-14" class="outline-2">
<h2 id="sec-14"><span class="section-number-2">14</span> <span class="target">Intent</span> 意图</h2>
<div class="outline-text-2" id="text-14">


</div>

<div id="outline-container-14-1" class="outline-3">
<h3 id="sec-14-1"><span class="section-number-3">14.1</span> Intent 的七大属性</h3>
<div class="outline-text-3" id="text-14-1">

<ol>
<li>显示跳转
</li>
<li>Action
<ol>
<li>进入到打电话界面 ACTION_DIAL
</li>
<li>直接呼叫 ACTION_CALL
</li>
<li>向其发送短信 SENDTO
</li>
</ol>

</li>
<li>Gategory
<ol>
<li>CATEGORY_DEFAULT 默认模式
</li>
<li>CATEGORY_HOME  HOME界面
</li>
<li>CATEGORY_BROWSABLE 浏览器界面
</li>
</ol>

</li>
<li>Data
</li>
<li>Type
</li>
<li>Extra
</li>
<li>Flag
</li>
</ol>


</div>

</div>

<div id="outline-container-14-2" class="outline-3">
<h3 id="sec-14-2"><span class="section-number-3">14.2</span> 生命周期</h3>
<div class="outline-text-3" id="text-14-2">

<ol>
<li>运行状态,位于最前端,可以与用户交互
</li>
<li>停止状态,完全被其他界面覆盖,但是状态信息和数据还保留.内存不足时被销毁
</li>
<li>暂停状态:部分被覆盖.
</li>
<li>销毁状态,人为的销毁,系统销毁.
</li>
</ol>

<p>一个 Activity 从被创建到被销毁执行的生命周期方法
</p>

</div>
</div>

</div>

<div id="outline-container-15" class="outline-2">
<h2 id="sec-15"><span class="section-number-2">15</span> <span class="target">Action Bar</span></h2>
<div class="outline-text-2" id="text-15">


</div>

<div id="outline-container-15-1" class="outline-3">
<h3 id="sec-15-1"><span class="section-number-3">15.1</span> 简单介绍</h3>
<div class="outline-text-3" id="text-15-1">


</div>

<div id="outline-container-15-1-1" class="outline-4">
<h4 id="sec-15-1-1"><span class="section-number-4">15.1.1</span> 隐藏,显示 Action Bar</h4>
<div class="outline-text-4" id="text-15-1-1">

<p>隐藏
</p>


<pre class="src src-java">getActionBar().hide();
</pre>

<p>
显示
</p>


<pre class="src src-java">getActionBar().show();
</pre>

</div>

</div>

<div id="outline-container-15-1-2" class="outline-4">
<h4 id="sec-15-1-2"><span class="section-number-4">15.1.2</span> Action Bar 主要在资源文件中添加内容</h4>
<div class="outline-text-4" id="text-15-1-2">

<p>修改 menu 的 showAsAction 属性，建议 "ifRoom|withText"
意义就是如果有控件就显示，并且带文字。
</p>
<p>
各种按钮在 menu 中添加
</p></div>

</div>

<div id="outline-container-15-1-3" class="outline-4">
<h4 id="sec-15-1-3"><span class="section-number-4">15.1.3</span> 设置点击事件</h4>
<div class="outline-text-4" id="text-15-1-3">




<pre class="src src-java">onOptionsItemSelected(<span style="color: #2F8B58; font-weight: bold;">MenuItem</span> <span style="color: #0084C8; font-weight: bold;">item</span>){
    <span style="color: #A52A2A; font-weight: bold;">switch</span>(item.getItemId()){
    <span style="color: #A52A2A; font-weight: bold;">case</span> R.id.a:
        <span style="color: #204A87;">//</span><span style="color: #204A87;">&#31995;&#32479;&#26102;&#38388;</span>
        <span style="color: #2F8B58; font-weight: bold;">SimpleDateFormat</span> <span style="color: #0084C8; font-weight: bold;">sdf</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">SimpleDateFormat</span>(<span style="color: #4E9A06;">"yyyy-MM-dd hh:mm:ss SSS"</span>);
        textview.append(sdf.format(<span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">Date</span>()));
        <span style="color: #A52A2A; font-weight: bold;">break</span>;
    <span style="color: #A52A2A; font-weight: bold;">case</span> R.id.b:
        <span style="color: #204A87;">//</span><span style="color: #204A87;">&#25320;&#21495; &#26435;&#38480; CALL</span>
        <span style="color: #2F8B58; font-weight: bold;">SimpleDateFormat</span> <span style="color: #0084C8; font-weight: bold;">sdf</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">SimpleDateFormat</span>(<span style="color: #4E9A06;">"yyyy-MM-dd hh:mm:ss SSS"</span>);
        textview.append(sdf.format(<span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">Date</span>()));
        startActivity(<span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">Intent</span>(<span style="color: #F5666D;">Intetn</span>.ACTION_CALL,Uri.parse(<span style="color: #4E9A06;">"tel:10086"</span>)));
        <span style="color: #A52A2A; font-weight: bold;">break</span>;
    }
}
</pre>

</div>

</div>

<div id="outline-container-15-1-4" class="outline-4">
<h4 id="sec-15-1-4"><span class="section-number-4">15.1.4</span> 分离</h4>
<div class="outline-text-4" id="text-15-1-4">

<p>在 配置文件中的 Activity 中加入 uiOption 属性
</p>
<p>
当屏幕宽度空间不足时，会分割 ActionBar
</p></div>

</div>

<div id="outline-container-15-1-5" class="outline-4">
<h4 id="sec-15-1-5"><span class="section-number-4">15.1.5</span> 设置 Logo 图标可点击</h4>
<div class="outline-text-4" id="text-15-1-5">

<p>在 Activity 中调用以下方法
</p>


<pre class="src src-java">getActionBar().setDisplayShowHomeEnable(<span style="color: #F5666D;">true</span>);
getActionBar().setDisplayHomeAsUpRnable(<span style="color: #F5666D;">true</span>);
</pre>

<p>
监听ID : R.id.home 就可以监听该事件
</p></div>

</div>

<div id="outline-container-15-1-6" class="outline-4">
<h4 id="sec-15-1-6"><span class="section-number-4">15.1.6</span> 设置属性的例子</h4>
<div class="outline-text-4" id="text-15-1-6">




</div>
</div>

</div>

<div id="outline-container-15-2" class="outline-3">
<h3 id="sec-15-2"><span class="section-number-3">15.2</span> Tab</h3>
<div class="outline-text-3" id="text-15-2">

<p>要熟练掌握.针对API 版本较高时 ActionBar 消失的问题， 将 values 下的 styles 中的主题设置为 android:Theme.Holo.Light.DarkActionBar ， 并且 MainActivity 继承 Activity .
</p>
</div>

<div id="outline-container-15-2-1" class="outline-4">
<h4 id="sec-15-2-1"><span class="section-number-4">15.2.1</span> 基本歩骤</h4>
<div class="outline-text-4" id="text-15-2-1">

<ol>
<li>在 onCreate 方法中 使用 getActionBar() 方法得到一个 ActionBar
</li>
<li>设置模式 actionBar.setNavigationMode(ActionBar.NAVIGATION_MODE_TABS);
</li>
<li>Activity 承继 ActionBar.TabListener并 实现三个方法
<ul>
<li>public void onTabSelected(ActionBar.Tab tab, FragmentTransaction ft)
</li>
<li>public void onTabReselected(ActionBar.Tab tab, FragmentTransaction ft)
</li>
<li>public void onTabUnselected(ActionBar.Tab tab, FragmentTransaction ft)
</li>
</ul>

</li>
<li>为 ActionBar 设置属性
</li>
</ol>


<blockquote>

<p>3中主要实现第一个方法就行，并且参数中自带 FragmentTransaction ，由于是系统创建的不需要 commit(); 仅把 fragment 放置到其中即可
</p>
</blockquote>


<p>
一个将 NewsInfoFragment (新闻有关的Fragment) 放置到其中的例子
</p>


<pre class="src src-java"><span style="color: #F5666D;">@Override</span>
<span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">void</span> <span style="color: #00578E; font-weight: bold;">onTabSelected</span>(<span style="color: #F5666D;">ActionBar</span>.<span style="color: #2F8B58; font-weight: bold;">Tab</span> <span style="color: #0084C8; font-weight: bold;">tab</span>, <span style="color: #2F8B58; font-weight: bold;">FragmentTransaction</span> <span style="color: #0084C8; font-weight: bold;">ft</span>) {
        <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">cateid</span> = newsCategoryList.get(tab.getPosition()).getId();
        Log.d(<span style="color: #4E9A06;">"newid"</span>,<span style="color: #4E9A06;">"====="</span>+cateid);
        fragment = NewsInfoFragment.newIntance(cateid);
        ft.replace(R.id.framelayout, fragment);
    }
</pre>


<p>
4中的示例代码，将分好类的 News 设置为 Tab 的Text，并且设置监听.
</p>


<pre class="src src-java"><span style="color: #A52A2A; font-weight: bold;">for</span>(<span style="color: #2F8B58; font-weight: bold;">NewsCategory</span> <span style="color: #0084C8; font-weight: bold;">newsCategory</span> : newsCategoryList){
            actionBar.addTab(actionBar.newTab()
                    .setText(newsCategory.getName())
                    .setTabListener(<span style="color: #A52A2A; font-weight: bold;">this</span>));
        }
</pre>

</div>
</div>
</div>

</div>

<div id="outline-container-16" class="outline-2">
<h2 id="sec-16"><span class="section-number-2">16</span> ViewPager</h2>
<div class="outline-text-2" id="text-16">


</div>

<div id="outline-container-16-1" class="outline-3">
<h3 id="sec-16-1"><span class="section-number-3">16.1</span> 概述</h3>
<div class="outline-text-3" id="text-16-1">

<p>ViewPager 中需要一个适配器（FragmentPagerAdapter）,继承 FragmentPagerAdapter 需要这样
</p>


<pre class="src src-java"><span style="color: #A52A2A; font-weight: bold;">class</span> <span style="color: #2F8B58; font-weight: bold;">DataFragmentAdapter</span> <span style="color: #A52A2A; font-weight: bold;">extends</span> <span style="color: #2F8B58; font-weight: bold;">FragmentPagerAdapter</span> {

        <span style="color: #A52A2A; font-weight: bold;">public</span> DataFragmentAdapter(<span style="color: #2F8B58; font-weight: bold;">FragmentManager</span> <span style="color: #0084C8; font-weight: bold;">fm</span>){
            <span style="color: #A52A2A; font-weight: bold;">super</span>(fm);
        }
        <span style="color: #F5666D;">@Override</span>
        <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">Fragment</span> <span style="color: #00578E; font-weight: bold;">getItem</span>(<span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">position</span>) {
            <span style="color: #A52A2A; font-weight: bold;">return</span> fragments.get(position);
        }

        <span style="color: #F5666D;">@Override</span>
        <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #00578E; font-weight: bold;">getCount</span>() {
            <span style="color: #A52A2A; font-weight: bold;">return</span> fragments.size();
        }
}
</pre>

<p>
其中的 fragments 是存放 fragment 的容器。 将滑动的 Fragment 放入其中。
</p>
<p>
再为各个 fragment 添加 tab，利用 <a href="#sec-15">Action Bar</a> 里的知识，添加各个 fragment 的标题。
</p>
<p>
实现点击 tab 后跳转到相应的 fragment 
</p>


<pre class="src src-java"><span style="color: #F5666D;">@Override</span>
    <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">void</span> <span style="color: #00578E; font-weight: bold;">onTabSelected</span>(<span style="color: #F5666D;">ActionBar</span>.<span style="color: #2F8B58; font-weight: bold;">Tab</span> <span style="color: #0084C8; font-weight: bold;">tab</span>, <span style="color: #2F8B58; font-weight: bold;">FragmentTransaction</span> <span style="color: #0084C8; font-weight: bold;">ft</span>) {
        viewPager.setCurrentItem(tab.getPosition());
    }
</pre>

<p>
这样ViewPager 和 ActionBar的 tab 就结合到了一起。
</p>
</div>

</div>

<div id="outline-container-16-2" class="outline-3">
<h3 id="sec-16-2"><span class="section-number-3">16.2</span> ViewPager+v7包 歩骤</h3>
<div class="outline-text-3" id="text-16-2">

<ol>
<li>导入v7包下的 appcompat 类库工程，勾选复制到工作空间中
</li>
<li>项目中引入 v7 包下的工程，作为依赖库使用
</li>
<li>修改 Activity 主题样式
</li>
<li>修改继承的 Activity 类为 ActionBarActivity
</li>
<li>在 Activity 类中，通过 getSupoortActionBar() 获取
</li>
</ol>

<p>另：
</p><ul>
<li>如果使用 SearchView 
<ol>
<li>在资源文件中导入v7的命名空间 xmlns:app="&hellip;apk/res-auto"
</li>
<li>android:showAsAction改为v7中的属性，即app:showAsAction.
</li>
<li>android:actionViewClass改为app:actionViewClass
</li>
</ol>

</li>
</ul>


<p>
<img src="file:///home/alex/Pictures/V7下的SearchView获得方法.png"  alt="file:///home/alex/Pictures/V7下的SearchView获得方法.png" />
</p>

</div>
</div>

</div>

<div id="outline-container-17" class="outline-2">
<h2 id="sec-17"><span class="section-number-2">17</span> 四大组件</h2>
<div class="outline-text-2" id="text-17">


</div>

<div id="outline-container-17-1" class="outline-3">
<h3 id="sec-17-1"><span class="section-number-3">17.1</span> Activity</h3>
<div class="outline-text-3" id="text-17-1">


</div>

<div id="outline-container-17-1-1" class="outline-4">
<h4 id="sec-17-1-1"><span class="section-number-4">17.1.1</span> 如何新建一个页面</h4>
<div class="outline-text-4" id="text-17-1-1">

<ol>
<li>新建一个 Activity 类
</li>
<li>在清单文件中注册
</li>
</ol>

</div>

</div>

<div id="outline-container-17-1-2" class="outline-4">
<h4 id="sec-17-1-2"><span class="section-number-4">17.1.2</span> 从一个界面启动另一个界面</h4>
<div class="outline-text-4" id="text-17-1-2">




<pre class="src src-java"><span style="color: #2F8B58; font-weight: bold;">Intend</span> <span style="color: #0084C8; font-weight: bold;">intend</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">Intent</span>(<span style="color: #A52A2A; font-weight: bold;">this</span>,activityName.<span style="color: #A52A2A; font-weight: bold;">class</span>);
startActivity(intent);
</pre>

<p>
<a href="#sec-14">查看Intent内容</a>
</p></div>

</div>

<div id="outline-container-17-1-3" class="outline-4">
<h4 id="sec-17-1-3"><span class="section-number-4">17.1.3</span> Activity 之间的传值</h4>
<div class="outline-text-4" id="text-17-1-3">


<p>
1.使用 Intent 传值,如果传递对象,必须是可序列化的.
</p>


<pre class="src src-java"><span style="color: #2F8B58; font-weight: bold;">Intent</span> <span style="color: #0084C8; font-weight: bold;">intent</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">Intetn</span>(<span style="color: #A52A2A; font-weight: bold;">this</span>,activityName.<span style="color: #A52A2A; font-weight: bold;">class</span>)<span style="color: #F5666D; font-weight: bold;">'</span>
<span style="color: #4E9A06;">intent.putExtra("key","value");</span>
<span style="color: #4E9A06;">startActivity(intent);</span>
</pre>


<p>
被启动的 Activity 首先获得 Intent 对象
</p>


<pre class="src src-java"><span style="color: #2F8B58; font-weight: bold;">Intent</span> <span style="color: #0084C8; font-weight: bold;">intent</span> = getIntent();
<span style="color: #2F8B58; font-weight: bold;">Value</span> <span style="color: #0084C8; font-weight: bold;">value</span> = intent.getStringExtra(<span style="color: #4E9A06;">"key"</span>);
</pre>


<p>
2.也可以使用 Bundle 传值,先把数据存入 Bundle,再将 Bundle 放入 Intetn 中.
</p>
<p>
3.使用 Application 来传递,需要继承 Application,并修改清单文件使创建继承后的 Application,
然后就可以向下转型成继承后的 Application.
</p>


<pre class="src src-java"><span style="color: #2F8B58; font-weight: bold;">Intent</span> <span style="color: #0084C8; font-weight: bold;">intent</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">Intent</span>(<span style="color: #A52A2A; font-weight: bold;">this</span>,activityName.<span style="color: #A52A2A; font-weight: bold;">class</span>);
<span style="color: #2F8B58; font-weight: bold;">Application</span> <span style="color: #0084C8; font-weight: bold;">app</span> = getApplication();
</pre>

<p>
4.如何得到启动的 Activity 返回的数据
A中开启B时使用 startActivityForResult(intent,requestCode);
</p>
<p>
B返回数据,new 一个 Intent,调用 putExtra(key,value);再调用
setResult(resultCode,intent);
</p>
<p>
A覆写 onActivityResult(int requestCode,int resultCode, Intent data),得到返回的数值
之前判断请求码和结果码,最后获得intent中的数据.
</p>
<p>
Activityname
</p>
</div>

</div>

<div id="outline-container-17-1-4" class="outline-4">
<h4 id="sec-17-1-4"><span class="section-number-4">17.1.4</span> 隐式意图</h4>
<div class="outline-text-4" id="text-17-1-4">




<pre class="src src-java"><span style="color: #204A87;">//</span><span style="color: #204A87;">&#25171;&#24320;&#31995;&#32479;&#35774;&#32622;</span>
startActivity(<span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">Intent</span>(<span style="color: #F5666D;">Settings</span>.ACTION_SETTINGS));
</pre>


</div>
</div>

</div>

<div id="outline-container-17-2" class="outline-3">
<h3 id="sec-17-2"><span class="section-number-3">17.2</span> <span class="target">ContentProvider</span> 内容提供者</h3>
<div class="outline-text-3" id="text-17-2">

<p>App 提供一个接口令外部 App 能够访问私有数据，需要使用 ContentProvider 
而外部的 App 利用 ContentResolver 来访问 ContentProvider 提供
的内容。
</p>

</div>

<div id="outline-container-17-2-1" class="outline-4">
<h4 id="sec-17-2-1"><span class="section-number-4">17.2.1</span> URI 格式</h4>
<div class="outline-text-4" id="text-17-2-1">

<pre class="example">
schema://host:port/path
</pre>

<p>比如通话记录的 URI 就是 CallLog.Calls.CONTENT_URI
</p></div>

</div>

<div id="outline-container-17-2-2" class="outline-4">
<h4 id="sec-17-2-2"><span class="section-number-4">17.2.2</span> 权限</h4>
<div class="outline-text-4" id="text-17-2-2">

<pre class="example">
READ_CALL_LOG 访问通话记录
</pre>

</div>

</div>

<div id="outline-container-17-2-3" class="outline-4">
<h4 id="sec-17-2-3"><span class="section-number-4">17.2.3</span> 访问 ContentReslover</h4>
<div class="outline-text-4" id="text-17-2-3">

<ul>
<li id="sec-17-2-3-1">使用<br/>




<pre class="src src-java"><span style="color: #A52A2A; font-weight: bold;">private</span> <span style="color: #2F8B58; font-weight: bold;">Uri</span> <span style="color: #0084C8; font-weight: bold;">callUri</span> = <span style="color: #F5666D;">CallLog</span>.<span style="color: #F5666D;">Calls</span>.CONTENT_URI;
<span style="color: #A52A2A; font-weight: bold;">private</span> <span style="color: #2F8B58; font-weight: bold;">String</span>[] <span style="color: #0084C8; font-weight: bold;">columns</span> = {<span style="color: #F5666D;">CallLog</span>.Calls._ID,
                            <span style="color: #F5666D;">CallLog</span>.<span style="color: #F5666D;">Calls</span>.NUMBER,
                            <span style="color: #F5666D;">CallLog</span>.<span style="color: #F5666D;">Calls</span>.DATE,
                            <span style="color: #F5666D;">CallLog</span>.<span style="color: #F5666D;">Calls</span>.TYPE};

<span style="color: #A52A2A; font-weight: bold;">private</span> <span style="color: #2F8B58; font-weight: bold;">void</span> <span style="color: #00578E; font-weight: bold;">loadData</span>(){
    <span style="color: #204A87;">//</span><span style="color: #204A87;">&#35775;&#38382;&#25320;&#21495;&#35760;&#24405;&#24212;&#29992;&#19979;&#30340;&#25968;&#25454;</span>
    <span style="color: #204A87;">//</span><span style="color: #204A87;">&#24471;&#21040; ContentResolver &#23545;&#35937;</span>
    <span style="color: #2F8B58; font-weight: bold;">ContentResolver</span> <span style="color: #0084C8; font-weight: bold;">reslover</span> = getContentResolver();
    <span style="color: #204A87;">//</span><span style="color: #204A87;">&#26597;&#35810; URI &#20195;&#34920;&#30340;&#36164;&#28304;</span>
    <span style="color: #2F8B58; font-weight: bold;">Cursor</span> <span style="color: #0084C8; font-weight: bold;">cursor</span> = reslover.query(CallUri,columns,<span style="color: #F5666D;">null</span>,<span style="color: #F5666D;">null</span>,<span style="color: #F5666D;">null</span>);
    <span style="color: #A52A2A; font-weight: bold;">while</span>(cursor.moveToNext()){
        <span style="color: #2F8B58; font-weight: bold;">long</span> <span style="color: #0084C8; font-weight: bold;">id</span> = cursor.getLong(0);
        <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">number</span> = cursor.getString(1);
        <span style="color: #2F8B58; font-weight: bold;">long</span> <span style="color: #0084C8; font-weight: bold;">time</span> = cursor.getLong(2);
        <span style="color: #204A87;">//</span><span style="color: #204A87;">&#36716;&#26102;&#38388;</span>
        <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">date</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">SimpleDateFormat</span>(<span style="color: #4E9A06;">"YYYY-MM-dd E HH:mm:ss"</span>).format(<span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">Date</span>(time));
        <span style="color: #204A87;">//</span><span style="color: #204A87;">1:&#25320;&#20837; 2:&#25320;&#20986; 3:&#26410;&#25509;</span>
        <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">type</span> = cursor.getInt(3);
        <span style="color: #204A87;">//</span><span style="color: #204A87;">&#23450;&#20041;&#19968;&#20010;&#23384;&#25918;&#20449;&#24687;&#30340;&#23454;&#20307;&#31867; CallInfo</span>
        <span style="color: #2F8B58; font-weight: bold;">CallInfo</span> <span style="color: #0084C8; font-weight: bold;">callinfo</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">Callinfo</span>(id,number,date,type);
    }

}

</pre>

</li>
</ul>
<ul>
<li id="sec-17-2-3-2">实现联系人的增删改查<br/>
<ul>
<li id="sec-17-2-3-2-1">联系人的数据库<br/>
联系人信息表
<pre class="example">
raw_contacts(_id,display_name,display_name_alt)
</pre>

<p>联系人数据表
</p><pre class="example">
data(_id,raw_contact_id(外键),data1,data2,mimetype_id(数据类型))
</pre>

<p>数据类型表
</p><pre class="example">
mimetypes(_id,mimetype)
</pre>


<p>
SQL
</p>
<p>
from raw_contacts t1 join data t2 on (t1._id=t2.raw_contact_id)
where t2.mimetype_id=5;
</p>
</li>
</ul>
<ul>
<li id="sec-17-2-3-2-2">代码<br/>
显示和增加 



<pre class="src src-java"><span style="color: #A52A2A; font-weight: bold;">private</span> <span style="color: #2F8B58; font-weight: bold;">Uri</span> <span style="color: #0084C8; font-weight: bold;">contactsUri</span> = Uri.parse(<span style="color: #4E9A06;">"content://com.android.contacts/raw_contacts"</span>);
<span style="color: #A52A2A; font-weight: bold;">private</span> <span style="color: #2F8B58; font-weight: bold;">String</span>[] <span style="color: #0084C8; font-weight: bold;">conColumn</span> = {<span style="color: #4E9A06;">"_id"</span>,<span style="color: #4E9A06;">"display_name"</span>};

<span style="color: #A52A2A; font-weight: bold;">private</span> <span style="color: #2F8B58; font-weight: bold;">Uri</span> <span style="color: #0084C8; font-weight: bold;">dataUri</span> = Uri.parse(<span style="color: #4E9A06;">"content://com.android.contacts/data"</span>);
<span style="color: #A52A2A; font-weight: bold;">private</span> <span style="color: #2F8B58; font-weight: bold;">String</span>[] <span style="color: #0084C8; font-weight: bold;">conColumn</span> = {<span style="color: #4E9A06;">"data1"</span>};
<span style="color: #2F8B58; font-weight: bold;">ContentResolver</span> <span style="color: #0084C8; font-weight: bold;">reslover</span> = getContentResolver();

<span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">void</span> <span style="color: #00578E; font-weight: bold;">showContacts</span>(<span style="color: #2F8B58; font-weight: bold;">View</span> <span style="color: #0084C8; font-weight: bold;">v</span>){
    datasUri.clear();
    <span style="color: #204A87;">//</span><span style="color: #204A87;">&#20808;&#20174;&#32852;&#31995;&#20154;&#34920;&#20013;&#26597;&#35810;&#20154;&#30340;&#20449;&#24687;</span>
    <span style="color: #2F8B58; font-weight: bold;">Cursor</span> <span style="color: #0084C8; font-weight: bold;">cursor</span> = resolver.query(contactsUri,conColumn,<span style="color: #F5666D;">null</span>,<span style="color: #F5666D;">null</span>,<span style="color: #F5666D;">null</span>);
    <span style="color: #A52A2A; font-weight: bold;">while</span>(cursor.moveToNext()){
        <span style="color: #2F8B58; font-weight: bold;">long</span> <span style="color: #0084C8; font-weight: bold;">id</span> = cursor.getLong(0);
        <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">name</span> = cursor.getString(1);
        <span style="color: #204A87;">//</span><span style="color: #204A87;">&#26681;&#25454;id&#26597;&#35810;&#35814;&#32454;&#20449;&#24687;</span>
        <span style="color: #2F8B58; font-weight: bold;">Cursor</span> <span style="color: #0084C8; font-weight: bold;">phoneCursor</span> = getContentResolver().query(dataUri,dataColumn,<span style="color: #4E9A06;">"mimetype_id=5 and raw_contact_id="</span>+id,<span style="color: #F5666D;">null</span>,<span style="color: #F5666D;">null</span>);

        <span style="color: #A52A2A; font-weight: bold;">if</span>(phoneCursor.moveToNext()){
            <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">phone</span> = phoneCursor.getString(0);
        }
        <span style="color: #204A87;">//</span><span style="color: #204A87;">&#23558;&#25968;&#25454;&#21152;&#20837;Map&#25110;&#23454;&#20307;&#31867;</span>

    }
}
<span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">void</span> <span style="color: #00578E; font-weight: bold;">addContacts</span>(<span style="color: #2F8B58; font-weight: bold;">View</span> <span style="color: #0084C8; font-weight: bold;">v</span>){
    <span style="color: #204A87;">//</span><span style="color: #204A87;">&#20808;&#35774;&#32622;&#19968;&#20010;&#23545;&#35805;&#26694; &#22312;&#23545;&#35805;&#26694;&#30340;&#28857;&#20987;&#20107;&#20214;&#20013;</span>
    <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">void</span> <span style="color: #0084C8; font-weight: bold;">onClick</span>(){
        <span style="color: #2F8B58; font-weight: bold;">ContentValues</span> <span style="color: #0084C8; font-weight: bold;">values</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">ContentValues</span>();
        values.put(<span style="color: #4E9A06;">"display_name"</span>,name);
        values.put(<span style="color: #4E9A06;">"display_name_alt"</span>name);
        <span style="color: #204A87;">//</span><span style="color: #204A87;">&#36820;&#22238;&#25554;&#20837;&#35760;&#24405;&#30340; Uri &#65292;&#24182;&#22312;&#20854;&#20013;&#21253;&#21547;id</span>
        <span style="color: #2F8B58; font-weight: bold;">Uri</span> <span style="color: #0084C8; font-weight: bold;">datasUri</span> = getContentResolver().insert(contactUri,values);
        <span style="color: #204A87;">//</span><span style="color: #204A87;">&#20174; Uri &#33719;&#21462;id</span>
        <span style="color: #2F8B58; font-weight: bold;">long</span> <span style="color: #0084C8; font-weight: bold;">_id</span> = ContentUris.parseId(datasUri);
        <span style="color: #204A87;">//</span><span style="color: #204A87;">&#21521;&#25968;&#25454;&#34920;&#20013;&#25554;&#20837;&#22995;&#21517;&#65292;&#30005;&#35805;&#65292;&#37038;&#31665;</span>
        values.clear();
        values.put(<span style="color: #4E9A06;">"raw_contact_id"</span>,_id);
        values.put(<span style="color: #4E9A06;">"data1"</span>,name);
        values.put(<span style="color: #4E9A06;">"mimetype"</span>,<span style="color: #4E9A06;">"vnd.android.cursor.item/name"</span>);
        getContentResolver().insert(dataUri,values);

        values.put(<span style="color: #4E9A06;">"data1"</span>,phone);
        values.put(<span style="color: #4E9A06;">"mimetype"</span>,<span style="color: #4E9A06;">"vnd.android.cursor.item/phone_v2"</span>);
        getContentResolver().insert(dataUri,values);

        values.put(<span style="color: #4E9A06;">"data1"</span>,email);
        values.put(<span style="color: #4E9A06;">"mimetype"</span>,<span style="color: #4E9A06;">"vnd.android.cursor.item/email_v2"</span>);
        getContentResolver().insert(dataUri,values);
        <span style="color: #204A87;">//</span><span style="color: #204A87;">&#37325;&#26032;&#26597;&#35810;&#25968;&#25454;&#24211;</span>
        showContacts(<span style="color: #F5666D;">null</span>);
    }
}
</pre>

<p>
<a href="#sec-5">Dialog</a>
</p>
<p>
删除，修改。前提：实现长按数据项出现上下文菜单，可选择修改和删除
</p>


<pre class="src src-java"><span style="color: #204A87;">//</span><span style="color: #204A87;">&#26356;&#26032;&#32852;&#31995;&#20154;&#20449;&#24687;</span>
<span style="color: #2F8B58; font-weight: bold;">ContentValues</span> <span style="color: #0084C8; font-weight: bold;">value</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">Values</span>();
value.put(<span style="color: #4E9A06;">"display_name"</span>,name);
value.put(<span style="color: #4E9A06;">"display_name_alt"</span>,name);

getContentResolver().update(contactUri,value,<span style="color: #4E9A06;">"_id="</span>+id,<span style="color: #F5666D;">null</span>);
<span style="color: #204A87;">//</span><span style="color: #204A87;">&#26356;&#26032;&#25968;&#25454;&#34920;&#20013;&#32852;&#31995;&#20154;&#30340;&#22995;&#21517;</span>
value.put(<span style="color: #4E9A06;">"data1"</span>,name);
value.put(<span style="color: #4E9A06;">"raw_contact_id"</span>,value);
getContentResolver().update(dataUri,value,<span style="color: #4E9A06;">"mimetype_id=7 and raw_contact_id="</span>+id,<span style="color: #F5666D;">null</span>);

<span style="color: #204A87;">//</span><span style="color: #204A87;">&#21024;&#38500;,&#20174;&#25968;&#25454;&#34920;&#20013;&#21024;&#38500;&#20449;&#24687;</span>
getContentResolver().delete(dataUri,<span style="color: #4E9A06;">"raw_contact_id="</span>+id,<span style="color: #F5666D;">null</span>);
<span style="color: #204A87;">//</span><span style="color: #204A87;">&#32852;&#31995;&#20154;&#34920;&#20013;&#23545;&#24212;&#30340;&#20063;&#21024;&#25481;</span>
getContentResolver().delete(contactUri,<span style="color: #4E9A06;">"_id="</span>+id,<span style="color: #F5666D;">null</span>);
</pre>

<p>
<a href="#sec-4-2">上下文菜单</a>
</p>
</li>
</ul>
</li>
</ul>
</div>

</div>

<div id="outline-container-17-2-4" class="outline-4">
<h4 id="sec-17-2-4"><span class="section-number-4">17.2.4</span> 自定义 ContentProvider</h4>
<div class="outline-text-4" id="text-17-2-4">

<p>首先定义了<a href="#sec-9-4">数据库</a>后，定义一个类继承 ContetnProvider 
</p>
<p>
并在清单文件注册
</p>


<pre class="src src-xml">&lt;<span style="color: #00578E; font-weight: bold;">provider</span>
<span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">name</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">&#21253;&#21517;+UserContProvider</span><span style="color: #4E9A06;">"</span>
<span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">authorities</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">&#21253;&#21517;+&#26631;&#35782;&#21517;</span><span style="color: #4E9A06;">"</span>
<span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">permission</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">&#33258;&#23450;&#20041;&#30340;&#26435;&#38480;</span><span style="color: #4E9A06;">"</span>
<span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">exported</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">true</span><span style="color: #4E9A06;">"</span>
/&gt;
&lt;<span style="color: #00578E; font-weight: bold;">permission</span> <span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">name</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">&#21253;&#21517;+&#33258;&#23450;&#20041;&#26435;&#38480;&#21517;&#27604;&#22914;&#65306;all</span><span style="color: #4E9A06;">"</span>/&gt;
&lt;<span style="color: #00578E; font-weight: bold;">uses-perssion</span> <span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">name</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">&#21253;&#21517;+&#33258;&#23450;&#20041;&#26435;&#38480;&#21517;</span><span style="color: #4E9A06;">"</span>/&gt;
</pre>



<pre class="src src-java"><span style="color: #204A87;">//</span><span style="color: #204A87;">&#23450;&#20041;&#19968;&#20010;&#21807;&#19968;&#26631;&#35782;&#65292;&#36890;&#24120;&#20351;&#29992;&#21253;&#21517;+&#25968;&#25454;&#24211;&#21517;</span>
<span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #A52A2A; font-weight: bold;">static</span> <span style="color: #A52A2A; font-weight: bold;">final</span> <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">AUTHORITY</span> = <span style="color: #4E9A06;">"com.qianfeng.user"</span>;
<span style="color: #204A87;">//</span><span style="color: #204A87;">&#21487;&#20197;&#34987;&#22806;&#30028;&#35775;&#38382;&#30340;&#25968;&#25454;&#24211;&#36164;&#28304;&#30340; Code &#26631;&#35782;</span>
<span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #A52A2A; font-weight: bold;">static</span> <span style="color: #A52A2A; font-weight: bold;">final</span> <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">CODE_USER</span> = 1;
<span style="color: #204A87;">//</span><span style="color: #204A87;">&#35775;&#38382;&#36164;&#28304;&#30340; Uri &#30340;&#21305;&#37197;&#22120;&#23545;&#35937;</span>
<span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #A52A2A; font-weight: bold;">static</span> <span style="color: #A52A2A; font-weight: bold;">final</span> <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">CODE_ORDER</span> = 8;
<span style="color: #A52A2A; font-weight: bold;">private</span> <span style="color: #2F8B58; font-weight: bold;">UriMatcher</span> <span style="color: #0084C8; font-weight: bold;">uriMatcher</span>; 
<span style="color: #A52A2A; font-weight: bold;">static</span> {
    uriMatcher = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">UriMatcher</span>(<span style="color: #F5666D;">UriMatcher</span>.NO_MATCH);
    <span style="color: #204A87;">//</span><span style="color: #204A87;">&#34920;&#21517;&#20026; user &#30340;Uri&#36164;&#28304;</span>
    uriMatcher.addURI(AUTHORITY,<span style="color: #4E9A06;">"user"</span>,CODE_USER);
    uriMatcher.addURI(AUTHORITY,<span style="color: #4E9A06;">"order"</span>,CODE_ORDER);
}

<span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #A52A2A; font-weight: bold;">static</span> onCreate(){
    dhHelper = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">DBHelper</span>(getContext());
    <span style="color: #A52A2A; font-weight: bold;">return</span> <span style="color: #F5666D;">false</span>;
}

<span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">Cursor</span> <span style="color: #00578E; font-weight: bold;">query</span>(<span style="color: #2F8B58; font-weight: bold;">Uri</span> <span style="color: #0084C8; font-weight: bold;">uri</span>,<span style="color: #2F8B58; font-weight: bold;">String</span>[] <span style="color: #0084C8; font-weight: bold;">projection</span>, <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">selection</span>,<span style="color: #2F8B58; font-weight: bold;">String</span>[] <span style="color: #0084C8; font-weight: bold;">selectionsArgs</span>, <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">sirtOrder</span>){
    <span style="color: #2F8B58; font-weight: bold;">SQLiteDatabase</span> <span style="color: #0084C8; font-weight: bold;">db</span> = dbHeloer.getReadbaleDatabase();
    <span style="color: #2F8B58; font-weight: bold;">Cuesor</span> <span style="color: #0084C8; font-weight: bold;">cuesor</span> = <span style="color: #F5666D;">null</span>;
    <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">code</span> =  uriMatcher.match(uri);
    <span style="color: #A52A2A; font-weight: bold;">switch</span>(code){
    <span style="color: #A52A2A; font-weight: bold;">case</span> CODE_USER:
        curder = db.query(<span style="color: #4E9A06;">"t_user"</span>,projection,selection,selectionArgs,<span style="color: #F5666D;">null</span>,<span style="color: #F5666D;">null</span>,sortOrder);
        <span style="color: #A52A2A; font-weight: bold;">break</span>;
    <span style="color: #A52A2A; font-weight: bold;">case</span> CODE_ORDER:
        <span style="color: #A52A2A; font-weight: bold;">break</span>;

        <span style="color: #A52A2A; font-weight: bold;">return</span> cursor;
    }
}
<span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">Uri</span> <span style="color: #00578E; font-weight: bold;">insert</span>(<span style="color: #2F8B58; font-weight: bold;">Uri</span> <span style="color: #0084C8; font-weight: bold;">uri</span>, <span style="color: #2F8B58; font-weight: bold;">ContentValues</span> <span style="color: #0084C8; font-weight: bold;">values</span>){
    <span style="color: #2F8B58; font-weight: bold;">SQLiteDatabase</span> <span style="color: #0084C8; font-weight: bold;">db</span> = dbHeloer.getWritableDatabase();
    <span style="color: #A52A2A; font-weight: bold;">if</span>(uriMatcher.match(uri) == COE_USER){
        <span style="color: #2F8B58; font-weight: bold;">long</span> <span style="color: #0084C8; font-weight: bold;">id</span> = db.insert(<span style="color: #4E9A06;">"t_user"</span>,<span style="color: #F5666D;">null</span>,values);
        <span style="color: #204A87;">//</span><span style="color: #204A87;">&#36820;&#22238;&#26032;&#25554;&#20837;&#30340;&#35760;&#24405;&#30340;uri</span>
        <span style="color: #A52A2A; font-weight: bold;">return</span> ContentUris.withAppendedId(uri,id);
    }  
}
<span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #00578E; font-weight: bold;">delete</span>(<span style="color: #2F8B58; font-weight: bold;">uri</span>,<span style="color: #2F8B58; font-weight: bold;">selection</span>,<span style="color: #2F8B58; font-weight: bold;">selectionArgs</span>){

}
</pre>

</div>
</div>

</div>

<div id="outline-container-17-3" class="outline-3">
<h3 id="sec-17-3"><span class="section-number-3">17.3</span> Service</h3>
<div class="outline-text-3" id="text-17-3">


</div>

<div id="outline-container-17-3-1" class="outline-4">
<h4 id="sec-17-3-1"><span class="section-number-4">17.3.1</span> startService 管理 Service 的用法</h4>
<div class="outline-text-4" id="text-17-3-1">

<ol>
<li>创建Service子类，重写三个核心的生命周期方法和一个抽象方法
<ol>
<li>OnCreate()
<pre class="example">
在线程启动时调用，再调用则调用 onStartCommand() 方法
</pre>

</li>
<li>onStartCommand()
</li>
<li>onDestroy()
</li>
<li>onBind()

</li>
</ol>

</li>
<li>配置文件中注册Service组件
<pre class="example">
&lt;service android:name=".PlayerService"/&gt;
</pre>

</li>
<li>启动和停止Service
<pre class="example">
startService(intent);
stopService(intent);
</pre>

</li>
</ol>


</div>

</div>

<div id="outline-container-17-3-2" class="outline-4">
<h4 id="sec-17-3-2"><span class="section-number-4">17.3.2</span> MediaPlayer</h4>
<div class="outline-text-4" id="text-17-3-2">

<p>使用过的方法一览
</p><table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" /><col class="left" />
</colgroup>
<thead>
<tr><th scope="col" class="left">Method Name</th><th scope="col" class="left">Discriable</th></tr>
</thead>
<tbody>
<tr><td class="left">getCurrentPosition()</td><td class="left">得到当前播放到的毫秒数</td></tr>
<tr><td class="left">getDuration</td><td class="left">得到总的毫秒数</td></tr>
<tr><td class="left">isPlaying()</td><td class="left">是否在播放</td></tr>
<tr><td class="left">pause()</td><td class="left">暂停</td></tr>
<tr><td class="left">prepare()</td><td class="left">准备后可以执行 开始</td></tr>
<tr><td class="left">prepareAsync ()</td><td class="left">使用异步任务的 prepare()</td></tr>
<tr><td class="left">reset()</td><td class="left">重置到空状态，需要 prepare() 才能开始</td></tr>
<tr><td class="left">seekTo(int current)</td><td class="left">进度走到 current 的位置，单位是 ms</td></tr>
<tr><td class="left">start()</td><td class="left">开始</td></tr>
<tr><td class="left">stop()</td><td class="left">停止</td></tr>
</tbody>
</table>



</div>

</div>

<div id="outline-container-17-3-3" class="outline-4">
<h4 id="sec-17-3-3"><span class="section-number-4">17.3.3</span> BindService</h4>
<div class="outline-text-4" id="text-17-3-3">

<p>将 Activity 和 Service 绑定
</p>
<p>
相比普通的 Service， BindService 在 onBind() 方法中返回一个 Binder 的实例，之后 Activity 中实例化 ServiceConnection 接口对象， 其中有一个 IBinder 对象，将其强转为 BindService中返回的 Binder 类型，就可以在 Activity 中调用 Service 定义的 Binder 中的方法. 
</p>
<ol>
<li>在 Service 定义 Binder 并 返回



<pre class="src src-java"><span style="color: #F5666D;">@Override</span>
    <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">IBinder</span> <span style="color: #00578E; font-weight: bold;">onBind</span>(<span style="color: #2F8B58; font-weight: bold;">Intent</span> <span style="color: #0084C8; font-weight: bold;">intent</span>) {
        <span style="color: #A52A2A; font-weight: bold;">return</span> <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">TimerBinder</span>();
    }
<span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #A52A2A; font-weight: bold;">class</span> <span style="color: #2F8B58; font-weight: bold;">TimerBinder</span> <span style="color: #A52A2A; font-weight: bold;">extends</span> <span style="color: #2F8B58; font-weight: bold;">Binder</span>{
        <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">id</span>;
        <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">void</span> <span style="color: #00578E; font-weight: bold;">start</span>(){
            <span style="color: #204A87;">//</span><span style="color: #204A87;">&#36890;&#36807;&#23450;&#26102;&#22120;&#26469;&#23433;&#25490;&#35745;&#21010;</span>
            timer.schedule(<span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">TimerTask</span>() {
                <span style="color: #F5666D;">@Override</span>
                <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">void</span> <span style="color: #00578E; font-weight: bold;">run</span>() {
                    <span style="color: #204A87;">//</span><span style="color: #204A87;">&#22312;&#25351;&#23450;&#30340;&#26102;&#38388;&#25191;&#34892;&#30340;&#20219;&#21153;</span>
                    <span style="color: #F5666D;">NotificationCompat</span>.<span style="color: #2F8B58; font-weight: bold;">Builder</span> <span style="color: #0084C8; font-weight: bold;">builder</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #F5666D;">NotificationCompat</span>.<span style="color: #2F8B58; font-weight: bold;">Builder</span>(getApplicationContext());
                    builder.setSmallIcon(<span style="color: #F5666D;">android</span>.R.drawable.ic_dialog_alert)
                            .setContentText(<span style="color: #4E9A06;">"naozhong"</span>)
                            .setContentText(<span style="color: #4E9A06;">"time is done...."</span>)
                            .setTicker(<span style="color: #4E9A06;">"time is done...."</span>)
                            .setDefaults(<span style="color: #F5666D;">Notification</span>.DEFAULT_SOUND)
                            .setOngoing(<span style="color: #F5666D;">true</span>);
                    notificationManager.notify(2,builder.build());
                }
            }, 1 * 1000, 5000);
        }
        <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">void</span> <span style="color: #00578E; font-weight: bold;">stop</span>(){
            <span style="color: #204A87;">//</span><span style="color: #204A87;">&#20851;&#38381;&#25152;&#26377;&#30340;&#23450;&#26102;&#20219;&#21153;</span>
            timer.cancel();
            notificationManager.cancel(2);
        }
    }
</pre>


</li>
<li>在 Avtivity 中实例化一个 ServiceConnection 接口,并绑定 service



<pre class="src src-java"><span style="color: #2F8B58; font-weight: bold;">ServiceConnection</span> <span style="color: #0084C8; font-weight: bold;">conn</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">ServiceConnection</span>() {
        <span style="color: #F5666D;">@Override</span>
        <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">void</span> <span style="color: #00578E; font-weight: bold;">onServiceConnected</span>(<span style="color: #2F8B58; font-weight: bold;">ComponentName</span> <span style="color: #0084C8; font-weight: bold;">name</span>, <span style="color: #2F8B58; font-weight: bold;">IBinder</span> <span style="color: #0084C8; font-weight: bold;">service</span>) {
            <span style="color: #204A87;">//</span><span style="color: #204A87;">&#32465;&#23450;&#25104;&#21151;</span>
            timerBinder = (<span style="color: #F5666D;">TimerService</span>.<span style="color: #2F8B58; font-weight: bold;">TimerBinder</span>) service;

        }
        <span style="color: #F5666D;">@Override</span>
        <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">void</span> <span style="color: #00578E; font-weight: bold;">onServiceDisconnected</span>(<span style="color: #2F8B58; font-weight: bold;">ComponentName</span> <span style="color: #0084C8; font-weight: bold;">name</span>) {
            <span style="color: #204A87;">//</span><span style="color: #204A87;">&#26029;&#24320;&#36830;&#25509;</span>

        }
};
<span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">void</span> <span style="color: #00578E; font-weight: bold;">bindService</span>(<span style="color: #2F8B58; font-weight: bold;">View</span> <span style="color: #0084C8; font-weight: bold;">V</span>){
        bindService(<span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">Intent</span>(getApplicationContext(), TimerService.<span style="color: #A52A2A; font-weight: bold;">class</span>), conn, BIND_AUTO_CREATE);
        <span style="color: #204A87;">//</span><span style="color: #204A87;">&#24403;&#32465;&#23450;&#32452;&#20214;&#38144;&#27585;&#26102;&#65292; Service &#20063;&#20250;&#20572;&#27490;</span>

    }


    <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">void</span> <span style="color: #00578E; font-weight: bold;">unBindService</span>(<span style="color: #2F8B58; font-weight: bold;">View</span> <span style="color: #0084C8; font-weight: bold;">V</span>){
        unbindService(conn);<span style="color: #204A87;">//</span><span style="color: #204A87;">&#35299;&#38500;&#32465;&#23450;</span>
}
</pre>

</li>
</ol>




</div>

</div>

<div id="outline-container-17-3-4" class="outline-4">
<h4 id="sec-17-3-4"><span class="section-number-4">17.3.4</span> AIDL</h4>
<div class="outline-text-4" id="text-17-3-4">

</div>

</div>

<div id="outline-container-17-3-5" class="outline-4">
<h4 id="sec-17-3-5"><span class="section-number-4">17.3.5</span> Messager 信使:跨进程通信</h4>
<div class="outline-text-4" id="text-17-3-5">

<ul>
<li id="sec-17-3-5-1">服务端<br/>
<ol>
<li>创建 Service 子类， 类中声明 handler 和 Messenger 类对象



<pre class="src src-java"><span style="color: #204A87;">//</span><span style="color: #204A87;">&#22312; Service &#23376;&#31867;&#20013;</span>
 <span style="color: #A52A2A; font-weight: bold;">private</span> <span style="color: #2F8B58; font-weight: bold;">Handler</span> <span style="color: #0084C8; font-weight: bold;">mHandler</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">Handler</span>(){
        <span style="color: #F5666D;">@Override</span>
        <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">void</span> <span style="color: #00578E; font-weight: bold;">handleMessage</span>(<span style="color: #2F8B58; font-weight: bold;">Message</span> <span style="color: #0084C8; font-weight: bold;">msg</span>) {
            <span style="color: #A52A2A; font-weight: bold;">super</span>.handleMessage(msg);
            <span style="color: #204A87;">//</span><span style="color: #204A87;">&#22788;&#29702;&#20854;&#20182;&#32447;&#31243;&#25110;&#36827;&#31243;&#21457;&#36865;&#36807;&#26469;&#30340; Message</span>
            <span style="color: #2F8B58; font-weight: bold;">Message</span> <span style="color: #0084C8; font-weight: bold;">replymsg</span> = Message.obtain();
            replymsg.what = 2;
            <span style="color: #A52A2A; font-weight: bold;">try</span> {
                msg.replyTo.send(replymsg);<span style="color: #204A87;">//</span><span style="color: #204A87;">&#24212;&#31572;&#23458;&#25143;&#31471;:&#21521;&#23458;&#25143;&#31471;&#22238;&#20256;&#28040;&#24687;</span>
            } <span style="color: #A52A2A; font-weight: bold;">catch</span> (<span style="color: #2F8B58; font-weight: bold;">RemoteException</span> <span style="color: #0084C8; font-weight: bold;">e</span>) {
                e.printStackTrace();
            }
        }
    };
    <span style="color: #A52A2A; font-weight: bold;">private</span> <span style="color: #2F8B58; font-weight: bold;">Messenger</span> <span style="color: #0084C8; font-weight: bold;">messenger</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">Messenger</span>(mHandler);
</pre>

</li>
<li>在 onBind() 方法中，获取 Messenger 的 IBinder 对象 并返回



<pre class="src src-java"><span style="color: #F5666D;">@Override</span>
   <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">IBinder</span> <span style="color: #00578E; font-weight: bold;">onBind</span>(<span style="color: #2F8B58; font-weight: bold;">Intent</span> <span style="color: #0084C8; font-weight: bold;">intent</span>) {

       <span style="color: #A52A2A; font-weight: bold;">return</span> messenger.getBinder();<span style="color: #204A87;">//</span><span style="color: #204A87;">&#33719;&#21462; Messenger &#23545;&#35937;&#30340; Ibinder &#25509;&#21475;&#23545;&#35937;</span>
   }
</pre>

</li>
<li>注册 Service 组件 并声明隐式启动或绑定组件的 Action



<pre class="src src-java">&lt;service android:name=<span style="color: #4E9A06;">".PrintService"</span>&gt;
            &lt;intent-filter&gt;
                &lt;action android:name=<span style="color: #4E9A06;">"alex.servicemessager"</span>/&gt;
            &lt;/intent-filter&gt;
 &lt;/service&gt;
</pre>

</li>
</ol>

</li>
</ul>
<ul>
<li id="sec-17-3-5-2">客户端<br/>
<ol>
<li>声明 Messenger 对象



<pre class="src src-java"><span style="color: #A52A2A; font-weight: bold;">private</span> <span style="color: #2F8B58; font-weight: bold;">Messenger</span> <span style="color: #0084C8; font-weight: bold;">messenger</span>;
</pre>

</li>
<li>声明 并实例化 ServiceConnection 接口对象，在绑定服务组件时使用，用于监听绑定是否成功



<pre class="src src-java"><span style="color: #A52A2A; font-weight: bold;">private</span> <span style="color: #2F8B58; font-weight: bold;">ServiceConnection</span> <span style="color: #0084C8; font-weight: bold;">conn</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">ServiceConnection</span>() {
       <span style="color: #F5666D;">@Override</span>
       <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">void</span> <span style="color: #00578E; font-weight: bold;">onServiceConnected</span>(<span style="color: #2F8B58; font-weight: bold;">ComponentName</span> <span style="color: #0084C8; font-weight: bold;">name</span>, <span style="color: #2F8B58; font-weight: bold;">IBinder</span> <span style="color: #0084C8; font-weight: bold;">service</span>) {
           <span style="color: #204A87;">//</span><span style="color: #204A87;">&#32465;&#23450;&#25104;&#21151;</span>
           <span style="color: #204A87;">//</span><span style="color: #204A87;">&#23454;&#20363;&#21270; Messenger &#23545;&#35937;&#65292;&#23558; IBinder &#20256;&#20837;&#21040;Messenger &#26041;&#27861;&#20013;</span>
           messenger = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">Messenger</span>(service);
       }
       <span style="color: #F5666D;">@Override</span>
       <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">void</span> <span style="color: #00578E; font-weight: bold;">onServiceDisconnected</span>(<span style="color: #2F8B58; font-weight: bold;">ComponentName</span> <span style="color: #0084C8; font-weight: bold;">name</span>) {
       }
   };
</pre>

</li>
<li>在合适的位置调用 Context.bindService() 方法进行绑定



<pre class="src src-java">bindService(<span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">Intent</span>(<span style="color: #4E9A06;">"alex.servicemessager"</span>),conn,BIND_AUTO_CREATE);
</pre>

</li>
<li>在 ServiceConnection 接口的 onServiceConnection() 方法中，将方法的第二个参数作为实例化Messenger 的构造方法参数使用
<pre class="example">
在2步中已经顺便完成。
</pre>

</li>
<li>在合适的位置调用 Messenger 对象的 send(Message msg) 向服务端的 Handler 中发送消息



<pre class="src src-java"><span style="color: #2F8B58; font-weight: bold;">Message</span> <span style="color: #0084C8; font-weight: bold;">msg</span> = Message.obtain();
<span style="color: #204A87;">//</span><span style="color: #204A87;">msg.obj = "hello, Messenger Service"; &#26080;&#27861;&#21457;&#36865;&#65292;String &#31867;&#27809;&#26377;&#23454;&#29616; Parcelable &#25509;&#21475;</span>
        <span style="color: #2F8B58; font-weight: bold;">Bundle</span> <span style="color: #0084C8; font-weight: bold;">data</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">Bundle</span>();
        data.putString(<span style="color: #4E9A06;">"info"</span>,<span style="color: #4E9A06;">"hello messenger"</span>);
        msg.setData(data);
        msg.replyTo = replyMessenger;
        messenger.send(msg);<span style="color: #204A87;">//</span><span style="color: #204A87;">&#36890;&#36807;&#20449;&#20351;&#21521;&#22806;&#37096;&#24212;&#29992;&#21457;&#36865;&#28040;&#24687;</span>
</pre>

</li>
</ol>


</li>
</ul>
</div>

</div>

<div id="outline-container-17-3-6" class="outline-4">
<h4 id="sec-17-3-6"><span class="section-number-4">17.3.6</span> DownloadManager 下载管理器</h4>
<div class="outline-text-4" id="text-17-3-6">

<ul>
<li id="sec-17-3-6-1">基本歩骤<br/>
<ol>
<li>声明并实例化一个下载管理器



<pre class="src src-java"><span style="color: #A52A2A; font-weight: bold;">private</span> <span style="color: #2F8B58; font-weight: bold;">DownloadManager</span> <span style="color: #0084C8; font-weight: bold;">downloadManager</span>;<span style="color: #204A87;">//</span><span style="color: #204A87;">&#19979;&#36733;&#31649;&#29702;&#32452;&#20214;</span>
<span style="color: #204A87;">//</span><span style="color: #204A87;">&#19979;&#36733;&#31649;&#29702;&#32452;&#20214;&#23454;&#20363;&#23545;&#35937;</span>
downloadManager = (<span style="color: #2F8B58; font-weight: bold;">DownloadManager</span>) getSystemService(DOWNLOAD_SERVICE); 
</pre>

</li>
<li>得到网络下载的请求对象 request, 并存入指定位置



<pre class="src src-java"><span style="color: #204A87;">//</span><span style="color: #204A87;">&#26500;&#36896;&#32593;&#32476;&#19979;&#36733;&#30340;&#35831;&#27714;&#23545;&#35937;</span>
        <span style="color: #F5666D;">DownloadManager</span>.<span style="color: #2F8B58; font-weight: bold;">Request</span> <span style="color: #0084C8; font-weight: bold;">request</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #F5666D;">DownloadManager</span>.<span style="color: #2F8B58; font-weight: bold;">Request</span>(Uri.parse(url));
        request.allowScanningByMediaScanner();
        request.setNotificationVisibility(<span style="color: #F5666D;">DownloadManager</span>.<span style="color: #F5666D;">Request</span>.VISIBILITY_VISIBLE_NOTIFY_ONLY_COMPLETION);
        request.setTitle(<span style="color: #4E9A06;">"downloading..."</span>);
        <span style="color: #204A87;">//</span><span style="color: #204A87;">&#20445;&#23384;&#20301;&#32622;</span>
        request.setDestinationInExternalPublicDir(<span style="color: #F5666D;">Environment</span>.DIRECTORY_DOWNLOADS,<span style="color: #4E9A06;">"xx.xx"</span>);
</pre>

</li>
<li>将下载请求放入管理器



<pre class="src src-java">downloadManager.enqueue(request);
</pre>

</li>
</ol>


</li>
</ul>
<ul>
<li id="sec-17-3-6-2">如果下载的是视频，利用 VideoView 来播放<br/>
<ol>
<li>承接上面3步，接受下载好的系统广播



<pre class="src src-java"><span style="color: #204A87;">//</span><span style="color: #204A87;">&#33719;&#21462;&#19979;&#36733;&#35831;&#27714;&#30340; id</span>
       <span style="color: #2F8B58; font-weight: bold;">long</span> <span style="color: #0084C8; font-weight: bold;">id</span> = intent.getLongExtra(<span style="color: #F5666D;">DownloadManager</span>.EXTRA_DOWNLOAD_ID,0);
</pre>

</li>
<li>根据id得到存储位置将位置发给要播放的 Activity



<pre class="src src-java"><span style="color: #204A87;">//</span><span style="color: #204A87;">&#26681;&#25454;&#35831;&#27714;&#30340;id &#33719;&#21462;&#19979;&#36733;&#20043;&#21518;&#30340;&#36164;&#28304;&#20445;&#23384;&#20301;&#32622;</span>
       <span style="color: #2F8B58; font-weight: bold;">DownloadManager</span> <span style="color: #0084C8; font-weight: bold;">downloadManager</span> = (<span style="color: #2F8B58; font-weight: bold;">DownloadManager</span>) context.getSystemService(<span style="color: #F5666D;">Context</span>.DOWNLOAD_SERVICE);
       <span style="color: #2F8B58; font-weight: bold;">Uri</span> <span style="color: #0084C8; font-weight: bold;">uri</span> = downloadManager.getUriForDownloadedFile(id);
       <span style="color: #2F8B58; font-weight: bold;">Intent</span> <span style="color: #0084C8; font-weight: bold;">videoIntent</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">Intent</span>(context,VideoActivity.<span style="color: #A52A2A; font-weight: bold;">class</span>);
       videoIntent.putExtra(<span style="color: #4E9A06;">"path"</span>,
               Environment.getExternalStoragePublicDirectory(<span style="color: #F5666D;">Environment</span>.DIRECTORY_DOWNLOADS)+<span style="color: #4E9A06;">"/xx.xx"</span>);
       videoIntent.putExtra(<span style="color: #4E9A06;">"uri"</span>,uri);
       <span style="color: #204A87;">//</span><span style="color: #204A87;">&#21019;&#24314;&#26032;&#30340;&#20219;&#21153;&#26632;&#26469;&#23384;&#25918;&#24403;&#21069;&#21551;&#21160;&#30340; Activity &#32452;&#20214;</span>
       videoIntent.setFlags(<span style="color: #F5666D;">Intent</span>.FLAG_ACTIVITY_NEW_TASK);
       context.startActivity(videoIntent);
</pre>

</li>
<li>在新的 Activity 中播放



<pre class="src src-java"> <span style="color: #204A87;">//</span><span style="color: #204A87;">&#35774;&#32622;&#26174;&#31034;&#20869;&#23481;</span>
setContentView(R.layout.activity_video);
<span style="color: #204A87;">//</span><span style="color: #204A87;">&#25773;&#25918;&#35270;&#39057;</span>
videoView = (<span style="color: #2F8B58; font-weight: bold;">VideoView</span>) findViewById(R.id.videoView);
<span style="color: #204A87;">//</span><span style="color: #204A87;">&#20174;&#24847;&#22270;&#20013;&#33719;&#21462;&#25773;&#25918;&#35270;&#39057;&#36335;&#24452;</span>
<span style="color: #204A87;">//</span><span style="color: #204A87;">String path = getIntent().getStringExtra("path");</span>
<span style="color: #204A87;">//</span><span style="color: #204A87;">videoView.setVideoPath(path);</span>
<span style="color: #2F8B58; font-weight: bold;">Uri</span> <span style="color: #0084C8; font-weight: bold;">uri</span> = getIntent().getParcelableExtra(<span style="color: #4E9A06;">"uri"</span>);
videoView.setVideoURI(uri);
<span style="color: #204A87;">//</span><span style="color: #204A87;">&#35774;&#32622; videoView &#23186;&#20307;&#25511;&#20214; &#65288;&#36827;&#24230; &#25773;&#25918; &#26242;&#20572;&#31561;&#31561;&#65289;</span>
videoView.setMediaController(<span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">MediaController</span>(<span style="color: #A52A2A; font-weight: bold;">this</span>));
</pre>

</li>
</ol>

</li>
</ul>
</div>
</div>

</div>

<div id="outline-container-17-4" class="outline-3">
<h3 id="sec-17-4"><span class="section-number-3">17.4</span> BroadcastRecevier</h3>
<div class="outline-text-3" id="text-17-4">

<p>接受系统广播，组件间通信，子线程之间通讯
</p>
</div>

<div id="outline-container-17-4-1" class="outline-4">
<h4 id="sec-17-4-1"><span class="section-number-4">17.4.1</span> 三大要素</h4>
<div class="outline-text-4" id="text-17-4-1">

<p>接受一个广播 需要  
</p><ul>
<li>ACTION
</li>
<li>权限
</li>
<li>广播中包含的数据字段
</li>
</ul>


</div>

</div>

<div id="outline-container-17-4-2" class="outline-4">
<h4 id="sec-17-4-2"><span class="section-number-4">17.4.2</span> 发送广播</h4>
<div class="outline-text-4" id="text-17-4-2">

<p>实际上是发送的意图 Intent
</p><ol>
<li>先定义常量



<pre class="src src-java">    <span style="color: #204A87;">//</span><span style="color: #204A87;">&#22768;&#26126;&#23450;&#26102;&#24191;&#25773;&#30340; action&#65292; &#23384;&#20648;&#25968;&#25454;&#30340;&#23383;&#27573; EXTRA_TIME</span>
<span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #A52A2A; font-weight: bold;">static</span> <span style="color: #A52A2A; font-weight: bold;">final</span> <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">ACTION_TIMER</span>=<span style="color: #4E9A06;">"alex.broadcast.action.timer"</span>;
<span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #A52A2A; font-weight: bold;">static</span> <span style="color: #A52A2A; font-weight: bold;">final</span> <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">EXTRA_TIME</span>=<span style="color: #4E9A06;">"time"</span>;

</pre>

</li>
<li>发送广播
<ul>
<li>普通广播



<pre class="src src-java"><span style="color: #2F8B58; font-weight: bold;">Intent</span> <span style="color: #0084C8; font-weight: bold;">timeIntent</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">Intent</span>(<span style="color: #F5666D;">Config</span>.ACTION_TIMER);
timeIntent.putExtra(<span style="color: #F5666D;">Config</span>.EXTRA_TIME,time++);
sendBroadcast(timeIntent);
</pre>


</li>
<li>有序广播



<pre class="src src-java">sendOrderedBroadcast(<span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">Intent</span>(<span style="color: #F5666D;">Config</span>.ACTION_PRINT),<span style="color: #4E9A06;">"alex.permission.print"</span>);
</pre>


</li>
<li>带权限的广播



<pre class="src src-java">sendBroadcast(<span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">Intent</span>(<span style="color: #F5666D;">Config</span>.ACTION_PRINT),permission);
</pre>

</li>
</ul>

</li>
</ol>


</div>

</div>

<div id="outline-container-17-4-3" class="outline-4">
<h4 id="sec-17-4-3"><span class="section-number-4">17.4.3</span> 接收广播的歩骤</h4>
<div class="outline-text-4" id="text-17-4-3">

<ol>
<li>自定义广播接收器类，继承 BroadcastcReceiver，重写 onReceive()方法



<pre class="src src-java"><span style="color: #F5666D;">@Override</span>
<span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">void</span> <span style="color: #00578E; font-weight: bold;">onReceive</span>(<span style="color: #2F8B58; font-weight: bold;">Context</span> <span style="color: #0084C8; font-weight: bold;">context</span>, <span style="color: #2F8B58; font-weight: bold;">Intent</span> <span style="color: #0084C8; font-weight: bold;">intent</span>) {
     <span style="color: #204A87;">//</span><span style="color: #204A87;">&#33719;&#21462;&#24191;&#25773;Action</span>
     <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">action</span> = intent.getAction();
     <span style="color: #204A87;">//</span><span style="color: #204A87;">&#33719;&#21462;&#24191;&#25773;&#25968;&#25454;&#65292;&#24182;&#26174;&#31034;&#21040;UI&#25511;&#20214;</span>
     <span style="color: #A52A2A; font-weight: bold;">if</span>(action == <span style="color: #F5666D;">Intent</span>.ACTION_BATTERY_CHANGED){
         <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">level</span> = intent.getIntExtra(<span style="color: #F5666D;">BatteryManager</span>.EXTRA_LEVEL,0);
         textView.setText(<span style="color: #4E9A06;">"&#24403;&#21069;&#30005;&#37327;"</span>+level+<span style="color: #4E9A06;">"%"</span>);
     }<span style="color: #A52A2A; font-weight: bold;">else</span> <span style="color: #A52A2A; font-weight: bold;">if</span>(action == <span style="color: #F5666D;">Intent</span>.ACTION_POWER_CONNECTED){
         textView.setText(<span style="color: #4E9A06;">"&#30005;&#28304;&#36830;&#25509;"</span>);
     }<span style="color: #A52A2A; font-weight: bold;">else</span> <span style="color: #A52A2A; font-weight: bold;">if</span>(action == <span style="color: #F5666D;">Intent</span>.ACTION_POWER_DISCONNECTED){
         textView.setText(<span style="color: #4E9A06;">"&#30005;&#28304;&#26029;&#24320;&#36830;&#25509;"</span>);
     }<span style="color: #A52A2A; font-weight: bold;">else</span> <span style="color: #A52A2A; font-weight: bold;">if</span>(action == <span style="color: #F5666D;">Intent</span>.ACTION_SCREEN_ON){
         textView.setText(<span style="color: #4E9A06;">"&#25171;&#24320;&#23631;&#24149;"</span>);
     }
}
</pre>

</li>
<li>注册广播接收器，通过 IntetnFilter 声明广播接收器可以接受的广播频道（Action）



<pre class="src src-java"><span style="color: #2F8B58; font-weight: bold;">MyReciver</span> <span style="color: #0084C8; font-weight: bold;">myReciver</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">MyReciver</span>();
<span style="color: #2F8B58; font-weight: bold;">IntentFilter</span> <span style="color: #0084C8; font-weight: bold;">intentFilter</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">IntentFilter</span>(<span style="color: #F5666D;">Intent</span>.ACTION_BATTERY_CHANGED);
intentFilter.addAction(<span style="color: #F5666D;">Intent</span>.ACTION_BATTERY_LOW);
<span style="color: #204A87;">//</span><span style="color: #204A87;">&#27880;&#20876;&#24191;&#25773;&#25509;&#25910;&#22120;&#65292;&#25509;&#21463;&#31995;&#32479;&#30005;&#37327;&#25913;&#21464;&#24191;&#25773;</span>
registerReceiver(myReciver, intentFilter);
</pre>

</li>
</ol>



<ol>
<li>在广播接受的方法中实现相关操作（在UI线程中执行）
<ol>
<li>启动 Activity
</li>
<li>显示对话框，但是必须存在 Activity
</li>
<li>启动 Service
</li>
<li>发送通知
</li>
<li>弹出 Toast
</li>
</ol>

</li>
</ol>


</div>

</div>

<div id="outline-container-17-4-4" class="outline-4">
<h4 id="sec-17-4-4"><span class="section-number-4">17.4.4</span> 本地广播</h4>
<div class="outline-text-4" id="text-17-4-4">

<p>和普通广播的区别是需要一个 LocalBroadcastManager。
</p><ul>
<li>收广播



<pre class="src src-java"><span style="color: #204A87;">//</span><span style="color: #204A87;">&#33719;&#21462;&#26412;&#22320;&#24191;&#25773;&#31649;&#29702;&#23545;&#35937;</span>
localBroadcastManager = LocalBroadcastManager.getInstance(getApplicationContext());
networkReceiver = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">NetworkReceiver</span>();
localBroadcastManager.registerReceiver(networkReceiver,<span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">IntentFilter</span>(<span style="color: #4E9A06;">"alex.send2"</span>));
</pre>

</li>
<li>发广播



<pre class="src src-java"><span style="color: #204A87;">//</span><span style="color: #204A87;">&#36890;&#36807;&#26412;&#22320;&#24191;&#25773;&#31649;&#29702;&#22120;&#26469;&#21457;&#36865;&#24191;&#25773;</span>
localBroadcastManager.sendBroadcast(intent);
</pre>

</li>
</ul>




</div>
</div>
</div>

</div>

<div id="outline-container-18" class="outline-2">
<h2 id="sec-18"><span class="section-number-2">18</span> 事件分发机制</h2>
<div class="outline-text-2" id="text-18">

<p>简述: 
</p>
</div>

<div id="outline-container-18-1" class="outline-3">
<h3 id="sec-18-1"><span class="section-number-3">18.1</span> 分发的核心方法</h3>
<div class="outline-text-3" id="text-18-1">

<ul>
<li>dispatchTouchEvent
 事件分发的方法



<pre class="src src-java"><span style="color: #F5666D;">@Override</span>
   <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">boolean</span> <span style="color: #00578E; font-weight: bold;">dispatchTouchEvent</span>(<span style="color: #2F8B58; font-weight: bold;">MotionEvent</span> <span style="color: #0084C8; font-weight: bold;">ev</span>) {
       <span style="color: #204A87;">//</span><span style="color: #204A87;">&#20107;&#20214;&#20998;&#21457;&#30340;&#26041;&#27861;</span>
       Log.d(<span style="color: #4E9A06;">"event"</span>,CLSNAME+<span style="color: #4E9A06;">"---dispatchTouchEvent"</span>+ EventUtils.getName(ev));
       <span style="color: #A52A2A; font-weight: bold;">return</span> <span style="color: #A52A2A; font-weight: bold;">super</span>.dispatchTouchEvent(ev);
   }
</pre>

</li>
<li>onInterceptTouchEven
 拦截事件的方法



<pre class="src src-java"><span style="color: #F5666D;">@Override</span>
   <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">boolean</span> <span style="color: #00578E; font-weight: bold;">onInterceptTouchEvent</span>(<span style="color: #2F8B58; font-weight: bold;">MotionEvent</span> <span style="color: #0084C8; font-weight: bold;">ev</span>) {
       <span style="color: #204A87;">//</span><span style="color: #204A87;">&#25318;&#25130;&#20107;&#20214;&#30340;&#26041;&#27861;</span>
       Log.d(<span style="color: #4E9A06;">"event"</span>,CLSNAME+<span style="color: #4E9A06;">"---onInterceptTouchEvent"</span>+ EventUtils.getName(ev));
       <span style="color: #A52A2A; font-weight: bold;">if</span>(ev.getAction()==<span style="color: #F5666D;">MotionEvent</span>.ACTION_MOVE){
           <span style="color: #A52A2A; font-weight: bold;">return</span> <span style="color: #F5666D;">true</span>;<span style="color: #204A87;">//</span><span style="color: #204A87;">&#25318;&#25130;&#21518; &#23376;&#25511;&#20214;&#25910;&#21040;&#19968;&#20010;Cancel&#20107;&#20214;&#65292;&#25318;&#25130;&#21518;&#22914;&#26524;&#19981;&#22788;&#29702;&#65292;&#20132;&#32473;&#29238;&#25511;&#20214;&#65292;&#22914;&#26524;&#22788;&#29702;&#36820;&#22238; true&#65292;&#21017;&#22788;&#29702;</span>
       }
       <span style="color: #A52A2A; font-weight: bold;">return</span> <span style="color: #A52A2A; font-weight: bold;">super</span>.onInterceptTouchEvent(ev);
   }
</pre>

</li>
<li>onTouchEvent 
  事件处理（消费）方法



<pre class="src src-java"><span style="color: #F5666D;">@Override</span>
   <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">boolean</span> <span style="color: #00578E; font-weight: bold;">onTouchEvent</span>(<span style="color: #2F8B58; font-weight: bold;">MotionEvent</span> <span style="color: #0084C8; font-weight: bold;">event</span>) {
       <span style="color: #204A87;">//</span><span style="color: #204A87;">&#20107;&#20214;&#22788;&#29702;&#65288;&#28040;&#36153;&#65289;&#26041;&#27861;</span>
       Log.d(<span style="color: #4E9A06;">"event"</span>,CLSNAME+<span style="color: #4E9A06;">"---onTouchEvent"</span>+ EventUtils.getName(event));
       <span style="color: #A52A2A; font-weight: bold;">return</span> <span style="color: #A52A2A; font-weight: bold;">super</span>.onTouchEvent(event);
   }
</pre>

</li>
</ul>


</div>

</div>

<div id="outline-container-18-2" class="outline-3">
<h3 id="sec-18-2"><span class="section-number-3">18.2</span> 解决事件冲突</h3>
<div class="outline-text-3" id="text-18-2">




<pre class="src src-java"><span style="color: #204A87;">//</span><span style="color: #204A87;">&#35299;&#20915;ListView&#19982; ScrollView &#30340;&#22402;&#30452;&#28378;&#21160;&#20107;&#20214;&#30340;&#20914;&#31361;</span>
        listView.setOnTouchListener(<span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #F5666D;">View</span>.<span style="color: #2F8B58; font-weight: bold;">OnTouchListener</span>() {
            <span style="color: #F5666D;">@Override</span>
            <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">boolean</span> <span style="color: #0084C8; font-weight: bold;">onTouch</span>(<span style="color: #2F8B58; font-weight: bold;">View</span> <span style="color: #0084C8; font-weight: bold;">v</span>, <span style="color: #2F8B58; font-weight: bold;">MotionEvent</span> <span style="color: #0084C8; font-weight: bold;">event</span>) {
                <span style="color: #204A87;">//</span><span style="color: #204A87;">&#35831;&#27714;&#29238;&#25511;&#20214;&#19981;&#35201;&#25318;&#25130;&#20107;&#20214;</span>
                listView.getParent().requestDisallowInterceptTouchEvent(<span style="color: #F5666D;">true</span>);
                <span style="color: #A52A2A; font-weight: bold;">return</span> <span style="color: #F5666D;">false</span>;
            }
        });
</pre>

</div>
</div>

</div>

<div id="outline-container-19" class="outline-2">
<h2 id="sec-19"><span class="section-number-2">19</span> 自定义控件</h2>
<div class="outline-text-2" id="text-19">


</div>

<div id="outline-container-19-1" class="outline-3">
<h3 id="sec-19-1"><span class="section-number-3">19.1</span> 自定义控件三种类型</h3>
<div class="outline-text-3" id="text-19-1">


</div>

<div id="outline-container-19-1-1" class="outline-4">
<h4 id="sec-19-1-1"><span class="section-number-4">19.1.1</span> 扩展现有控件</h4>
<div class="outline-text-4" id="text-19-1-1">

<ul>
<li id="sec-19-1-1-1">扩展基本控件<br/>
<ul>
<li>Button
</li>
<li>TextView
</li>
<li>ImageView
</li>
</ul>


</li>
</ul>
<ul>
<li id="sec-19-1-1-2">扩展容器控件<br/>
<ul>
<li>布局控件
</li>
<li>ViewPager 控件
</li>
<li>ListView 控件
</li>
</ul>


</li>
</ul>
</div>

</div>

<div id="outline-container-19-1-2" class="outline-4">
<h4 id="sec-19-1-2"><span class="section-number-4">19.1.2</span> 完全自定义控件</h4>
<div class="outline-text-4" id="text-19-1-2">

<ul>
<li>View 或 ViewGroup 类的子类
</li>
<li>实现 onDraw() 方法来绘制内容
</li>
<li>实现 onMeasure() 方法来计算 UI 控件大小
</li>
<li>实现 onTouchEvent() 方法来处理触摸事件
</li>
<li>自定义 UI 控件的属性
</li>
</ul>


</div>

</div>

<div id="outline-container-19-1-3" class="outline-4">
<h4 id="sec-19-1-3"><span class="section-number-4">19.1.3</span> 定义高性能的控件</h4>
<div class="outline-text-4" id="text-19-1-3">

<ul>
<li>SurfaceView 的子类
</li>
<li>自定义相机
</li>
<li>自定义视频播放器
</li>
<li>游戏的画面显示
</li>
</ul>

</div>
</div>

</div>

<div id="outline-container-19-2" class="outline-3">
<h3 id="sec-19-2"><span class="section-number-3">19.2</span> 在继承的UI控件上绘图</h3>
<div class="outline-text-3" id="text-19-2">

<ul>
<li>实例一个Paint 画笔类
 一个画笔类可以设定画笔的颜色，边线，等等属性， 这一步在构建方法中完成



<pre class="src src-java"><span style="color: #204A87;">//</span><span style="color: #204A87;">1. &#22768;&#26126;&#24182;&#23454;&#20363;&#21270;&#30011;&#31508;&#23545;&#35937; Paint</span>
<span style="color: #A52A2A; font-weight: bold;">private</span> <span style="color: #2F8B58; font-weight: bold;">Paint</span> <span style="color: #0084C8; font-weight: bold;">paint</span>;
paint = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">Paint</span>();
paint.setColor(<span style="color: #F5666D;">Color</span>.RED);
paint.setStrokeWidth(5);<span style="color: #204A87;">//</span><span style="color: #204A87;">px,&#20687;&#32032;</span>
paint.setAntiAlias(<span style="color: #F5666D;">true</span>);<span style="color: #204A87;">//</span><span style="color: #204A87;">&#25239;&#38191;&#40831;</span>
</pre>

</li>
<li>在 onDraw(Canvas canvas) 方法中绘制



<pre class="src src-java"> <span style="color: #204A87;">//</span><span style="color: #204A87;">2. &#32472;&#21046;4&#26465;&#36793;&#32447;</span>
       canvas.drawLine(0,0,getWidth(),0,paint);
       canvas.drawLine(0,0,0,getHeight(),paint);
       canvas.drawLine(0,getHeight(),getWidth(),getHeight(),paint);
       canvas.drawLine(getWidth(),0,getWidth(),getHeight(),paint);


<span style="color: #204A87;">//</span><span style="color: #204A87;">&#32472;&#21046;&#19968;&#20010;&#22278;(&#22278;&#24515; &#21322;&#24452;)</span>
       canvas.drawCircle(getWidth()/2,getHeight()/2,getHeight()/2-3,circlePaint);
</pre>

</li>
<li>在 onTouchEvent(MotionEvent event) 方法中处理事件



<pre class="src src-java"><span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">boolean</span> <span style="color: #00578E; font-weight: bold;">onTouchEvent</span>(<span style="color: #2F8B58; font-weight: bold;">MotionEvent</span> <span style="color: #0084C8; font-weight: bold;">event</span>) {
       <span style="color: #204A87;">// </span><span style="color: #204A87;">&#35302;&#25720;&#20107;&#20214;&#22788;&#29702;&#26041;&#27861;</span>
       <span style="color: #A52A2A; font-weight: bold;">if</span>(event.getAction() == <span style="color: #F5666D;">MotionEvent</span>.ACTION_DOWN){
           circlePaint.setColor(<span style="color: #F5666D;">Color</span>.GREEN);
           invalidate();<span style="color: #204A87;">//</span><span style="color: #204A87;">&#21047;&#26032; UI &#25511;&#20214;</span>
           setBackgroundColor(<span style="color: #F5666D;">Color</span>.CYAN);<span style="color: #204A87;">//</span><span style="color: #204A87;">&#25353;&#19979;&#35774;&#32622;&#32972;&#26223;</span>
           <span style="color: #204A87;">//</span><span style="color: #204A87;">&#33719;&#21462;&#25353;&#19979;&#26102;&#30340;&#20570;&#21464;&#30005;</span>
           pressedPoint = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">Point</span>((<span style="color: #2F8B58; font-weight: bold;">int</span>)(event.getX()),(<span style="color: #2F8B58; font-weight: bold;">int</span>)(event.getY()));
           <span style="color: #A52A2A; font-weight: bold;">return</span> <span style="color: #F5666D;">true</span>; <span style="color: #204A87;">// </span><span style="color: #204A87;">&#22788;&#29702;&#20107;&#20214;</span>
       }<span style="color: #A52A2A; font-weight: bold;">else</span> <span style="color: #A52A2A; font-weight: bold;">if</span> (event.getAction() == <span style="color: #F5666D;">MotionEvent</span>.ACTION_UP){
           circlePaint.setColor(Color.argb(80,255,200,0));
           invalidate();<span style="color: #204A87;">//</span><span style="color: #204A87;">&#21047;&#26032; UI &#25511;&#20214;</span>
           setBackgroundColor(<span style="color: #F5666D;">Color</span>.WHITE);<span style="color: #204A87;">//</span><span style="color: #204A87;">&#25260;&#36215;&#30340;&#32972;&#26223;</span>
       }<span style="color: #A52A2A; font-weight: bold;">else</span> <span style="color: #A52A2A; font-weight: bold;">if</span>(event.getAction() == <span style="color: #F5666D;">MotionEvent</span>.ACTION_MOVE){
           <span style="color: #204A87;">//</span><span style="color: #204A87;">&#33719;&#21462;&#24403;&#21069;&#31227;&#21160;&#30340;&#28857;</span>
           <span style="color: #2F8B58; font-weight: bold;">Point</span> <span style="color: #0084C8; font-weight: bold;">movePoint</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">Point</span>((<span style="color: #2F8B58; font-weight: bold;">int</span>)(event.getX()),(<span style="color: #2F8B58; font-weight: bold;">int</span>)(event.getY()));
           <span style="color: #204A87;">//</span><span style="color: #204A87;">&#35745;&#31639;&#20559;&#31227;&#37327;</span>
           <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">xDelta</span> = movePoint.x - pressedPoint.x;
           <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">yDelta</span> = movePoint.y - pressedPoint.y;

           <span style="color: #204A87;">//</span><span style="color: #204A87;">&#31227;&#21160;UI&#25511;&#20214;</span>
           layout(getLeft()+xDelta,getTop()+yDelta,getRight()+xDelta,getBottom()+yDelta);
       }
       <span style="color: #A52A2A; font-weight: bold;">return</span> <span style="color: #A52A2A; font-weight: bold;">super</span>.onTouchEvent(event);
   }
</pre>

</li>
</ul>


</div>
</div>

</div>

<div id="outline-container-20" class="outline-2">
<h2 id="sec-20"><span class="section-number-2">20</span> 动画</h2>
<div class="outline-text-2" id="text-20">


</div>

<div id="outline-container-20-1" class="outline-3">
<h3 id="sec-20-1"><span class="section-number-3">20.1</span> View 动画 - 补间动画</h3>
<div class="outline-text-3" id="text-20-1">

<p>变化位置之间的动画，旋转平移缩放渐变等动画
</p>
</div>

<div id="outline-container-20-1-1" class="outline-4">
<h4 id="sec-20-1-1"><span class="section-number-4">20.1.1</span> 相关的类</h4>
<div class="outline-text-4" id="text-20-1-1">

</div>

</div>

<div id="outline-container-20-1-2" class="outline-4">
<h4 id="sec-20-1-2"><span class="section-number-4">20.1.2</span> 资源文件</h4>
<div class="outline-text-4" id="text-20-1-2">

<dl>
<dt>位置</dt><dd>res/anim/xx.xml
</dd>
</dl>


</div>
</div>

</div>

<div id="outline-container-20-2" class="outline-3">
<h3 id="sec-20-2"><span class="section-number-3">20.2</span> Drawable 动画 - 帧动画</h3>
<div class="outline-text-3" id="text-20-2">

<p>帧动画就是把图片一张一张的连贯起来形成动画，用来做背景动画非常合适。
</p>
</div>

<div id="outline-container-20-2-1" class="outline-4">
<h4 id="sec-20-2-1"><span class="section-number-4">20.2.1</span> 歩骤</h4>
<div class="outline-text-4" id="text-20-2-1">

<ol>
<li>在资源中加入动画套图
</li>
<li>编写 xml 文件



<pre class="src src-xml"> &lt;?<span style="color: #A52A2A; font-weight: bold;">xml</span> <span style="color: #4E9A06;">version="1.0" encoding="utf-8"</span>?&gt;
 &lt;<span style="color: #00578E; font-weight: bold;">animation-list</span> <span style="color: #A020F0;">xmlns</span>:<span style="color: #0084C8; font-weight: bold;">android</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">http://schemas.android.com/apk/res/android</span><span style="color: #4E9A06;">"</span>&gt;
    &lt;<span style="color: #00578E; font-weight: bold;">item</span> <span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">drawable</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">@drawable/waiting_001</span><span style="color: #4E9A06;">"</span> <span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">duration</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">100</span><span style="color: #4E9A06;">"</span>/&gt;
    &lt;<span style="color: #00578E; font-weight: bold;">item</span> <span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">drawable</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">@drawable/waiting_002</span><span style="color: #4E9A06;">"</span> <span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">duration</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">100</span><span style="color: #4E9A06;">"</span>/&gt;
    &lt;<span style="color: #00578E; font-weight: bold;">item</span> <span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">drawable</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">@drawable/waiting_003</span><span style="color: #4E9A06;">"</span> <span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">duration</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">100</span><span style="color: #4E9A06;">"</span>/&gt;
    &lt;<span style="color: #00578E; font-weight: bold;">item</span> <span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">drawable</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">@drawable/waiting_004</span><span style="color: #4E9A06;">"</span> <span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">duration</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">100</span><span style="color: #4E9A06;">"</span>/&gt;
    &lt;<span style="color: #00578E; font-weight: bold;">item</span> <span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">drawable</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">@drawable/waiting_005</span><span style="color: #4E9A06;">"</span> <span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">duration</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">100</span><span style="color: #4E9A06;">"</span>/&gt;
    &lt;<span style="color: #00578E; font-weight: bold;">item</span> <span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">drawable</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">@drawable/waiting_006</span><span style="color: #4E9A06;">"</span> <span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">duration</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">100</span><span style="color: #4E9A06;">"</span>/&gt;
    &lt;<span style="color: #00578E; font-weight: bold;">item</span> <span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">drawable</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">@drawable/waiting_007</span><span style="color: #4E9A06;">"</span> <span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">duration</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">100</span><span style="color: #4E9A06;">"</span>/&gt;
&lt;/<span style="color: #00578E; font-weight: bold;">animation-list</span>&gt;
</pre>

</li>
<li>将背景或其他的属性设置为 xml 文件命名
</li>
<li>在程序中添加



<pre class="src src-java"><span style="color: #2F8B58; font-weight: bold;">AnimationDrawable</span> <span style="color: #0084C8; font-weight: bold;">animationDrawable</span> = (<span style="color: #2F8B58; font-weight: bold;">AnimationDrawable</span>) imageView.getBackground();
animationDrawable.start();
</pre>

</li>
</ol>

</div>
</div>

</div>

<div id="outline-container-20-3" class="outline-3">
<h3 id="sec-20-3"><span class="section-number-3">20.3</span> Property 动画 - 属性动画</h3>
<div class="outline-text-3" id="text-20-3">

<p>使用 Animator 来完成相关属性动画。Animator 将控件能改变的属性值连贯起来形成动画，比如 ImageView 有 setTranslationY() , setScaleX() 等属性设置，只需要添加初始值和结束值， Animator 就能将属性做成动画.
</p>
</div>

<div id="outline-container-20-3-1" class="outline-4">
<h4 id="sec-20-3-1"><span class="section-number-4">20.3.1</span> 在程序中使用</h4>
<div class="outline-text-4" id="text-20-3-1">




<pre class="src src-java"><span style="color: #204A87;">//</span><span style="color: #204A87;">&#31227;&#21160;&#30340;&#23646;&#24615;&#21160;&#30011;</span>
    <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">void</span> <span style="color: #00578E; font-weight: bold;">translate</span>(<span style="color: #2F8B58; font-weight: bold;">View</span> <span style="color: #0084C8; font-weight: bold;">v</span>){
        <span style="color: #204A87;">//</span><span style="color: #204A87;">&#27839;Y&#36724;&#19979;&#31227;300px</span>
        animator = ObjectAnimator.ofFloat(imageView, <span style="color: #4E9A06;">"translationY"</span>, 0, 300);
        animator.setDuration(3000);
        animator.setRepeatCount(<span style="color: #F5666D;">ValueAnimator</span>.INFINITE);
        animator.setRepeatMode(<span style="color: #F5666D;">ValueAnimator</span>.REVERSE);
        animator.setInterpolator(<span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">AccelerateDecelerateInterpolator</span>());
        animator.start();
    }
</pre>

<p>
容器控件的属性也可以做成动画
</p>


<pre class="src src-java"><span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">void</span> <span style="color: #00578E; font-weight: bold;">bgAnim</span>(<span style="color: #2F8B58; font-weight: bold;">View</span> <span style="color: #0084C8; font-weight: bold;">v</span>){
        animator = ObjectAnimator.ofInt(imageView, <span style="color: #4E9A06;">"backgroundColor"</span>, <span style="color: #F5666D;">Color</span>.WHITE, <span style="color: #F5666D;">Color</span>.RED, <span style="color: #F5666D;">Color</span>.YELLOW, <span style="color: #F5666D;">Color</span>.BLUE, <span style="color: #F5666D;">Color</span>.GREEN);
        animator.setEvaluator((<span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">ArgbEvaluator</span>()));<span style="color: #204A87;">//</span><span style="color: #204A87;">&#39068;&#33394;&#20540;&#30340;&#25554;&#20540;</span>
        animator.setDuration(500);
        animator.setRepeatCount(<span style="color: #F5666D;">ValueAnimator</span>.INFINITE);
        animator.setRepeatMode(<span style="color: #F5666D;">ValueAnimator</span>.REVERSE);
        animator.start();
    }
</pre>

</div>

</div>

<div id="outline-container-20-3-2" class="outline-4">
<h4 id="sec-20-3-2"><span class="section-number-4">20.3.2</span> 直接使用 xml 写动画，在程序中导入</h4>
<div class="outline-text-4" id="text-20-3-2">

<p>在 Activity 中
</p>


<pre class="src src-java"><span style="color: #A52A2A; font-weight: bold;">public</span>  <span style="color: #2F8B58; font-weight: bold;">void</span> <span style="color: #00578E; font-weight: bold;">setAnimFromXml</span>(<span style="color: #2F8B58; font-weight: bold;">View</span> <span style="color: #0084C8; font-weight: bold;">v</span>){
        <span style="color: #2F8B58; font-weight: bold;">AnimatorSet</span> <span style="color: #0084C8; font-weight: bold;">animator</span> = (<span style="color: #2F8B58; font-weight: bold;">AnimatorSet</span>) AnimatorInflater.loadAnimator(<span style="color: #A52A2A; font-weight: bold;">this</span>,R.animator.cc_anim);
        animator.setTarget(imageView);
        animator.start();
    }
</pre>

<p>
R.animator.cc_anim:
</p>


<pre class="src src-xml">&lt;<span style="color: #00578E; font-weight: bold;">set</span> <span style="color: #A020F0;">xmlns</span>:<span style="color: #0084C8; font-weight: bold;">android</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">http://schemas.android.com/apk/res/android</span><span style="color: #4E9A06;">"</span> <span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">ordering</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">sequentially</span><span style="color: #4E9A06;">"</span>&gt;
    &lt;<span style="color: #00578E; font-weight: bold;">objectAnimator</span>
        <span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">duration</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">2000</span><span style="color: #4E9A06;">"</span>
        <span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">propertyName</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">alpha</span><span style="color: #4E9A06;">"</span>
        <span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">valueFrom</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">0</span><span style="color: #4E9A06;">"</span>
        <span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">valueTo</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">1</span><span style="color: #4E9A06;">"</span>
        <span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">valueType</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">floatType</span><span style="color: #4E9A06;">"</span>/&gt;

    &lt;<span style="color: #00578E; font-weight: bold;">set</span> <span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">ordering</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">together</span><span style="color: #4E9A06;">"</span> &gt;
        &lt;<span style="color: #00578E; font-weight: bold;">objectAnimator</span> <span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">propertyName</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">translationY</span><span style="color: #4E9A06;">"</span>
            <span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">valueFrom</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">0</span><span style="color: #4E9A06;">"</span>
            <span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">valueTo</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">200dp</span><span style="color: #4E9A06;">"</span>
            <span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">duration</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">2000</span><span style="color: #4E9A06;">"</span>/&gt;
        &lt;<span style="color: #00578E; font-weight: bold;">objectAnimator</span> <span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">propertyName</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">rotation</span><span style="color: #4E9A06;">"</span>
            <span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">valueFrom</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">0</span><span style="color: #4E9A06;">"</span>
            <span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">valueTo</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">720</span><span style="color: #4E9A06;">"</span>
            <span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">duration</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">2000</span><span style="color: #4E9A06;">"</span>/&gt;
    &lt;/<span style="color: #00578E; font-weight: bold;">set</span>&gt;
    &lt;<span style="color: #00578E; font-weight: bold;">objectAnimator</span>
        <span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">propertyName</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">scaleX</span><span style="color: #4E9A06;">"</span>
        <span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">valueFrom</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">1.0</span><span style="color: #4E9A06;">"</span>
        <span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">valueTo</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">0.2</span><span style="color: #4E9A06;">"</span>
        <span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">duration</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">2000</span><span style="color: #4E9A06;">"</span>
        <span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">valueType</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">floatType</span><span style="color: #4E9A06;">"</span>
        /&gt;
    &lt;<span style="color: #00578E; font-weight: bold;">objectAnimator</span>
        <span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">propertyName</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">alpha</span><span style="color: #4E9A06;">"</span>
        <span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">valueFrom</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">1</span><span style="color: #4E9A06;">"</span>
        <span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">valueTo</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">0</span><span style="color: #4E9A06;">"</span>
        <span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">duration</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">2000</span><span style="color: #4E9A06;">"</span>
        /&gt;
&lt;/<span style="color: #00578E; font-weight: bold;">set</span>&gt;
</pre>

</div>
</div>
</div>

</div>

<div id="outline-container-21" class="outline-2">
<h2 id="sec-21"><span class="section-number-2">21</span> 第三方</h2>
<div class="outline-text-2" id="text-21">


</div>

<div id="outline-container-21-1" class="outline-3">
<h3 id="sec-21-1"><span class="section-number-3">21.1</span> 第三方 SlidingMenu</h3>
<div class="outline-text-3" id="text-21-1">

<p>侧边栏
</p>
</div>

<div id="outline-container-21-1-1" class="outline-4">
<h4 id="sec-21-1-1"><span class="section-number-4">21.1.1</span> 添加一个 xml 文件</h4>
<div class="outline-text-4" id="text-21-1-1">

</div>

</div>

<div id="outline-container-21-1-2" class="outline-4">
<h4 id="sec-21-1-2"><span class="section-number-4">21.1.2</span> 在 Activity 中使用</h4>
<div class="outline-text-4" id="text-21-1-2">

<ol>
<li>实例化 SlidingMenu 的对象
</li>
<li>设置菜单的模式（左，右，左右）
</li>
<li>设置菜单的内容（主菜单，次要菜单）
</li>
<li>设置菜单布局显示的触摸方式 
<ul>
<li>none 无
</li>
<li>margin 边缘
</li>
<li>screen 整个屏幕
</li>
</ul>

</li>
<li>设置菜单布局的宽度
</li>
<li>菜单显示的模式
<ul>
<li>content
</li>
<li>window
</li>
</ul>

</li>
</ol>

<ul>
<li id="sec-21-1-2-1">例子<br/>
MainActivity.java



<pre class="src src-java"><span style="color: #204A87;">//</span><span style="color: #204A87;">1</span>
<span style="color: #A52A2A; font-weight: bold;">private</span> <span style="color: #2F8B58; font-weight: bold;">SlidingMenu</span> <span style="color: #0084C8; font-weight: bold;">slidMenu</span>;
<span style="color: #A52A2A; font-weight: bold;">public</span> onCreate(){
slidMenu = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">SlidingMenu</span>(getApplicationContext());
<span style="color: #204A87;">//</span><span style="color: #204A87;">2</span>
slidMenu.setMode(<span style="color: #F5666D;">SlidingMenu</span>.LEFT_RIGHT);
<span style="color: #204A87;">//</span><span style="color: #204A87;">3</span>
slidMenu.setMenu(R.layout.slidingmenu_left);
<span style="color: #204A87;">//</span><span style="color: #204A87;">&#35774;&#32622;&#27425;&#35201;&#33756;&#21333;</span>
slidMenu.setSceondaryMenu(R.layout.slidingmenu_second);
<span style="color: #204A87;">//</span><span style="color: #204A87;">4</span>
slidMenu.setTouchModeAbove(<span style="color: #F5666D;">SlidingMenu</span>.TOUCHMODE_FULLSCREEN);
<span style="color: #204A87;">//</span><span style="color: #204A87;">5</span>
slidMenu.setBehindWidth(300); <span style="color: #204A87;">//</span><span style="color: #204A87;">&#21333;&#20301;&#65306;&#20687;&#32032;</span>
slidMenu.setBehindWidth(getResources().getDisplayMetrics().widthPixels * 0.75f);<span style="color: #204A87;">//</span><span style="color: #204A87;">&#35774;&#32622;&#20026;&#23631;&#24149;0.75</span>
slidMenu.setBehindOffset(100);<span style="color: #204A87;">//</span><span style="color: #204A87;">&#35774;&#32622;&#33756;&#21333;&#20391;&#28369;&#20986;&#26469;&#21518;&#65292;&#20869;&#23481;&#39029;&#38754;&#26174;&#31034;&#30340;&#23485;&#24230;</span>
<span style="color: #204A87;">//</span><span style="color: #204A87;">6</span>
slidMenu.attachToActivity(<span style="color: #A52A2A; font-weight: bold;">this</span>,<span style="color: #F5666D;">SlidingMenu</span>.SLIDING_WINDOW);
<span style="color: #204A87;">//</span><span style="color: #204A87;">&#35774;&#32622;&#30417;&#21548;</span>
slidMenu.getMenu().findViewById(R.id.buttonId).setOnClickListener(<span style="color: #A52A2A; font-weight: bold;">this</span>);
slidMenu.getSceondaryMenu().findViewById(R.id.buttonId2).setOnClickListener(<span style="color: #A52A2A; font-weight: bold;">this</span>);
<span style="color: #204A87;">//</span><span style="color: #204A87;">&#38544;&#34255;&#33756;&#21333;</span>
slidMenu.toggle();
<span style="color: #204A87;">//</span><span style="color: #204A87;">&#21551;&#21160; HomeButton &#30340;&#23548;&#33322;</span>
getActionBar().setDisplayShowHomeEnable(<span style="color: #F5666D;">true</span>);
getActionBar().setDisplayHomeAsUpRnable(<span style="color: #F5666D;">true</span>);
}
<span style="color: #204A87;">//</span><span style="color: #204A87;">&#22312;&#31995;&#32479;&#33756;&#21333;&#30340;&#28857;&#20987;&#30417;&#21548;&#20013;</span>
slidMenu.isMenuShowing();<span style="color: #204A87;">//</span><span style="color: #204A87;">&#26159;&#21542;&#26174;&#31034;</span>
slidMenu.showMenu();<span style="color: #204A87;">//</span><span style="color: #204A87;">&#26174;&#31034;</span>
slidMenu.toggle();<span style="color: #204A87;">//</span><span style="color: #204A87;">&#38544;&#34255;</span>

</pre>

</li>
</ul>
</div>
</div>

</div>

<div id="outline-container-21-2" class="outline-3">
<h3 id="sec-21-2"><span class="section-number-3">21.2</span> bdmap</h3>
<div class="outline-text-3" id="text-21-2">

<pre class="example">
adb push vmp /mnt/....
</pre>

<p>离线数据包
</p><pre class="example">
MKOfflineMap
</pre>


<p>
OverlayOptions 常用地图图层类
</p>

</div>

<div id="outline-container-21-2-1" class="outline-4">
<h4 id="sec-21-2-1"><span class="section-number-4">21.2.1</span> 开始百度地图</h4>
<div class="outline-text-4" id="text-21-2-1">

<ol>
<li>将工具包解压到工作控件， 如果是 Android Studio,其中的armeabi 文件夹需要放在 
<pre class="example">
src/main 
</pre>

<p> 目录下，或者依旧放在libs 文件夹下，但是要修改 gradle 
</p><pre class="example">
在 android 下加上
</pre>




<pre class="src src-java">sourceSets {
        main {
            jniLibs.srcDirs = [<span style="color: #4E9A06;">'libs'</span>]
        }
}
</pre>

</li>
<li>在清单文件中添加相关内容
<pre class="example">
AndroidMainifest
</pre>




<pre class="src src-java">    &lt;uses-permission android:name=<span style="color: #4E9A06;">"android.permission.ACCESS_NETWORK_STATE"</span>/&gt;
    &lt;uses-permission android:name=<span style="color: #4E9A06;">"android.permission.INTERNET"</span>/&gt;
    &lt;uses-permission android:name=<span style="color: #4E9A06;">"com.android.launcher.permission.READ_SETTINGS"</span> /&gt;
    &lt;uses-permission android:name=<span style="color: #4E9A06;">"android.permission.WAKE_LOCK"</span>/&gt;
    &lt;uses-permission android:name=<span style="color: #4E9A06;">"android.permission.CHANGE_WIFI_STATE"</span> /&gt;
    &lt;uses-permission android:name=<span style="color: #4E9A06;">"android.permission.ACCESS_WIFI_STATE"</span> /&gt;
    &lt;uses-permission android:name=<span style="color: #4E9A06;">"android.permission.GET_TASKS"</span> /&gt;
    &lt;uses-permission android:name=<span style="color: #4E9A06;">"android.permission.WRITE_EXTERNAL_STORAGE"</span>/&gt;
    &lt;uses-permission android:name=<span style="color: #4E9A06;">"android.permission.WRITE_SETTINGS"</span> /&gt;
    &lt;uses-permission android:name=<span style="color: #4E9A06;">"android.permission.READ_PHONE_STATE"</span>/&gt;

&lt;application
        &lt;meta-data
            android:name=<span style="color: #4E9A06;">"com.baidu.lbsapi.API_KEY"</span>
            android:value=<span style="color: #4E9A06;">"ELHDxaGogIPaV2R1HYYaEl3x"</span> /&gt;
&lt;/application&gt;

</pre>

</li>
<li>在 xml 中加入 com.baidu.mapapi.MapView 
<pre class="example">
acticity_main.xml
</pre>




<pre class="src src-xml">&lt;<span style="color: #00578E; font-weight: bold;">com.baidu.mapapi.map.MapView</span>
<span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">id</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">@+id/bmapView</span><span style="color: #4E9A06;">"</span>
<span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">layout_width</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">fill_parent</span><span style="color: #4E9A06;">"</span>
<span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">layout_height</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">fill_parent</span><span style="color: #4E9A06;">"</span>
<span style="color: #A020F0;">android</span>:<span style="color: #0084C8; font-weight: bold;">clickable</span>=<span style="color: #4E9A06;">"</span><span style="color: #4E9A06;">true</span><span style="color: #4E9A06;">"</span> /&gt;
</pre>

</li>
<li>在 Activity 中初始化
<pre class="example">
MainActivity.java
</pre>




<pre class="src src-java"><span style="color: #F5666D;">@Override</span>
<span style="color: #A52A2A; font-weight: bold;">protected</span> <span style="color: #2F8B58; font-weight: bold;">void</span> <span style="color: #00578E; font-weight: bold;">onCreate</span>(<span style="color: #2F8B58; font-weight: bold;">Bundle</span> <span style="color: #0084C8; font-weight: bold;">savedInstanceState</span>) {
    <span style="color: #A52A2A; font-weight: bold;">super</span>.onCreate(savedInstanceState);
    <span style="color: #204A87;">//</span><span style="color: #204A87;">&#36825;&#34892;&#28155;&#21152;&#22312; setContentView &#19978;&#38754;</span>
    SDKInitializer.initialize(getApplicationContext());
    setContentView(R.layout.activity_main);
    mapView = (<span style="color: #2F8B58; font-weight: bold;">MapView</span>) findViewById(R.id.bmapView);
    baiduMap = mapView.getMap();<span style="color: #204A87;">//</span><span style="color: #204A87;">&#33719;&#21462;&#22320;&#22270; UI &#30340;&#22320;&#22270;&#31649;&#29702;&#23545;&#35937;</span>
}
</pre>

</li>
<li>将离线地图导入到应用中
<pre class="example">
在一个 Button 的单击事件中
</pre>




<pre class="src src-java"><span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">void</span> <span style="color: #00578E; font-weight: bold;">click</span>(<span style="color: #2F8B58; font-weight: bold;">View</span> <span style="color: #0084C8; font-weight: bold;">view</span>){
     <span style="color: #2F8B58; font-weight: bold;">MKOfflineMap</span> <span style="color: #0084C8; font-weight: bold;">mkOfflineMap</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">MKOfflineMap</span>();
     mkOfflineMap.init(<span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">MKOfflineMapListener</span>() {
         <span style="color: #F5666D;">@Override</span>
         <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">void</span> <span style="color: #00578E; font-weight: bold;">onGetOfflineMapState</span>(<span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">type</span>, <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">state</span>) {
             <span style="color: #A52A2A; font-weight: bold;">if</span> (type == <span style="color: #F5666D;">MKOfflineMap</span>.TYPE_NEW_OFFLINE) {
                 Log.d(<span style="color: #4E9A06;">"cc"</span>,<span style="color: #4E9A06;">"&#25104;&#21151;&#23548;&#20837;&#31163;&#32447;&#21253;&#65292;&#21487;&#20197;&#22312;&#19979;&#36733;&#31649;&#29702;&#26597;&#30475;"</span>);
             }
         }
     });
     <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">count</span> = mkOfflineMap.importOfflineData(<span style="color: #F5666D;">false</span>);<span style="color: #204A87;">//</span><span style="color: #204A87;">&#23548;&#31163;&#32447;&#25968;&#25454;&#21253;,&#36820;&#22238;&#28155;&#21152;&#30340;&#20010;&#25968;</span>
     <span style="color: #A52A2A; font-weight: bold;">if</span> (count &gt; 0 ){
         Log.d(<span style="color: #4E9A06;">"cc"</span>,<span style="color: #4E9A06;">"&#23548;&#20837;&#25104;&#21151;"</span>);
     }
 }
</pre>

</li>
</ol>

<p>这样一个基本的地图就出现在应用当中了
</p></div>

</div>

<div id="outline-container-21-2-2" class="outline-4">
<h4 id="sec-21-2-2"><span class="section-number-4">21.2.2</span> 为地图加标注</h4>
<div class="outline-text-4" id="text-21-2-2">

<p>想为地图加一个自己的标注
</p>


<pre class="src src-java">    <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">void</span> <span style="color: #00578E; font-weight: bold;">addMarker</span>(<span style="color: #2F8B58; font-weight: bold;">View</span> <span style="color: #0084C8; font-weight: bold;">v</span>){
        <span style="color: #2F8B58; font-weight: bold;">MarkerOptions</span> <span style="color: #0084C8; font-weight: bold;">markerOptions</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">MarkerOptions</span>()
                .position(<span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">LatLng</span>(40.0,116.0))<span style="color: #204A87;">//</span><span style="color: #204A87;">&#32500;&#24230;  &#32463;&#24230;</span>
                .icon(BitmapDescriptorFactory.fromResource(R.drawable.icon_marka))
                .title(<span style="color: #4E9A06;">"&#33258;&#23450;&#20041;&#26631;&#27880;"</span>);
        <span style="color: #204A87;">//</span><span style="color: #204A87;">&#22270;&#29255;&#28155;&#21152;&#21040;&#22320;&#22270;</span>
        baiduMap.addOverlay(markerOptions);
        <span style="color: #204A87;">//</span><span style="color: #204A87;">&#23558;&#22320;&#22270;&#30340;&#20013;&#24515;&#20301;&#32622;&#31227;&#21160;&#21040;&#26631;&#27880;&#20301;&#32622;&#24182;&#26041;&#27861;&#22270;&#23618;&#30340;&#32423;&#21035;</span>
        baiduMap.setMapStatus(MapStatusUpdateFactory.newLatLngZoom(<span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">LatLng</span>(40.0,116.0),15));
        <span style="color: #204A87;">//</span><span style="color: #204A87;">&#31532;&#20108;&#31181;&#26041;&#27861;</span>
<span style="color: #204A87;">//        </span><span style="color: #204A87;">baiduMap.setMapStatus(MapStatusUpdateFactory.newMapStatus(new MapStatus.Builder()</span>
<span style="color: #204A87;">//                </span><span style="color: #204A87;">.target(new LatLng(40.0,116.0))</span>
<span style="color: #204A87;">//                </span><span style="color: #204A87;">.zoom(15)</span>
<span style="color: #204A87;">//                </span><span style="color: #204A87;">.rotate(45)</span>
<span style="color: #204A87;">//                </span><span style="color: #204A87;">.overlook(45)</span>
<span style="color: #204A87;">//                </span><span style="color: #204A87;">.build()));</span>

        baiduMap.setOnMarkerClickListener(<span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #F5666D;">BaiduMap</span>.<span style="color: #2F8B58; font-weight: bold;">OnMarkerClickListener</span>() {
            <span style="color: #F5666D;">@Override</span>
            <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">boolean</span> <span style="color: #00578E; font-weight: bold;">onMarkerClick</span>(<span style="color: #2F8B58; font-weight: bold;">Marker</span> <span style="color: #0084C8; font-weight: bold;">marker</span>) {
                Toast.makeText(getApplicationContext(),
                        <span style="color: #4E9A06;">"---&gt;"</span>+marker.getTitle(),<span style="color: #F5666D;">Toast</span>.LENGTH_LONG).show();
                <span style="color: #2F8B58; font-weight: bold;">TextView</span> <span style="color: #0084C8; font-weight: bold;">textView</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">TextView</span>(getApplicationContext());
                textView.setText(marker.getTitle());
                textView.setBackgroundResource(R.drawable.popup);
                textView.setPadding(10, 20, 10, 20);
                textView.setOnClickListener(<span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #F5666D;">View</span>.<span style="color: #2F8B58; font-weight: bold;">OnClickListener</span>() {
                    <span style="color: #F5666D;">@Override</span>
                    <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">void</span> <span style="color: #00578E; font-weight: bold;">onClick</span>(<span style="color: #2F8B58; font-weight: bold;">View</span> <span style="color: #0084C8; font-weight: bold;">v</span>) {
                        <span style="color: #204A87;">//</span><span style="color: #204A87;">&#38544;&#34255;InfoMindow</span>
                        baiduMap.hideInfoWindow();
                    }
                });
                <span style="color: #204A87;">//</span><span style="color: #204A87;">&#24377;&#20986;&#20449;&#24687;&#31383;&#21475;</span>
                <span style="color: #2F8B58; font-weight: bold;">InfoWindow</span> <span style="color: #0084C8; font-weight: bold;">infoWindow</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">InfoWindow</span>(textView,marker.getPosition(),-150);
                baiduMap.showInfoWindow(infoWindow);
                <span style="color: #A52A2A; font-weight: bold;">return</span> <span style="color: #F5666D;">false</span>;
            }
        });
    }
</pre>


</div>

</div>

<div id="outline-container-21-2-3" class="outline-4">
<h4 id="sec-21-2-3"><span class="section-number-4">21.2.3</span> <span class="todo TODO">TODO</span> 地图检索</h4>
<div class="outline-text-4" id="text-21-2-3">

<p>表示是否首次定位
</p>
</div>
</div>

</div>

<div id="outline-container-21-3" class="outline-3">
<h3 id="sec-21-3"><span class="section-number-3">21.3</span> Volley</h3>
<div class="outline-text-3" id="text-21-3">


</div>

<div id="outline-container-21-3-1" class="outline-4">
<h4 id="sec-21-3-1"><span class="section-number-4">21.3.1</span> 初步操作</h4>
<div class="outline-text-4" id="text-21-3-1">

<ol>
<li>StringRequest GET
</li>
<li>JSONObject
</li>
<li>ImageRequest
</li>
</ol>


</div>

</div>

<div id="outline-container-21-3-2" class="outline-4">
<h4 id="sec-21-3-2"><span class="section-number-4">21.3.2</span> 图片加载</h4>
<div class="outline-text-4" id="text-21-3-2">

<ol>
<li>ImageRequest 加载 Bitmap
</li>
<li>ImageLoader 加载
</li>
<li>NetworkImageView 加载
</li>
</ol>

<ul>
<li id="sec-21-3-2-1">ImageLoader<br/>
<ol>
<li>LruChche 构造方法，如果 LruCache 重写了 sizeOf(), 那么构造参数代表占用的最大内存尺寸
</li>
<li>如果 LruCache 补重写 sizeOf(),代表最多能存多少个对象
</li>
</ol>


</li>
</ul>
<ul>
<li id="sec-21-3-2-2">NewworkImageView<br/>
<ol>
<li>两种加载方式
<ol>
<li>ImageLoader 直接加载
</li>
<li>NewworkImageView 
</li>
</ol>

</li>
</ol>

</li>
</ul>
</div>

</div>

<div id="outline-container-21-3-3" class="outline-4">
<h4 id="sec-21-3-3"><span class="section-number-4">21.3.3</span> 下载图片处理</h4>
<div class="outline-text-4" id="text-21-3-3">

<ol>
<li>创建 ImageLoader 的ImageListener 监听器
</li>
<li>实例化 ImageLoader 同时实现 ImageCache 缓存
</li>
<li>通过 ImageLoader 加载图片资源，同时使用 ImageListener 监听
</li>
</ol>


</div>

</div>

<div id="outline-container-21-3-4" class="outline-4">
<h4 id="sec-21-3-4"><span class="section-number-4">21.3.4</span> 三级缓存</h4>
<div class="outline-text-4" id="text-21-3-4">




<pre class="src src-java"></pre>


</div>
</div>

</div>

<div id="outline-container-21-4" class="outline-3">
<h3 id="sec-21-4"><span class="section-number-3">21.4</span> XUtils</h3>
<div class="outline-text-3" id="text-21-4">


</div>

<div id="outline-container-21-4-1" class="outline-4">
<h4 id="sec-21-4-1"><span class="section-number-4">21.4.1</span> 客户端系统架构</h4>
<div class="outline-text-4" id="text-21-4-1">

</div>

</div>

<div id="outline-container-21-4-2" class="outline-4">
<h4 id="sec-21-4-2"><span class="section-number-4">21.4.2</span> 注解</h4>
<div class="outline-text-4" id="text-21-4-2">

<ul>
<li id="sec-21-4-2-1">属性和参数<br/>
<ol>
<li>需要在源代码开发时指定，不会改变
</li>
<li>代码中的注解在编译后，固化在 class 文件当中
</li>
<li>通过反射，可以获取成员变量的注解信息以及获取注解的参数
</li>
</ol>

</li>
</ul>
<ul>
<li id="sec-21-4-2-2">一个例子<br/>
类型选择： Annotation , 类名 CodeAuthor

<p>
CodeAuthor.java
</p>


<pre class="src src-java"><span style="color: #204A87;">//</span><span style="color: #204A87;">&#25351;&#23450;&#27880;&#35299;&#24212;&#29992;&#30340;&#20301;&#32622;</span>
<span style="color: #F5666D;">@Target</span>(<span style="color: #F5666D;">ElementType</span>.<span style="color: #2F8B58; font-weight: bold;">FIELD</span>)
<span style="color: #204A87;">//</span><span style="color: #204A87;">&#25351;&#23450;&#27880;&#35299;&#30340;&#20316;&#29992;&#33539;&#22260; RUNTIME &#20195;&#34920;&#22312;&#36816;&#34892;&#30340;&#26102;&#20505;&#21487;&#20197;&#33719;&#21462;&#27880;&#35299;</span>
<span style="color: #F5666D;">@Retention</span>(RetentionPolicy.)
<span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #A52A2A; font-weight: bold;">@interface</span> <span style="color: #2F8B58; font-weight: bold;">CodeAuthor</span>{
<span style="color: #204A87;">//</span><span style="color: #204A87;">&#20195;&#34920;&#24403;&#21069;&#27880;&#35299;&#21253;&#21547;&#19968;&#20010;&#21483;&#20570; value &#30340;&#23646;&#24615;</span>
<span style="color: #204A87;">//</span><span style="color: #204A87;">&#22312;&#27880;&#35299;&#35774;&#32622;&#23646;&#24615;&#30340;&#26102;&#20505;&#65292;&#30452;&#25509;&#23601;&#26159; value = xxx</span>
<span style="color: #204A87;">//</span><span style="color: #204A87;">&#27880;&#35299;&#20013; value &#23646;&#20110;&#40664;&#35748;&#23646;&#24615;&#65292; &#19981;&#38656;&#35201;&#20889;&#20986;&#26469;</span>
<span style="color: #204A87;">//</span><span style="color: #204A87;">CodeAuthor()</span>
    <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #00578E; font-weight: bold;">value</span>();

}
</pre>

<p>
MainActivity.java
</p>


<pre class="src src-java"><span style="color: #204A87;">//</span><span style="color: #204A87;">&#21453;&#23556;&#22788;&#29702;</span>
<span style="color: #2F8B58; font-weight: bold;">Class</span> <span style="color: #0084C8; font-weight: bold;">c</span> = <span style="color: #A52A2A; font-weight: bold;">this</span>.getClass();
c.getDeclaredField(<span style="color: #4E9A06;">"String"</span>);<span style="color: #204A87;">//</span><span style="color: #204A87;">&#25104;&#21592;&#21464;&#37327;</span>
field.setAccessible(<span style="color: #F5666D;">true</span>);
<span style="color: #204A87;">//</span><span style="color: #204A87;">&#20174;&#25104;&#21592;&#21464;&#37327;&#20013;&#33719;&#21462;&#27880;&#35299;</span>
<span style="color: #2F8B58; font-weight: bold;">CodeAuthor</span> <span style="color: #0084C8; font-weight: bold;">annotation</span> = field.getAnnotation(CodeAuthor.<span style="color: #A52A2A; font-weight: bold;">class</span>);
<span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">v</span> = annotation.value();
<span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">str</span> = getString(v);
<span style="color: #204A87;">//</span><span style="color: #204A87;">&#36171;&#20540;</span>
field.set(<span style="color: #A52A2A; font-weight: bold;">this</span>,<span style="color: #4E9A06;">"Author:"</span>+v);

<span style="color: #F5666D;">@ResInject</span>(id = R.string,app_name,type = <span style="color: #F5666D;">ResType</span>.String);
<span style="color: #A52A2A; font-weight: bold;">private</span> <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">string</span>;
<span style="color: #F5666D;">@CodeAuthor</span>(3)
<span style="color: #A52A2A; font-weight: bold;">private</span> <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">string</span>;
<span style="color: #F5666D;">@CodeAuthor</span>
<span style="color: #A52A2A; font-weight: bold;">private</span> <span style="color: #2F8B58; font-weight: bold;">void</span> <span style="color: #00578E; font-weight: bold;">test</span>(){

}
</pre>

<p>
fragment.java
</p>


<pre class="src src-java">onCreateView(...){
   <span style="color: #2F8B58; font-weight: bold;">View</span> <span style="color: #0084C8; font-weight: bold;">view</span> = ...;
   ViewUtils.inject(<span style="color: #A52A2A; font-weight: bold;">this</span>,view);
   <span style="color: #A52A2A; font-weight: bold;">return</span> view;
}
</pre>



</li>
</ul>
</div>
</div>

</div>

<div id="outline-container-21-5" class="outline-3">
<h3 id="sec-21-5"><span class="section-number-3">21.5</span> 友盟 nmeng</h3>
<div class="outline-text-3" id="text-21-5">

<p><a href="http://www.umeng.com">http://www.umeng.com</a>
</p><ul>
<li>主要提供软件使用的统计分析的功能。
</li>
<li>提供推广信息
</li>
</ul>

</div>

</div>

<div id="outline-container-21-6" class="outline-3">
<h3 id="sec-21-6"><span class="section-number-3">21.6</span> ShareSDK</h3>
<div class="outline-text-3" id="text-21-6">

<p><a href="http://www.mob.com">http://www.mob.com</a>
</p>

</div>

<div id="outline-container-21-6-1" class="outline-4">
<h4 id="sec-21-6-1"><span class="section-number-4">21.6.1</span> 开发歩骤</h4>
<div class="outline-text-4" id="text-21-6-1">

</div>
</div>
</div>

</div>

<div id="outline-container-22" class="outline-2">
<h2 id="sec-22"><span class="section-number-2">22</span> IDEA</h2>
<div class="outline-text-2" id="text-22">


</div>

<div id="outline-container-22-1" class="outline-3">
<h3 id="sec-22-1"><span class="section-number-3">22.1</span> 常见问题</h3>
<div class="outline-text-3" id="text-22-1">

<ol>
<li>OLDER_SDK
 清单文件最小的版本高于手机版本,修改行单文件的最低版本即可.
</li>
<li>导入 support 支持包
 将支持包放入 libs 中，右键添加 add as Library
</li>
<li>编译正常，无法运行
 设置环境变量
<ol>
<li>JAVA_HOME，不能用空格，如果用了，全部路径加上""
</li>
<li>ANDROID_HOME android SDK 根目录
</li>
<li>ANDROID_SDK_HOME android 模拟器存放的位置
</li>
</ol>

</li>
</ol>


</div>

</div>

<div id="outline-container-22-2" class="outline-3">
<h3 id="sec-22-2"><span class="section-number-3">22.2</span> 快捷键</h3>
<div class="outline-text-3" id="text-22-2">

<ol>
<li>C+i 实现接口，抽象方法
</li>
<li>C+o 重写方法
</li>
<li>C+A+v 将变量提出成局部变量
</li>
<li>快速完成
<ol>
<li>fori for循环的简写
</li>
</ol>

</li>
<li>C+A+f 提出成成员变量
</li>
</ol>


</div>
</div>

</div>

<div id="outline-container-23" class="outline-2">
<h2 id="sec-23"><span class="section-number-2">23</span> Android 高级课程</h2>
<div class="outline-text-2" id="text-23">


</div>

<div id="outline-container-23-1" class="outline-3">
<h3 id="sec-23-1"><span class="section-number-3">23.1</span> 图片的加载与显示</h3>
<div class="outline-text-3" id="text-23-1">


</div>

<div id="outline-container-23-1-1" class="outline-4">
<h4 id="sec-23-1-1"><span class="section-number-4">23.1.1</span> 图片错位的第二种处理办法</h4>
<div class="outline-text-4" id="text-23-1-1">

<ul>
<li id="sec-23-1-1-1">图片错位的原因<br/>
由于 ImageView 的复用， 异步任务的延迟， 可能造成一个 ImageView 加载多个异步任务的图片，造成图片闪烁或错位

<p>
在之前的 ListView 使用中使用 Tag 来防止图片错位， 简述如下：
</p><ol>
<li>ImageView 指定 Tag
</li>
<li>AsyncTask 判断 Tag
</li>
<li>Tag 就是图片地址
</li>
<li>在 getView() 中，getTag() 来防止错位
</li>
</ol>



<ul>
<li id="sec-23-1-1-1-1"><span class="done DONE">DONE</span> 第二种办法<br/>
利用 ImageView 的 Drawable 对象来解决错位。 在 Drawable 中有一个 AsyncTask ，用来确保一个 ImageView 一个 AsyncTask

<p>
Google 官方代码
</p>


<pre class="src src-java"><span style="color: #A52A2A; font-weight: bold;">static</span> <span style="color: #A52A2A; font-weight: bold;">class</span> <span style="color: #2F8B58; font-weight: bold;">AsyncDrawable</span> <span style="color: #A52A2A; font-weight: bold;">extends</span> <span style="color: #2F8B58; font-weight: bold;">BitmapDrawable</span> {
    <span style="color: #204A87;">// </span><span style="color: #204A87;">&#22270;&#29255;&#21152;&#36733;&#24322;&#27493;&#20219;&#21153;&#30340;&#24369;&#24341;&#29992;</span>
    <span style="color: #A52A2A; font-weight: bold;">private</span> <span style="color: #A52A2A; font-weight: bold;">final</span> <span style="color: #2F8B58; font-weight: bold;">WeakReference</span>&lt;BitmapWorkerTask&gt; bitmapWorkerTaskReference;
    <span style="color: #204A87;">// </span><span style="color: #204A87;">&#26500;&#36896;&#26041;&#27861;</span>
    <span style="color: #A52A2A; font-weight: bold;">public</span> AsyncDrawable(<span style="color: #2F8B58; font-weight: bold;">Resources</span> <span style="color: #0084C8; font-weight: bold;">res</span>, <span style="color: #2F8B58; font-weight: bold;">Bitmap</span> <span style="color: #0084C8; font-weight: bold;">bitmap</span>,
            <span style="color: #2F8B58; font-weight: bold;">BitmapWorkerTask</span> <span style="color: #0084C8; font-weight: bold;">bitmapWorkerTask</span>) {
        <span style="color: #A52A2A; font-weight: bold;">super</span>(res, bitmap);
        bitmapWorkerTaskReference =
            <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">WeakReference</span>&lt;BitmapWorkerTask&gt;(bitmapWorkerTask);
    }
    <span style="color: #204A87;">// </span><span style="color: #204A87;">&#26292;&#38706;&#20986;&#26469;&#30340;&#24471;&#21040;&#24322;&#27493;&#20219;&#21153;&#30340;&#26041;&#27861;</span>
    <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">BitmapWorkerTask</span> <span style="color: #00578E; font-weight: bold;">getBitmapWorkerTask</span>() {
        <span style="color: #A52A2A; font-weight: bold;">return</span> bitmapWorkerTaskReference.get();
    }
}

<span style="color: #204A87;">// </span><span style="color: #204A87;">&#20043;&#21518;&#22312;&#38656;&#35201;&#35843;&#29992;&#26102;&#35843;&#29992;&#36825;&#20010;&#26041;&#27861;</span>
<span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">void</span> <span style="color: #00578E; font-weight: bold;">loadBitmap</span>(<span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">resId</span>, <span style="color: #2F8B58; font-weight: bold;">ImageView</span> <span style="color: #0084C8; font-weight: bold;">imageView</span>) {
    <span style="color: #A52A2A; font-weight: bold;">if</span> (cancelPotentialWork(resId, imageView)) {
        <span style="color: #A52A2A; font-weight: bold;">final</span> <span style="color: #2F8B58; font-weight: bold;">BitmapWorkerTask</span> <span style="color: #0084C8; font-weight: bold;">task</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">BitmapWorkerTask</span>(imageView);
        <span style="color: #A52A2A; font-weight: bold;">final</span> <span style="color: #2F8B58; font-weight: bold;">AsyncDrawable</span> <span style="color: #0084C8; font-weight: bold;">asyncDrawable</span> =
                <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">AsyncDrawable</span>(getResources(), mPlaceHolderBitmap, task);
        imageView.setImageDrawable(asyncDrawable);
        task.execute(resId);
    }
}
</pre>


</li>
</ul>
</li>
</ul>
</div>

</div>

<div id="outline-container-23-1-2" class="outline-4">
<h4 id="sec-23-1-2"><span class="section-number-4">23.1.2</span> 图片缓存</h4>
<div class="outline-text-4" id="text-23-1-2">


<ul>
<li id="sec-23-1-2-1"><span class="done DONE">DONE</span> 内存缓存<br/>
<ol>
<li>图片缓存使用二级缓存 （内存 + 文件）
</li>
<li>内存缓存， 储存的时 url -&gt; Bitmap
</li>
<li>内存缓存命名 ImageCache 单例对象
</li>
</ol>


<ul>
<li id="sec-23-1-2-1-1">LruCache<br/>
<ol>
<li>使用 LRU 算法，最近最少使用原则
</li>
<li>构造方法需要设置缓存占用的最大值
</li>
<li>当创建 LruCache 没有重写 sizeOf 方法，最大参数表示代码能存多少个条目
</li>
<li>当创建的 LruCache 重写了 sizeOf 方法，参数就代表所有条目的尺寸的总和最大值
</li>
<li>LruCache 内部存储采用强引用
</li>
</ol>

</li>
</ul>
</li>
</ul>
<ul>
<li id="sec-23-1-2-2">文件缓存<br/>
在之前的处理中都是得到一个图片 URL 的地址中个图片名称，这样做依旧有可能重名而且繁琐，现在利用 MD5 来命名。并且 Android 为程序设置了内存缓存，存放于



<pre class="src src-java">Context.getExternalCacheDir() <span style="color: #204A87;">// </span><span style="color: #204A87;">&#29992;&#26469;&#24471;&#21040;&#32531;&#23384;&#30446;&#24405;</span>
Context.getCacheDir() <span style="color: #204A87;">// </span><span style="color: #204A87;">&#33719;&#21462;&#25163;&#26426;&#20869;&#37096;&#20013;&#30340;&#32531;&#23384;&#30446;&#24405;</span>
</pre>

<ul>
<li id="sec-23-1-2-2-1">MD5 Hex编解码<br/>
MD5 即 MessageDegist 消息摘要 第五版，



<pre class="src src-java"><span style="color: #4E9A06;">/**</span>
<span style="color: #4E9A06;"> * &#23558;&#32593;&#22336;&#26144;&#23556;&#20026;&#25991;&#20214;&#21517;</span>
<span style="color: #4E9A06;"> */</span>
<span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #A52A2A; font-weight: bold;">static</span> <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #00578E; font-weight: bold;">MD5</span>(<span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">url</span>){
    <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">ret</span> = <span style="color: #F5666D;">null</span>;
    <span style="color: #A52A2A; font-weight: bold;">if</span> (url != <span style="color: #F5666D;">null</span>){
        <span style="color: #A52A2A; font-weight: bold;">try</span> {
            <span style="color: #204A87;">// </span><span style="color: #204A87;">&#21019;&#24314;&#28040;&#24687;&#25688;&#35201; &#20351;&#29992;MD5&#31639;&#27861;</span>
            <span style="color: #2F8B58; font-weight: bold;">MessageDigest</span> <span style="color: #0084C8; font-weight: bold;">digest</span> = MessageDigest.getInstance(<span style="color: #4E9A06;">"MD5"</span>);
            <span style="color: #2F8B58; font-weight: bold;">byte</span>[] <span style="color: #0084C8; font-weight: bold;">data</span> = digest.digest(url.getBytes());
            <span style="color: #204A87;">// </span><span style="color: #204A87;">&#35745;&#31639; url &#23545;&#24212;&#30340; MD5 &#29983;&#25104;&#30340;&#25968;&#25454;,&#20869;&#37096;&#21253;&#21547;&#20102;&#19981;&#21487;&#26174;&#31034;&#30340;&#23383;&#33410;&#65292;&#38656;&#35201;&#32534;&#30721;&#36716;&#21270;&#20026;&#23383;&#31526;&#20018;</span>
            <span style="color: #204A87;">// </span><span style="color: #204A87;">&#19981;&#35201;&#20351;&#29992; new String(byte[]);  &#38656;&#35201;&#36716;&#21270;&#25104;0x</span>
            <span style="color: #204A87;">// </span><span style="color: #204A87;">byte[] &#27599;&#19968;&#20010;&#23383;&#33410;&#36716;&#25442;&#20026; 16&#36827;&#21046; &#24182;&#19988;&#25340;&#25509;&#25104;&#19968;&#20010;&#23383;&#31526;&#20018;</span>
            ret = toHex(data);
        } <span style="color: #A52A2A; font-weight: bold;">catch</span> (<span style="color: #2F8B58; font-weight: bold;">NoSuchAlgorithmException</span> <span style="color: #0084C8; font-weight: bold;">e</span>) {
            e.printStackTrace();
        }
    }
    <span style="color: #A52A2A; font-weight: bold;">return</span> ret;
}
<span style="color: #4E9A06;">/**</span>
<span style="color: #4E9A06;"> * &#23558;&#23383;&#33410;&#25968;&#32452;&#36716;&#21270;&#20026;16&#36827;&#21046;&#32534;&#30721;&#23383;&#31526;&#20018;</span>
<span style="color: #4E9A06;"> */</span>
<span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #A52A2A; font-weight: bold;">static</span> <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #00578E; font-weight: bold;">toHex</span>(<span style="color: #2F8B58; font-weight: bold;">byte</span>[] <span style="color: #0084C8; font-weight: bold;">data</span>){
    <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">ret</span> = <span style="color: #F5666D;">null</span>;
    <span style="color: #A52A2A; font-weight: bold;">if</span> (data != <span style="color: #F5666D;">null</span> &amp;&amp; data.length &gt; 0 ){
        <span style="color: #2F8B58; font-weight: bold;">StringBuilder</span> <span style="color: #0084C8; font-weight: bold;">stringBuilder</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">StringBuilder</span>();
        <span style="color: #A52A2A; font-weight: bold;">for</span> (<span style="color: #2F8B58; font-weight: bold;">byte</span> <span style="color: #0084C8; font-weight: bold;">b</span> : data){
            <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">v</span> = b &amp; 0x0FF;
            <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">hex</span> = Integer.toHexString(v);
            <span style="color: #A52A2A; font-weight: bold;">if</span> (v &gt; 0x0F){
                stringBuilder.append(hex);
            }<span style="color: #A52A2A; font-weight: bold;">else</span> {
                stringBuilder.append(<span style="color: #4E9A06;">'0'</span>).append(hex);
            }
        }
        ret = stringBuilder.toString();
    }
    <span style="color: #A52A2A; font-weight: bold;">return</span> ret;  
}
</pre>


</li>
</ul>
</li>
</ul>
<ul>
<li id="sec-23-1-2-3">图片加载任务升级版<br/>
<ul>
<li>异步任务中 ImageView 变量采用弱引用方式
</li>
<li>使用弱引用是为了避免 Activity 或 UI 在销毁后异步任务还保存着对象引用的问题。
</li>
</ul>

</li>
</ul>
</div>

</div>

<div id="outline-container-23-1-3" class="outline-4">
<h4 id="sec-23-1-3"><span class="section-number-4">23.1.3</span> <span class="done DONE">DONE</span> 处理大图片</h4>
<div class="outline-text-4" id="text-23-1-3">

<p>大图片直接载入容易出现 OOM(OutOfMemoryError) 内存溢出错误，需要使用图片二次采样
</p>
<p>
在 BitmapFactory中可以设置只取得图片的尺寸，再根据实际宽高进行计算，得到一个缩小倍数，达到将图片缩小的目的
</p><ul>
<li id="sec-23-1-3-1">Options 说明<br/>
<ul>
<li>成员变量作为配置信息传给解码器
</li>
<li>变量分为两部分 in&hellip; out&hellip;
<ul>
<li>in&hellip; 用于给解码器传递参数
</li>
<li>out&hellip; 用于从解码器获取结果
</li>
</ul>

</li>
</ul>


</li>
</ul>
<ul>
<li id="sec-23-1-3-2">java 代码<br/>



<pre class="src src-java"><span style="color: #A52A2A; font-weight: bold;">private</span> <span style="color: #2F8B58; font-weight: bold;">Bitmap</span> <span style="color: #00578E; font-weight: bold;">getBitmapUseOption</span>(<span style="color: #2F8B58; font-weight: bold;">Bitmap</span> <span style="color: #0084C8; font-weight: bold;">ret</span>, <span style="color: #2F8B58; font-weight: bold;">byte</span>[] <span style="color: #0084C8; font-weight: bold;">data</span>) {
        <span style="color: #F5666D;">BitmapFactory</span>.<span style="color: #2F8B58; font-weight: bold;">Options</span> <span style="color: #0084C8; font-weight: bold;">options</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #F5666D;">BitmapFactory</span>.<span style="color: #2F8B58; font-weight: bold;">Options</span>();
        <span style="color: #204A87;">// </span><span style="color: #204A87;">&#35774;&#32622; inJustDecodeBounds &#26469;&#25511;&#21046;&#35299;&#30721;&#22120; &#21482;&#36827;&#34892;&#22270;&#29255;&#23485;&#39640;&#30340;&#33719;&#21462; &#19981;&#21152;&#36733;&#65292;&#19981;&#21344;&#20869;&#23384;</span>
        options.inJustDecodeBounds = <span style="color: #F5666D;">true</span>;
        <span style="color: #204A87;">// </span><span style="color: #204A87;">&#20351;&#29992;Options &#21442;&#25968;&#35774;&#32622;&#35299;&#30721;&#26041;&#24335;</span>
        ret = BitmapFactory.decodeByteArray(data,0,data.length,options);


        <span style="color: #204A87;">// </span><span style="color: #204A87;">----- &#26681;&#25454;&#22270;&#29255;&#30495;&#26159;&#23610;&#23544;&#38632;&#24403;&#21069;&#38656;&#35201;&#26174;&#31034;&#30340;&#23610;&#23544;&#36827;&#34892;&#35745;&#31639;&#29983;&#25104;&#37319;&#26679;&#29575;</span>

        <span style="color: #204A87;">// </span><span style="color: #204A87;">&#20934;&#22791;&#26174;&#31034;&#22312;&#25163;&#26426;&#19978;</span>
        <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">reqW</span> = requestWidth;
        <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">reqH</span> = requestHeight;

        <span style="color: #204A87;">// </span><span style="color: #204A87;">&#35745;&#31639;&#35774;&#32622;&#22270;&#29255;&#37319;&#26679;&#29575;</span>
        options.inSampleSize = calculateInSampleSize(options,reqW,reqH);<span style="color: #204A87;">// </span><span style="color: #204A87;">&#23485;&#24230;&#30340; 1&#65295;32</span>

        <span style="color: #204A87;">// </span><span style="color: #204A87;">&#24320;&#25918;&#35299;&#30721; &#23454;&#38469;&#29983;&#25104; Bitmap</span>
        options.inJustDecodeBounds = <span style="color: #F5666D;">false</span>;
        <span style="color: #204A87;">// </span><span style="color: #204A87;">&#20351;&#29992; 565 &#26041;&#24335;&#35299;&#30721;</span>
        options.inPreferredConfig = <span style="color: #F5666D;">Bitmap</span>.<span style="color: #F5666D;">Config</span>.RGB_565;
        ret = BitmapFactory.decodeByteArray(data,0,data.length,options);
        <span style="color: #A52A2A; font-weight: bold;">return</span> ret;
    }

    <span style="color: #4E9A06;">/**</span>
<span style="color: #4E9A06;">     * &#35745;&#31639;&#22270;&#29255;&#20108;&#27425;&#37319;&#26679;&#30340;&#37319;&#26679;&#29575;&#65292;&#20351;&#29992;&#33719;&#21462;&#22270;&#29255;&#23485;&#39640;&#20043;&#21518;&#30340; option&#21442;&#25968; &#20316;&#20026;&#31532;&#19968;&#20010;&#21442;&#25968;</span>
<span style="color: #4E9A06;">     * </span><span style="color: #F5666D;">@param</span><span style="color: #4E9A06;"> options options</span>
<span style="color: #4E9A06;">     * </span><span style="color: #F5666D;">@param</span><span style="color: #4E9A06;"> reqWidth &#35831;&#27714;&#23485;&#24230;</span>
<span style="color: #4E9A06;">     * </span><span style="color: #F5666D;">@param</span><span style="color: #4E9A06;"> reqHeight &#35831;&#27714;&#39640;&#24230;</span>
<span style="color: #4E9A06;">     * </span><span style="color: #F5666D;">@return</span><span style="color: #4E9A06;"> int &#37319;&#26679;&#29575;</span>
<span style="color: #4E9A06;">     */</span>
    <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #A52A2A; font-weight: bold;">static</span> <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #00578E; font-weight: bold;">calculateInSampleSize</span>(
            <span style="color: #F5666D;">BitmapFactory</span>.<span style="color: #2F8B58; font-weight: bold;">Options</span> <span style="color: #0084C8; font-weight: bold;">options</span>, <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">reqWidth</span>, <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">reqHeight</span>) {
        <span style="color: #204A87;">// </span><span style="color: #204A87;">Raw height and width of image</span>
        <span style="color: #A52A2A; font-weight: bold;">final</span> <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">height</span> = options.outHeight;
        <span style="color: #A52A2A; font-weight: bold;">final</span> <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">width</span> = options.outWidth;
        <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">inSampleSize</span> = 1;

        <span style="color: #204A87;">// </span><span style="color: #204A87;">&#35831;&#27714;&#39640;&#24230;&#23485;&#24230; &gt; 0 &#36827;&#34892;&#32553;&#25918;</span>
        <span style="color: #A52A2A; font-weight: bold;">if</span> (reqHeight &gt; 0 &amp;&amp; reqWidth &gt; 0){

            <span style="color: #A52A2A; font-weight: bold;">if</span> (height &gt; reqHeight || width &gt; reqWidth) {

                <span style="color: #A52A2A; font-weight: bold;">final</span> <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">halfHeight</span> = height / 2;
                <span style="color: #A52A2A; font-weight: bold;">final</span> <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">halfWidth</span> = width / 2;

                <span style="color: #204A87;">// </span><span style="color: #204A87;">Calculate the largest inSampleSize value that is a power of 2 and keeps both</span>
                <span style="color: #204A87;">// </span><span style="color: #204A87;">height and width larger than the requested height and width.</span>
                <span style="color: #A52A2A; font-weight: bold;">while</span> ((halfHeight / inSampleSize) &gt; reqHeight
                        &amp;&amp; (halfWidth / inSampleSize) &gt; reqWidth) {
                    inSampleSize *= 2;
                }
            }
        }
        <span style="color: #A52A2A; font-weight: bold;">return</span> inSampleSize;
    }
</pre>


</li>
</ul>
</div>
</div>

</div>

<div id="outline-container-23-2" class="outline-3">
<h3 id="sec-23-2"><span class="section-number-3">23.2</span> <span class="todo TODO">TODO</span> 复杂的 ListView 应用</h3>
<div class="outline-text-3" id="text-23-2">


</div>

<div id="outline-container-23-2-1" class="outline-4">
<h4 id="sec-23-2-1"><span class="section-number-4">23.2.1</span> 购物车</h4>
<div class="outline-text-4" id="text-23-2-1">

<blockquote>

<p>在一个购物车中，ListView 的每条内容都有可以点击的按钮，比如 增加或减少商品数量，点击图片进入详情页等等，这里就对这样复杂的 LstView 使用做一个笔记
</p>
</blockquote>


<ul>
<li>首先，ListView 所有的 Item 都不直接控制 UI 状态，而是使用 Adapter 来更新，ListView 的更新永远时刷新数据
</li>
<li>ListView内部 Item 中，包含按钮，给按钮设置 Tag 来进行点击事件的支持
</li>
</ul>

<p>总结起来，所有的更新 UI 都由
</p><pre class="example">
notifyDataChanged()来完成
</pre>

<p>而一些状态可以由实体类来记录，比如商品是否选择，减少商品时，当数量为0时的状态。而在 Adapter 中对这些状态进行判断，因为 Item 重用的原因，并不在 Adapter 中更新UI，而是采用接口回调的方式来在 Activity 或者 Fragment 中进行更新，当然，需要通过设置 Tag 来令控件可以被找到
</p>
<blockquote>

<p>需要注意的是： 在所有变化进行之前，必须先设置 Tag，如果先设置状态，就会先调用监听方法，很可能使用的 Tag 就是之前的位置的数据，而达不到预期的目的
</p>
</blockquote>


<ul>
<li id="sec-23-2-1-1">ListView 的焦点冲突<br/>
当 ListView 的条目中有带有焦点的控件比如 Button 时，系统会对焦点进行检测，如果当前控件由焦点，则判断点击事件是否点中焦点， 如果焦点被抢夺，ListView 条目中的点击事件就会无效，而一个行之有效的方法就是使用
<pre class="example">
focusable="false"
</pre>

<p>或 在 Item 容器顶部的XML 标签中
</p><pre class="example">
descendantFocusability=“blockDescendants”
</pre>

<p>这个方法无法解决与 EditView 的冲突问题。
</p></li>
</ul>
<ul>
<li id="sec-23-2-1-2">Adapter 更新触发外部处理<br/>
在购物车中，每次点击加减或者添加删除，都需要改变总金额， Adapter 提供了一种观察者模式来方便的检测更新，然后通知 Activity 或者 Fragment

<p>
注册观察者使用 registerDataSetObserver
</p>
</li>
</ul>
</div>
</div>
</div>

</div>

<div id="outline-container-24" class="outline-2">
<h2 id="sec-24"><span class="section-number-2">24</span> 收藏的网页</h2>
<div class="outline-text-2" id="text-24">


</div>

<div id="outline-container-24-1" class="outline-3">
<h3 id="sec-24-1"><span class="section-number-3">24.1</span> 酷炫的 UI 效果</h3>
<div class="outline-text-3" id="text-24-1">

<p><a href="https://github.com/wasabeef/awesome-android-ui">https://github.com/wasabeef/awesome-android-ui</a>
</p>
</div>

</div>

<div id="outline-container-24-2" class="outline-3">
<h3 id="sec-24-2"><span class="section-number-3">24.2</span> W3C</h3>
<div class="outline-text-3" id="text-24-2">

<p><a href="http://www.w3school.com.cn">http://www.w3school.com.cn</a>
</p></div>

</div>

<div id="outline-container-24-3" class="outline-3">
<h3 id="sec-24-3"><span class="section-number-3">24.3</span> SQL</h3>
<div class="outline-text-3" id="text-24-3">

<p><a href="http://sqlite.org/">http://sqlite.org/</a>
</p></div>
</div>

</div>

<div id="outline-container-25" class="outline-2">
<h2 id="sec-25"><span class="section-number-2">25</span> 常用<span class="target">工具类</span></h2>
<div class="outline-text-2" id="text-25">


</div>

<div id="outline-container-25-1" class="outline-3">
<h3 id="sec-25-1"><span class="section-number-3">25.1</span> HttpUtil</h3>
<div class="outline-text-3" id="text-25-1">




<pre class="src src-java"><span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #A52A2A; font-weight: bold;">static</span> <span style="color: #2F8B58; font-weight: bold;">InputStream</span> <span style="color: #00578E; font-weight: bold;">getInputStream</span>(<span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">path</span>) <span style="color: #A52A2A; font-weight: bold;">throws</span> <span style="color: #2F8B58; font-weight: bold;">IOException</span> {
        <span style="color: #2F8B58; font-weight: bold;">InputStream</span> <span style="color: #0084C8; font-weight: bold;">inputStream</span> = <span style="color: #F5666D;">null</span>;
        <span style="color: #2F8B58; font-weight: bold;">URL</span> <span style="color: #0084C8; font-weight: bold;">url</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">URL</span>(path);
        <span style="color: #2F8B58; font-weight: bold;">HttpURLConnection</span> <span style="color: #0084C8; font-weight: bold;">connection</span> = (<span style="color: #2F8B58; font-weight: bold;">HttpURLConnection</span>) url.openConnection();
        connection.setRequestMethod(<span style="color: #4E9A06;">"GET"</span>);
        connection.setReadTimeout(50000);
        connection.getDoInput();
        connection.connect();
        <span style="color: #A52A2A; font-weight: bold;">if</span>(connection.getResponseCode()==200){
            inputStream = connection.getInputStream();
        }
        <span style="color: #A52A2A; font-weight: bold;">return</span> inputStream;
    }

    <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #A52A2A; font-weight: bold;">static</span> <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #00578E; font-weight: bold;">InputStream2String</span>(<span style="color: #2F8B58; font-weight: bold;">InputStream</span> <span style="color: #0084C8; font-weight: bold;">inputStream</span>) <span style="color: #A52A2A; font-weight: bold;">throws</span> <span style="color: #2F8B58; font-weight: bold;">IOException</span> {
        <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">len</span> = 0;
        <span style="color: #2F8B58; font-weight: bold;">byte</span>[] <span style="color: #0084C8; font-weight: bold;">buf</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">byte</span>[1024];
        <span style="color: #2F8B58; font-weight: bold;">StringBuffer</span> <span style="color: #0084C8; font-weight: bold;">sb</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">StringBuffer</span>();
        <span style="color: #A52A2A; font-weight: bold;">while</span>((len = inputStream.read(buf)) != -1){
            sb.append(<span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">String</span>(buf,0,len,<span style="color: #4E9A06;">"UTF-8"</span>));
        }
        <span style="color: #A52A2A; font-weight: bold;">return</span> sb.toString();
    }

    <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #A52A2A; font-weight: bold;">static</span> <span style="color: #2F8B58; font-weight: bold;">byte</span>[] <span style="color: #00578E; font-weight: bold;">InputStream2byte</span>(<span style="color: #2F8B58; font-weight: bold;">InputStream</span> <span style="color: #0084C8; font-weight: bold;">inputStream</span>) <span style="color: #A52A2A; font-weight: bold;">throws</span> <span style="color: #2F8B58; font-weight: bold;">IOException</span> {
        <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">len</span> = 0;
        <span style="color: #2F8B58; font-weight: bold;">byte</span>[] <span style="color: #0084C8; font-weight: bold;">buf</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">byte</span>[1024];
        <span style="color: #2F8B58; font-weight: bold;">ByteArrayOutputStream</span> <span style="color: #0084C8; font-weight: bold;">bos</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">ByteArrayOutputStream</span>();
        <span style="color: #A52A2A; font-weight: bold;">while</span>((len = inputStream.read(buf))!= -1){
            bos.write(buf,0,len);
        }
        <span style="color: #A52A2A; font-weight: bold;">return</span> bos.toByteArray();
    }

</pre>

</div>

</div>

<div id="outline-container-25-2" class="outline-3">
<h3 id="sec-25-2"><span class="section-number-3">25.2</span> XmlPullParseUtil</h3>
<div class="outline-text-3" id="text-25-2">




<pre class="src src-java"><span style="color: #204A87;">//</span><span style="color: #204A87;">&#19968;&#20010;&#35299;&#26512;&#22478;&#24066;&#30340;&#20363;&#23376;</span>
<span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #A52A2A; font-weight: bold;">static</span> <span style="color: #2F8B58; font-weight: bold;">List</span>&lt;Province&gt; xmlPaese(<span style="color: #2F8B58; font-weight: bold;">InputStream</span> <span style="color: #0084C8; font-weight: bold;">inputStream</span>) <span style="color: #A52A2A; font-weight: bold;">throws</span> <span style="color: #2F8B58; font-weight: bold;">XmlPullParserException</span>, <span style="color: #2F8B58; font-weight: bold;">IOException</span> {
        List&lt;Province&gt; provinces = <span style="color: #F5666D;">null</span>;
        <span style="color: #2F8B58; font-weight: bold;">Province</span> <span style="color: #0084C8; font-weight: bold;">province</span> = <span style="color: #F5666D;">null</span>;
        <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">tagName</span> = <span style="color: #F5666D;">null</span>;
        List&lt;City&gt; cities = <span style="color: #F5666D;">null</span>;
        <span style="color: #2F8B58; font-weight: bold;">City</span> <span style="color: #0084C8; font-weight: bold;">city</span> = <span style="color: #F5666D;">null</span>;
        List&lt;District&gt; districts = <span style="color: #F5666D;">null</span>;
        <span style="color: #2F8B58; font-weight: bold;">District</span> <span style="color: #0084C8; font-weight: bold;">district</span>;
        <span style="color: #2F8B58; font-weight: bold;">XmlPullParserFactory</span> <span style="color: #0084C8; font-weight: bold;">xmlPullParserFactory</span> = XmlPullParserFactory.newInstance();
        <span style="color: #2F8B58; font-weight: bold;">XmlPullParser</span> <span style="color: #0084C8; font-weight: bold;">xmlPullParser</span> = xmlPullParserFactory.newPullParser();
        xmlPullParser.setInput(inputStream,<span style="color: #4E9A06;">"UTF-8"</span>);
        <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">event</span> = xmlPullParser.getEventType();
        <span style="color: #A52A2A; font-weight: bold;">while</span>(event != <span style="color: #F5666D;">XmlPullParser</span>.END_DOCUMENT){
            <span style="color: #A52A2A; font-weight: bold;">switch</span>(event){
                <span style="color: #A52A2A; font-weight: bold;">case</span> <span style="color: #F5666D;">XmlPullParser</span>.START_DOCUMENT:
                    provinces = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">ArrayList</span>&lt;&gt;();
                    <span style="color: #A52A2A; font-weight: bold;">break</span>;
                <span style="color: #A52A2A; font-weight: bold;">case</span> <span style="color: #F5666D;">XmlPullParser</span>.START_TAG:
                    tagName = xmlPullParser.getName();
                    <span style="color: #A52A2A; font-weight: bold;">if</span>(<span style="color: #4E9A06;">"p"</span>.equals(tagName)){
                        province = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">Province</span>();
                        cities = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">ArrayList</span>&lt;&gt;();

                        <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">count</span> = xmlPullParser.getAttributeCount();
                        <span style="color: #A52A2A; font-weight: bold;">for</span>(<span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">i</span> = 0; i &lt; count; i++){
                            <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">name</span> = xmlPullParser.getAttributeName(i);
                            <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">value</span> = xmlPullParser.getAttributeValue(i);
                            <span style="color: #A52A2A; font-weight: bold;">if</span>(<span style="color: #4E9A06;">"p_id"</span>.equals(name)){
                                province.setId(value);
                            }
                        }
                    }<span style="color: #A52A2A; font-weight: bold;">else</span> <span style="color: #A52A2A; font-weight: bold;">if</span>(<span style="color: #4E9A06;">"pn"</span>.equals(tagName)){
                        province.setName(xmlPullParser.nextText());
                    }<span style="color: #A52A2A; font-weight: bold;">else</span> <span style="color: #A52A2A; font-weight: bold;">if</span>(<span style="color: #4E9A06;">"c"</span>.equals(tagName)){
                            city = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">City</span>();
                            districts = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">ArrayList</span>&lt;&gt;();

                        <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">count</span> = xmlPullParser.getAttributeCount();
                            <span style="color: #A52A2A; font-weight: bold;">for</span>(<span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">i</span> = 0; i &lt; count; i++){
                                <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">name</span> = xmlPullParser.getAttributeName(i);
                                <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">value</span> = xmlPullParser.getAttributeValue(i);
                                <span style="color: #A52A2A; font-weight: bold;">if</span>(<span style="color: #4E9A06;">"c_id"</span>.equals(name)){
                                    city.setId(value);
                                }
                            }
                        }<span style="color: #A52A2A; font-weight: bold;">else</span> <span style="color: #A52A2A; font-weight: bold;">if</span>(<span style="color: #4E9A06;">"cn"</span>.equals(tagName)){
                            city.setName(xmlPullParser.nextText());
                        }<span style="color: #A52A2A; font-weight: bold;">else</span> <span style="color: #A52A2A; font-weight: bold;">if</span>(<span style="color: #4E9A06;">"d"</span>.equals(tagName)){
                            district = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">District</span>();
                            <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">count</span> = xmlPullParser.getAttributeCount();
                            <span style="color: #A52A2A; font-weight: bold;">for</span>(<span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">i</span> = 0; i &lt; count; i++){
                                <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">name</span> = xmlPullParser.getAttributeName(i);
                                <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">value</span> = xmlPullParser.getAttributeValue(i);
                                <span style="color: #A52A2A; font-weight: bold;">if</span>(<span style="color: #4E9A06;">"d_id"</span>.equals(name)){
                                    district.setId(value);
                                }
                                district.setName(xmlPullParser.nextText());
                                districts.add(district);
                            }
                        }

                        <span style="color: #A52A2A; font-weight: bold;">break</span>;
                    <span style="color: #A52A2A; font-weight: bold;">case</span> <span style="color: #F5666D;">XmlPullParser</span>.END_TAG:

                        <span style="color: #A52A2A; font-weight: bold;">if</span>(<span style="color: #4E9A06;">"c"</span>.equals(xmlPullParser.getName())){
                            city.setDistricts(districts);
                            cities.add(city);
                        }<span style="color: #A52A2A; font-weight: bold;">else</span> <span style="color: #A52A2A; font-weight: bold;">if</span>(<span style="color: #4E9A06;">"p"</span>.equals(xmlPullParser.getName())){

                            province.setCitys(cities);
                            provinces.add(province);
                        }
                        <span style="color: #A52A2A; font-weight: bold;">break</span>;
                }
                event = xmlPullParser.next();
        }
        <span style="color: #A52A2A; font-weight: bold;">return</span> provinces;
    }
</pre>

</div>

</div>

<div id="outline-container-25-3" class="outline-3">
<h3 id="sec-25-3"><span class="section-number-3">25.3</span> JsonParseUtil</h3>
<div class="outline-text-3" id="text-25-3">




<pre class="src src-java"><span style="color: #204A87;">//</span><span style="color: #204A87;">&#19968;&#20010;&#35299;&#26512;&#22825;&#27668;&#24773;&#20917;&#30340;&#20363;&#23376;</span>
<span style="color: #A52A2A; font-weight: bold;">static</span> <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">List</span>&lt;WeatherInfo&gt; parseWeather(<span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">jsonString</span>) <span style="color: #A52A2A; font-weight: bold;">throws</span> <span style="color: #2F8B58; font-weight: bold;">JSONException</span> {
        List&lt;WeatherInfo&gt; list = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">ArrayList</span>&lt;&gt;();
        <span style="color: #2F8B58; font-weight: bold;">JSONObject</span> <span style="color: #0084C8; font-weight: bold;">object</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">JSONObject</span>(jsonString);
        <span style="color: #2F8B58; font-weight: bold;">JSONArray</span> <span style="color: #0084C8; font-weight: bold;">data</span> = object.getJSONArray(<span style="color: #4E9A06;">"data"</span>);
        <span style="color: #A52A2A; font-weight: bold;">for</span>(<span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">i</span> = 0; i &lt; data.length(); i++){
            <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">date</span> = data.getJSONObject(i).getString(<span style="color: #4E9A06;">"date"</span>);
            <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">icon</span> = data.getJSONObject(i).getString(<span style="color: #4E9A06;">"icon"</span>);
            <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">weather</span> = data.getJSONObject(i).getString(<span style="color: #4E9A06;">"weather"</span>);
            <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">temperature</span> = data.getJSONObject(i).getString(<span style="color: #4E9A06;">"temperature"</span>);
            <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">winddirect</span> = data.getJSONObject(i).getString(<span style="color: #4E9A06;">"winddirect"</span>);
            Log.d(<span style="color: #4E9A06;">"json======"</span>,data+icon+weather+temperature+winddirect);
            list.add(<span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">WeatherInfo</span>(date,icon,weather,temperature,winddirect));
        }
        <span style="color: #A52A2A; font-weight: bold;">return</span> list;
    }

</pre>



<pre class="src src-java"><span style="color: #204A87;">//</span><span style="color: #204A87;">&#19968;&#20010; json &#20363;&#23376;</span>
<span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">jsonString</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">String</span>(bytes,<span style="color: #4E9A06;">"utf-8"</span>);
        <span style="color: #2F8B58; font-weight: bold;">JSONObject</span> <span style="color: #0084C8; font-weight: bold;">obj</span> = <span style="color: #F5666D;">null</span>;
        obj = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">JSONObject</span>(jsonString).getJSONObject(<span style="color: #4E9A06;">"cities"</span>);
        <span style="color: #2F8B58; font-weight: bold;">Gson</span> <span style="color: #0084C8; font-weight: bold;">gson</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">Gson</span>();
        TypeToken&lt;List&lt;City&gt;&gt; token = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">TypeToken</span>&lt;List&lt;City&gt;&gt;(){};
        List&lt;City&gt; temp1 = gson.fromJson(obj.getJSONArray(<span style="color: #4E9A06;">"hotcities"</span>).toString(), token.getType());
        list.add(<span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">City</span>(<span style="color: #4E9A06;">"hotcities"</span>, <span style="color: #4E9A06;">"label"</span>));
        list.addAll(temp1);
        <span style="color: #A52A2A; font-weight: bold;">for</span> (<span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">i</span> = 0; i &lt; <span style="color: #4E9A06;">'Z'</span> - <span style="color: #4E9A06;">'A'</span>; i++) {
            <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">str</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">String</span>((<span style="color: #2F8B58; font-weight: bold;">char</span>) (<span style="color: #4E9A06;">'A'</span> + i) + <span style="color: #4E9A06;">""</span>);
            <span style="color: #A52A2A; font-weight: bold;">try</span> {
                <span style="color: #2F8B58; font-weight: bold;">JSONArray</span> <span style="color: #0084C8; font-weight: bold;">arr</span> = obj.getJSONArray(str);
                list.add(<span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">City</span>(str, <span style="color: #4E9A06;">"label"</span>));
                listRight.add(str);
                List&lt;City&gt; temp = gson.fromJson(arr.toString(), token.getType());
                list.addAll(temp);
            } <span style="color: #A52A2A; font-weight: bold;">catch</span> (<span style="color: #2F8B58; font-weight: bold;">JSONException</span> <span style="color: #0084C8; font-weight: bold;">e</span>) {
                Log.d(<span style="color: #4E9A06;">"json"</span>, <span style="color: #4E9A06;">"&#27809;&#36825;&#20010;&#23383;&#27597;"</span> + str);
            }
        }
</pre>


</div>

</div>

<div id="outline-container-25-4" class="outline-3">
<h3 id="sec-25-4"><span class="section-number-3">25.4</span> FileUtil</h3>
<div class="outline-text-3" id="text-25-4">

<p>缓存图片的例子
</p>


<pre class="src src-java"><span style="color: #204A87;">//</span><span style="color: #204A87;">&#23384;&#20648;&#22270;&#29255;&#30340;&#30446;&#24405;</span>
<span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #A52A2A; font-weight: bold;">static</span> <span style="color: #A52A2A; font-weight: bold;">final</span> <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">IMAGE_URL</span> = Environment.getExternalStorageDirectory()+<span style="color: #4E9A06;">"/xx/images"</span>;
<span style="color: #204A87;">//</span><span style="color: #204A87;">&#21028;&#26029;&#26159;&#21542;&#25346;&#36733;&#25193;&#23637;&#21345;</span>
<span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #A52A2A; font-weight: bold;">static</span>  <span style="color: #2F8B58; font-weight: bold;">boolean</span> <span style="color: #00578E; font-weight: bold;">isMounted</span>(){
    <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">state</span> = Environment.getExternalStorageState();
    state.equals(<span style="color: #F5666D;">Environment</span>.MEDIA_MOUNTED);
}
<span style="color: #204A87;">//</span><span style="color: #204A87;">&#20445;&#23384;&#22270;&#29255;&#21040;&#30446;&#24405;</span>
<span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #A52A2A; font-weight: bold;">static</span>  <span style="color: #2F8B58; font-weight: bold;">void</span> <span style="color: #00578E; font-weight: bold;">saveImage</span>(<span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">url</span>, <span style="color: #2F8B58; font-weight: bold;">byte</span>[] <span style="color: #0084C8; font-weight: bold;">data</span>){
    <span style="color: #A52A2A; font-weight: bold;">if</span>(!isMounted()){
        <span style="color: #A52A2A; font-weight: bold;">return</span>;
    }
    <span style="color: #2F8B58; font-weight: bold;">File</span> <span style="color: #0084C8; font-weight: bold;">dir</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">File</span>(IMAGE_URL);
    <span style="color: #A52A2A; font-weight: bold;">if</span>(!dir.exists()){
        dir.mkdirs();
    }
    <span style="color: #2F8B58; font-weight: bold;">FileOutputStream</span> <span style="color: #0084C8; font-weight: bold;">fos</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">FileOutputStream</span>(<span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">File</span>(dir,getFileName(url)));
    fos.write(data);
    fos.close();
}
<span style="color: #204A87;">//</span><span style="color: #204A87;">&#35835;&#21462;&#22270;&#29255;</span>
<span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #A52A2A; font-weight: bold;">static</span> <span style="color: #2F8B58; font-weight: bold;">Bitmap</span> <span style="color: #00578E; font-weight: bold;">readImage</span>(<span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">url</span>){
    <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">fileName</span> = getFileName(utl);
    <span style="color: #2F8B58; font-weight: bold;">File</span> <span style="color: #0084C8; font-weight: bold;">file</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">File</span>(dir,fileName);
    <span style="color: #2F8B58; font-weight: bold;">Bitmap</span> <span style="color: #0084C8; font-weight: bold;">Bitmap</span> = BitmapFactory.decodeFile(file.getAbsolutePath());
    <span style="color: #A52A2A; font-weight: bold;">return</span> biemap;
}
<span style="color: #204A87;">//</span><span style="color: #204A87;">&#21028;&#26029;&#21097;&#20313;&#25511;&#20214;</span>
<span style="color: #A52A2A; font-weight: bold;">public</span> staic <span style="color: #2F8B58; font-weight: bold;">boolean</span> <span style="color: #00578E; font-weight: bold;">isAble</span>(){
    <span style="color: #2F8B58; font-weight: bold;">StatFs</span> <span style="color: #0084C8; font-weight: bold;">fs</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">StatFs</span>(Environment.getExternalStorageDirectory().getAbsolutePath());
    <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">count</span> = fs.getFreeBlocks();<span style="color: #204A87;">//</span><span style="color: #204A87;">&#33719;&#21462;&#31354;&#38386;&#30340;&#25968;&#25454;&#22359;&#20010;&#25968;</span>
    fs.getBlockSize();<span style="color: #204A87;">//</span><span style="color: #204A87;">&#33719;&#21462;&#27599;&#22359;&#25968;&#25454;&#22359;&#22823;&#23567;</span>
    <span style="color: #2F8B58; font-weight: bold;">long</span> <span style="color: #0084C8; font-weight: bold;">total</span> = count * size;

    <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">t</span> = (<span style="color: #2F8B58; font-weight: bold;">int</span>)(total/1024/1024);
    <span style="color: #A52A2A; font-weight: bold;">if</span>(t&gt;2)
        <span style="color: #A52A2A; font-weight: bold;">return</span> <span style="color: #F5666D;">true</span>;
    <span style="color: #A52A2A; font-weight: bold;">else</span> 
        <span style="color: #A52A2A; font-weight: bold;">return</span> <span style="color: #F5666D;">false</span>;
}
<span style="color: #204A87;">//</span><span style="color: #204A87;">&#28165;&#31354;&#25193;&#23637;&#21345;</span>
<span style="color: #A52A2A; font-weight: bold;">public</span> staic <span style="color: #2F8B58; font-weight: bold;">void</span> <span style="color: #00578E; font-weight: bold;">clear</span>(){
    <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">path</span> = Environment.getExternalStorageDirectory.getAbsolutePath();

    <span style="color: #2F8B58; font-weight: bold;">File</span> <span style="color: #0084C8; font-weight: bold;">dir</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">File</span>(Environment.getExternalStorageDirectory());

}

<span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #A52A2A; font-weight: bold;">static</span> <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #00578E; font-weight: bold;">getFileName</span>(<span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">url</span>){
    url.substring(url.lastIndexOf(<span style="color: #4E9A06;">"/"</span>)+1);
}
</pre>




<p>
useLibrary "org.apache.http.legacy"
</p>



</div>

</div>

<div id="outline-container-25-5" class="outline-3">
<h3 id="sec-25-5"><span class="section-number-3">25.5</span> 图片缓存 FileCache</h3>
<div class="outline-text-3" id="text-25-5">

<p>FileCache.java
</p>


<pre class="src src-java"><span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #A52A2A; font-weight: bold;">class</span> <span style="color: #2F8B58; font-weight: bold;">FileCache</span> {
    <span style="color: #A52A2A; font-weight: bold;">private</span> <span style="color: #A52A2A; font-weight: bold;">static</span> <span style="color: #2F8B58; font-weight: bold;">FileCache</span> <span style="color: #0084C8; font-weight: bold;">ourInstance</span>;

    <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #A52A2A; font-weight: bold;">static</span> <span style="color: #2F8B58; font-weight: bold;">FileCache</span> <span style="color: #00578E; font-weight: bold;">newInstance</span>(<span style="color: #2F8B58; font-weight: bold;">Context</span> <span style="color: #0084C8; font-weight: bold;">context</span>){
        <span style="color: #A52A2A; font-weight: bold;">if</span> (context != <span style="color: #F5666D;">null</span>){

            <span style="color: #A52A2A; font-weight: bold;">if</span> (ourInstance == <span style="color: #F5666D;">null</span>) {
                ourInstance = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">FileCache</span>(context);
            }

        }<span style="color: #A52A2A; font-weight: bold;">else</span>{
            <span style="color: #A52A2A; font-weight: bold;">throw</span> <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">IllegalArgumentException</span>(<span style="color: #4E9A06;">"Context must be set"</span>);

        }

        <span style="color: #A52A2A; font-weight: bold;">return</span> ourInstance;
    }

    <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #A52A2A; font-weight: bold;">static</span> <span style="color: #2F8B58; font-weight: bold;">FileCache</span> <span style="color: #00578E; font-weight: bold;">getInstance</span>(){
        <span style="color: #A52A2A; font-weight: bold;">if</span> (ourInstance == <span style="color: #F5666D;">null</span>){
            <span style="color: #A52A2A; font-weight: bold;">throw</span> <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">IllegalStateException</span>(<span style="color: #4E9A06;">"newInstance invoke"</span>);
        }
        <span style="color: #A52A2A; font-weight: bold;">return</span> ourInstance;
    }

    <span style="color: #A52A2A; font-weight: bold;">private</span> <span style="color: #2F8B58; font-weight: bold;">Context</span> <span style="color: #0084C8; font-weight: bold;">context</span>;
    <span style="color: #A52A2A; font-weight: bold;">private</span> FileCache(<span style="color: #2F8B58; font-weight: bold;">Context</span> <span style="color: #0084C8; font-weight: bold;">context</span>) {
        <span style="color: #A52A2A; font-weight: bold;">this</span>.context = context;
    }


    <span style="color: #4E9A06;">/**</span>
<span style="color: #4E9A06;">     * &#23558;&#23383;&#33410;&#25968;&#32452;&#36716;&#21270;&#20026;16&#36827;&#21046;&#32534;&#30721;&#23383;&#31526;&#20018;</span>
<span style="color: #4E9A06;">     * </span><span style="color: #F5666D;">@param</span><span style="color: #4E9A06;"> data</span>
<span style="color: #4E9A06;">     * </span><span style="color: #F5666D;">@return</span>
<span style="color: #4E9A06;">     */</span>
    <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #A52A2A; font-weight: bold;">static</span> <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #00578E; font-weight: bold;">toHex</span>(<span style="color: #2F8B58; font-weight: bold;">byte</span>[] <span style="color: #0084C8; font-weight: bold;">data</span>){
        <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">ret</span> = <span style="color: #F5666D;">null</span>;
        <span style="color: #A52A2A; font-weight: bold;">if</span> (data != <span style="color: #F5666D;">null</span> &amp;&amp; data.length &gt; 0 ){
            <span style="color: #2F8B58; font-weight: bold;">StringBuilder</span> <span style="color: #0084C8; font-weight: bold;">stringBuilder</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">StringBuilder</span>();
            <span style="color: #A52A2A; font-weight: bold;">for</span> (<span style="color: #2F8B58; font-weight: bold;">byte</span> <span style="color: #0084C8; font-weight: bold;">b</span> : data){
                <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">v</span> = b &amp; 0x0FF;
                <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">hex</span> = Integer.toHexString(v);
                <span style="color: #A52A2A; font-weight: bold;">if</span> (v &gt; 0x0F){
                    stringBuilder.append(hex);
                }<span style="color: #A52A2A; font-weight: bold;">else</span> {
                    stringBuilder.append(<span style="color: #4E9A06;">'0'</span>).append(hex);
                }
            }
            ret = stringBuilder.toString();
        }
        <span style="color: #A52A2A; font-weight: bold;">return</span> ret;
    }

    <span style="color: #4E9A06;">/**</span>
<span style="color: #4E9A06;">     * &#23558;&#32593;&#22336;&#26144;&#23556;&#20026;&#25991;&#20214;&#21517;</span>
<span style="color: #4E9A06;">     * </span><span style="color: #F5666D;">@param</span><span style="color: #4E9A06;"> url</span>
<span style="color: #4E9A06;">     * </span><span style="color: #F5666D;">@return</span>
<span style="color: #4E9A06;">     */</span>
    <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #A52A2A; font-weight: bold;">static</span> <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #00578E; font-weight: bold;">mapFile</span>(<span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">url</span>){
        <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">ret</span> = <span style="color: #F5666D;">null</span>;
        <span style="color: #A52A2A; font-weight: bold;">if</span> (url != <span style="color: #F5666D;">null</span>){
            <span style="color: #A52A2A; font-weight: bold;">try</span> {
                <span style="color: #204A87;">// </span><span style="color: #204A87;">&#21019;&#24314;&#28040;&#24687;&#25688;&#35201; &#20351;&#29992;MD5&#31639;&#27861;</span>
                <span style="color: #2F8B58; font-weight: bold;">MessageDigest</span> <span style="color: #0084C8; font-weight: bold;">digest</span> = MessageDigest.getInstance(<span style="color: #4E9A06;">"MD5"</span>);
                <span style="color: #2F8B58; font-weight: bold;">byte</span>[] <span style="color: #0084C8; font-weight: bold;">data</span> = digest.digest(url.getBytes());
                <span style="color: #204A87;">// </span><span style="color: #204A87;">&#35745;&#31639; url &#23545;&#24212;&#30340; MD5 &#29983;&#25104;&#30340;&#25968;&#25454;,&#20869;&#37096;&#21253;&#21547;&#20102;&#19981;&#21487;&#26174;&#31034;&#30340;&#23383;&#33410;&#65292;&#38656;&#35201;&#32534;&#30721;&#36716;&#21270;&#20026;&#23383;&#31526;&#20018;</span>
                <span style="color: #204A87;">// </span><span style="color: #204A87;">&#19981;&#35201;&#20351;&#29992; new String(byte[]);  &#38656;&#35201;&#36716;&#21270;&#25104;0x</span>

                <span style="color: #204A87;">// </span><span style="color: #204A87;">byte[] &#27599;&#19968;&#20010;&#23383;&#33410;&#36716;&#25442;&#20026; 16&#36827;&#21046; &#24182;&#19988;&#25340;&#25509;&#25104;&#19968;&#20010;&#23383;&#31526;&#20018;</span>

                ret = toHex(data);

            } <span style="color: #A52A2A; font-weight: bold;">catch</span> (<span style="color: #2F8B58; font-weight: bold;">NoSuchAlgorithmException</span> <span style="color: #0084C8; font-weight: bold;">e</span>) {
                e.printStackTrace();
            }
        }
        <span style="color: #A52A2A; font-weight: bold;">return</span> ret;
    }

    <span style="color: #4E9A06;">/**</span>
<span style="color: #4E9A06;">     * &#20174;&#25991;&#20214;&#23384;&#20648;&#21152;&#36733;&#23545;&#24212;&#32593;&#22336;&#30340;&#20869;&#23481;</span>
<span style="color: #4E9A06;">     * </span><span style="color: #F5666D;">@param</span><span style="color: #4E9A06;"> url</span>
<span style="color: #4E9A06;">     * </span><span style="color: #F5666D;">@return</span>
<span style="color: #4E9A06;">     */</span>
    <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">byte</span>[] <span style="color: #00578E; font-weight: bold;">load</span>(<span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">url</span>){
        <span style="color: #204A87;">// </span><span style="color: #204A87;">&#36890;&#36807;&#32593;&#22336;&#25214;&#25991;&#20214;</span>
        <span style="color: #2F8B58; font-weight: bold;">byte</span>[] <span style="color: #0084C8; font-weight: bold;">ret</span> = <span style="color: #F5666D;">null</span>;

        <span style="color: #A52A2A; font-weight: bold;">if</span> (url != <span style="color: #F5666D;">null</span>){
            <span style="color: #204A87;">// </span><span style="color: #204A87;">&#26368;&#32456;&#30340;&#25991;&#20214;&#32531;&#23384;&#30446;&#24405;</span>
            <span style="color: #2F8B58; font-weight: bold;">File</span> <span style="color: #0084C8; font-weight: bold;">cacheDir</span> = <span style="color: #F5666D;">null</span>;

            <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">state</span> = Environment.getExternalStorageState();
            <span style="color: #A52A2A; font-weight: bold;">if</span> (<span style="color: #F5666D;">Environment</span>.MEDIA_BAD_REMOVAL.equals(state)){
                <span style="color: #204A87;">// </span><span style="color: #204A87;">&#33719;&#21462;&#23384;&#20648;&#21345;&#30340;&#32531;&#23384;&#30446;&#24405;</span>
                cacheDir = context.getExternalCacheDir();

            }<span style="color: #A52A2A; font-weight: bold;">else</span> {
                <span style="color: #204A87;">// </span><span style="color: #204A87;">&#20869;&#37096;&#32531;&#23384;</span>
                cacheDir = context.getCacheDir();
            }

            <span style="color: #204A87;">// </span><span style="color: #204A87;">&#26144;&#23556;&#25991;&#20214;&#21517;&#25104;</span>
            <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">fileName</span> = mapFile(url);
            <span style="color: #2F8B58; font-weight: bold;">File</span> <span style="color: #0084C8; font-weight: bold;">targetFile</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">File</span>(cacheDir,fileName);
            <span style="color: #A52A2A; font-weight: bold;">if</span> (targetFile.exists()){
                <span style="color: #2F8B58; font-weight: bold;">ByteArrayOutputStream</span> <span style="color: #0084C8; font-weight: bold;">bout</span> = <span style="color: #F5666D;">null</span>;
                <span style="color: #2F8B58; font-weight: bold;">FileInputStream</span> <span style="color: #0084C8; font-weight: bold;">fin</span> = <span style="color: #F5666D;">null</span>;
                <span style="color: #A52A2A; font-weight: bold;">try</span> {
                    fin = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">FileInputStream</span>(targetFile);

                    bout = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">ByteArrayOutputStream</span>();

                    <span style="color: #2F8B58; font-weight: bold;">byte</span>[] <span style="color: #0084C8; font-weight: bold;">buf</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">byte</span>[128];
                    <span style="color: #2F8B58; font-weight: bold;">int</span> <span style="color: #0084C8; font-weight: bold;">len</span>;
                    <span style="color: #A52A2A; font-weight: bold;">while</span> (<span style="color: #F5666D;">true</span>){
                        len = fin.read(buf);
                        <span style="color: #A52A2A; font-weight: bold;">if</span> (len == -1){
                            <span style="color: #A52A2A; font-weight: bold;">break</span>;
                        }
                        bout.write(buf,0,len);

                    }

                    <span style="color: #204A87;">// </span><span style="color: #204A87;">buf &#27604;&#38656;&#35201;&#36827;&#34892; = null &#30340;&#25805;&#20316;</span>
                    <span style="color: #204A87;">// </span><span style="color: #204A87;">&#20943;&#23569;&#20869;&#23384;&#28322;&#20986;&#30340;&#21487;&#33021;&#24615;&#65292; &#35753; gc &#21487;&#20197;&#22238;&#25910;</span>
                    buf = <span style="color: #F5666D;">null</span>;

                    ret = bout.toByteArray();

                } <span style="color: #A52A2A; font-weight: bold;">catch</span> (<span style="color: #2F8B58; font-weight: bold;">IOException</span> <span style="color: #0084C8; font-weight: bold;">e</span>) {
                    e.printStackTrace();
                } <span style="color: #A52A2A; font-weight: bold;">finally</span> {
                    <span style="color: #A52A2A; font-weight: bold;">if</span> (fin != <span style="color: #F5666D;">null</span>){
                        <span style="color: #A52A2A; font-weight: bold;">try</span> {
                            fin.close();
                        } <span style="color: #A52A2A; font-weight: bold;">catch</span> (<span style="color: #2F8B58; font-weight: bold;">IOException</span> <span style="color: #0084C8; font-weight: bold;">e</span>) {
                            e.printStackTrace();
                        }
                    }
                    <span style="color: #A52A2A; font-weight: bold;">if</span> (bout != <span style="color: #F5666D;">null</span>){
                        <span style="color: #A52A2A; font-weight: bold;">try</span> {
                            bout.close();
                        } <span style="color: #A52A2A; font-weight: bold;">catch</span> (<span style="color: #2F8B58; font-weight: bold;">IOException</span> <span style="color: #0084C8; font-weight: bold;">e</span>) {
                            e.printStackTrace();
                        }
                    }
                }
            }
        }
        <span style="color: #A52A2A; font-weight: bold;">return</span> ret;
    }

    <span style="color: #4E9A06;">/**</span>
<span style="color: #4E9A06;">     * &#20445;&#23384;&#23545;&#24212;&#32593;&#22336;&#30340;&#25968;&#25454;&#21040;&#25991;&#20214;&#20013;</span>
<span style="color: #4E9A06;">     * </span><span style="color: #F5666D;">@param</span><span style="color: #4E9A06;"> url</span>
<span style="color: #4E9A06;">     * </span><span style="color: #F5666D;">@param</span><span style="color: #4E9A06;"> data</span>
<span style="color: #4E9A06;">     */</span>
    <span style="color: #A52A2A; font-weight: bold;">public</span> <span style="color: #2F8B58; font-weight: bold;">void</span> <span style="color: #00578E; font-weight: bold;">save</span>(<span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">url</span>, <span style="color: #2F8B58; font-weight: bold;">byte</span>[] <span style="color: #0084C8; font-weight: bold;">data</span>){
        <span style="color: #204A87;">// </span><span style="color: #204A87;">&#36890;&#36807;&#32593;&#22336;&#23384;&#25991;&#20214;</span>

        <span style="color: #A52A2A; font-weight: bold;">if</span> (url != <span style="color: #F5666D;">null</span> &amp;&amp; data != <span style="color: #F5666D;">null</span>){

            <span style="color: #204A87;">// </span><span style="color: #204A87;">&#26368;&#32456;&#30340;&#25991;&#20214;&#32531;&#23384;&#30446;&#24405;</span>
            <span style="color: #2F8B58; font-weight: bold;">File</span> <span style="color: #0084C8; font-weight: bold;">cacheDir</span> = <span style="color: #F5666D;">null</span>;

            <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">state</span> = Environment.getExternalStorageState();
            <span style="color: #A52A2A; font-weight: bold;">if</span> (<span style="color: #F5666D;">Environment</span>.MEDIA_BAD_REMOVAL.equals(state)){
                <span style="color: #204A87;">// </span><span style="color: #204A87;">&#33719;&#21462;&#23384;&#20648;&#21345;&#30340;&#32531;&#23384;&#30446;&#24405;</span>
                cacheDir = context.getExternalCacheDir();

            }<span style="color: #A52A2A; font-weight: bold;">else</span> {
                <span style="color: #204A87;">// </span><span style="color: #204A87;">&#20869;&#37096;&#32531;&#23384;</span>
                cacheDir = context.getCacheDir();
            }

            <span style="color: #204A87;">// </span><span style="color: #204A87;">&#26144;&#23556;&#25991;&#20214;&#21517;&#25104;</span>
            <span style="color: #2F8B58; font-weight: bold;">String</span> <span style="color: #0084C8; font-weight: bold;">fileName</span> = mapFile(url);
            <span style="color: #2F8B58; font-weight: bold;">File</span> <span style="color: #0084C8; font-weight: bold;">targetFile</span> = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">File</span>(cacheDir,fileName);
            <span style="color: #204A87;">//</span><span style="color: #204A87;">IO</span>
            <span style="color: #2F8B58; font-weight: bold;">FileOutputStream</span> <span style="color: #0084C8; font-weight: bold;">fout</span> = <span style="color: #F5666D;">null</span>;
            <span style="color: #A52A2A; font-weight: bold;">try</span> {
                fout = <span style="color: #A52A2A; font-weight: bold;">new</span> <span style="color: #2F8B58; font-weight: bold;">FileOutputStream</span>(targetFile);
                fout.write(data);
            } <span style="color: #A52A2A; font-weight: bold;">catch</span> (<span style="color: #2F8B58; font-weight: bold;">IOException</span> <span style="color: #0084C8; font-weight: bold;">e</span>) {
                e.printStackTrace();
            } <span style="color: #A52A2A; font-weight: bold;">finally</span> {
                <span style="color: #A52A2A; font-weight: bold;">if</span> (fout != <span style="color: #F5666D;">null</span>) {
                    <span style="color: #A52A2A; font-weight: bold;">try</span> {
                        fout.close();
                    } <span style="color: #A52A2A; font-weight: bold;">catch</span> (<span style="color: #2F8B58; font-weight: bold;">IOException</span> <span style="color: #0084C8; font-weight: bold;">e</span>) {
                        e.printStackTrace();
                    }
                }
            }

        }
    }

}

</pre>

</div>
</div>
</div>
</div>

<div id="postamble">
<p class="date">Date: 2015-10-19T11:03+0800</p>
<p class="author">Author: alex</p>
<p class="creator"><a href="http://orgmode.org">Org</a> version 7.9.3f with <a href="http://www.gnu.org/software/emacs/">Emacs</a> version 24</p>
<a href="http://validator.w3.org/check?uri=referer">Validate XHTML 1.0</a>

</div>
</body>
</html>
